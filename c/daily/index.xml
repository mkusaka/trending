<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub C Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2023-06-13T01:34:03Z</updated>
  <subtitle>Daily Trending of C in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>mnurzia/rv</title>
    <updated>2023-06-13T01:34:03Z</updated>
    <id>tag:github.com,2023-06-13:/mnurzia/rv</id>
    <link href="https://github.com/mnurzia/rv" rel="alternate"></link>
    <summary type="html">&lt;p&gt;RV32IMC in ~600 lines of C89&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;rv&lt;/h1&gt; &#xA;&lt;p&gt;RISC-V CPU core written in ANSI C.&lt;/p&gt; &#xA;&lt;p&gt;Features:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;code&gt;RV32IMC&lt;/code&gt; user-level implementation&lt;/li&gt; &#xA; &lt;li&gt;Passes all supported tests in &lt;a href=&#34;https://github.com/riscv/riscv-tests&#34;&gt;&lt;code&gt;riscv-tests&lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;~600 lines of code&lt;/li&gt; &#xA; &lt;li&gt;Doesn&#39;t use any integer types larger than 32 bits, even for multiplication&lt;/li&gt; &#xA; &lt;li&gt;Simple API (two functions, plus two memory callback functions that you provide)&lt;/li&gt; &#xA; &lt;li&gt;No memory allocations&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;API&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-c&#34;&gt;/* Memory access callbacks: data is input/output, return RV_BAD on fault, 0 otherwise */&#xA;typedef rv_res (*rv_store_cb)(void *user, rv_u32 addr, rv_u8 data);&#xA;typedef rv_res (*rv_load_cb)(void *user, rv_u32 addr, rv_u8 *data);&#xA;&#xA;/* Initialize CPU. */&#xA;void rv_init(rv *cpu, void *user, rv_load_cb load_cb, rv_store_cb store_cb);&#xA;&#xA;/* Single-step CPU. Returns 0 on success, one of RV_E* on exception. */&#xA;rv_u32 rv_step(rv *cpu);&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Usage&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-c&#34;&gt;#include &amp;lt;stdio.h&amp;gt;&#xA;#include &amp;lt;string.h&amp;gt;&#xA;&#xA;#include &#34;rv.h&#34;&#xA;&#xA;rv_res load_cb(void *user, rv_u32 addr, rv_u8 *data) {&#xA;  if (addr - 0x80000000 &amp;gt; 0x10000) /* Reset vector is 0x80000000 */&#xA;    return RV_BAD;&#xA;  *data = ((rv_u8 *)(user))[addr - 0x80000000];&#xA;  return RV_OK;&#xA;}&#xA;&#xA;rv_res store_cb(void *user, rv_u32 addr, rv_u8 data) {&#xA;  if (addr - 0x80000000 &amp;gt; 0x10000)&#xA;    return RV_BAD;&#xA;  ((rv_u8 *)(user))[addr - 0x80000000] = data;&#xA;  return RV_OK;&#xA;}&#xA;&#xA;rv_u32 program[2] = {&#xA;    /* _start: */&#xA;    0x02A88893, /* add a7, a7, 42 */&#xA;    0x00000073  /* ecall */&#xA;};&#xA;&#xA;int main(void) {&#xA;  rv_u8 mem[0x10000];&#xA;  rv cpu;&#xA;  rv_init(&amp;amp;cpu, (void *)mem, &amp;amp;load_cb, &amp;amp;store_cb);&#xA;  memcpy((void *)mem, (void *)program, sizeof(program));&#xA;  while (rv_step(&amp;amp;cpu) != RV_EECALL) {&#xA;  }&#xA;  printf(&#34;Environment call @ %08X: %u\n&#34;, cpu.pc, cpu.r[17]);&#xA;  return 0;&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Targeting &lt;code&gt;rv&lt;/code&gt;&lt;/h2&gt; &#xA;&lt;p&gt;Use &lt;a href=&#34;https://github.com/riscv-collab/riscv-gnu-toolchain&#34;&gt;riscv-gnu-toolchain&lt;/a&gt; with &lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/tools/link.ld&#34;&gt;tools/link.ld&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;p&gt;Suggested GCC commandline:&lt;/p&gt; &#xA;&lt;p&gt;&lt;code&gt;riscv64-unknown-elf-gcc example.S -nostdlib -nostartfiles -Tlink.ld -march=rv32imc -mabi=ilp32 -o example.o -e _start -g -no-pie&lt;/code&gt;&lt;/p&gt; &#xA;&lt;p&gt;To dump a binary starting at &lt;code&gt;0x80000000&lt;/code&gt; that can be directly loaded by &lt;code&gt;rv&lt;/code&gt; as in the above example:&lt;/p&gt; &#xA;&lt;p&gt;&lt;code&gt;riscv64-unknown-elf-objcopy -g -O binary example.o example.bin&lt;/code&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Instruction List&lt;/h2&gt; &#xA;&lt;p&gt;Click an instruction to see its implementation in &lt;code&gt;rv.c&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L419&#34;&gt;&lt;code&gt;add &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L419&#34;&gt;&lt;code&gt;addi &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L433&#34;&gt;&lt;code&gt;and &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L433&#34;&gt;&lt;code&gt;andi &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L505&#34;&gt;&lt;code&gt;auipc &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L375&#34;&gt;&lt;code&gt;beq &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L378&#34;&gt;&lt;code&gt;bge &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L380&#34;&gt;&lt;code&gt;bgtu &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L377&#34;&gt;&lt;code&gt;blt &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L379&#34;&gt;&lt;code&gt;bltu &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L376&#34;&gt;&lt;code&gt;bne &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L296&#34;&gt;&lt;code&gt;c.add &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L237&#34;&gt;&lt;code&gt;c.addi &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L244&#34;&gt;&lt;code&gt;c.addi16sp&lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L265&#34;&gt;&lt;code&gt;c.and &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L256&#34;&gt;&lt;code&gt;c.andi &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L275&#34;&gt;&lt;code&gt;c.beqz &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L277&#34;&gt;&lt;code&gt;c.bnez &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L273&#34;&gt;&lt;code&gt;c.j &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L239&#34;&gt;&lt;code&gt;c.jal &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L293&#34;&gt;&lt;code&gt;c.jalr &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L288&#34;&gt;&lt;code&gt;c.jr &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L241&#34;&gt;&lt;code&gt;c.li &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L246&#34;&gt;&lt;code&gt;c.lui &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L229&#34;&gt;&lt;code&gt;c.lw &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L285&#34;&gt;&lt;code&gt;c.lwsp &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L290&#34;&gt;&lt;code&gt;c.mv &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L263&#34;&gt;&lt;code&gt;c.or &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L283&#34;&gt;&lt;code&gt;c.slli &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L254&#34;&gt;&lt;code&gt;c.srai &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L252&#34;&gt;&lt;code&gt;c.srli &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L259&#34;&gt;&lt;code&gt;c.sub &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L231&#34;&gt;&lt;code&gt;c.sw &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L298&#34;&gt;&lt;code&gt;c.swsp &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L261&#34;&gt;&lt;code&gt;c.xor &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L481&#34;&gt;&lt;code&gt;csrrc &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L481&#34;&gt;&lt;code&gt;csrrci &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L475&#34;&gt;&lt;code&gt;csrrs &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L475&#34;&gt;&lt;code&gt;csrrsi &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L466&#34;&gt;&lt;code&gt;csrrw &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L466&#34;&gt;&lt;code&gt;csrrwi &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L451&#34;&gt;&lt;code&gt;div &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L453&#34;&gt;&lt;code&gt;divu &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L494&#34;&gt;&lt;code&gt;ebreak &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L491&#34;&gt;&lt;code&gt;ecall &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L397&#34;&gt;&lt;code&gt;fence &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L401&#34;&gt;&lt;code&gt;fence.i &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L405&#34;&gt;&lt;code&gt;jal &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L390&#34;&gt;&lt;code&gt;jalr &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L330&#34;&gt;&lt;code&gt;lb &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L338&#34;&gt;&lt;code&gt;lbu &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L333&#34;&gt;&lt;code&gt;lh &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L341&#34;&gt;&lt;code&gt;lhu &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L507&#34;&gt;&lt;code&gt;lui &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L336&#34;&gt;&lt;code&gt;lw &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L489&#34;&gt;&lt;code&gt;mret &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L438&#34;&gt;&lt;code&gt;mul &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L438&#34;&gt;&lt;code&gt;mulh &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L438&#34;&gt;&lt;code&gt;mulhsu &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L438&#34;&gt;&lt;code&gt;mulhu &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L431&#34;&gt;&lt;code&gt;or &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L431&#34;&gt;&lt;code&gt;ori &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L455&#34;&gt;&lt;code&gt;rem &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L457&#34;&gt;&lt;code&gt;remu &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L359&#34;&gt;&lt;code&gt;sb &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L361&#34;&gt;&lt;code&gt;sh &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L421&#34;&gt;&lt;code&gt;sll &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L421&#34;&gt;&lt;code&gt;slli &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L423&#34;&gt;&lt;code&gt;slt &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L423&#34;&gt;&lt;code&gt;slti &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L425&#34;&gt;&lt;code&gt;sltiu &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L425&#34;&gt;&lt;code&gt;sltu &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L429&#34;&gt;&lt;code&gt;sra &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L429&#34;&gt;&lt;code&gt;srai &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L429&#34;&gt;&lt;code&gt;srl &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L429&#34;&gt;&lt;code&gt;srli &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L419&#34;&gt;&lt;code&gt;sub &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L363&#34;&gt;&lt;code&gt;sw &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L427&#34;&gt;&lt;code&gt;xor &lt;/code&gt;&lt;/a&gt;&lt;a href=&#34;https://raw.githubusercontent.com/mnurzia/rv/main/rv.c#L427&#34;&gt;&lt;code&gt;xori &lt;/code&gt;&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Caveats&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Written in C89.&lt;/li&gt; &#xA; &lt;li&gt;Not actually written in C89, since it uses external names longer than 6 characters.&lt;/li&gt; &#xA; &lt;li&gt;Doesn&#39;t use any integer types larger than 32 bits, even for multiplication, because it&#39;s written in C89.&lt;/li&gt; &#xA; &lt;li&gt;Assumes width of integer types in a way that&#39;s not completely compliant with C89/99. Fix for this is coming soon, I&#39;m working on a watertight &lt;code&gt;&amp;lt;stdint.h&amp;gt;&lt;/code&gt; for C89.&lt;/li&gt; &#xA; &lt;li&gt;Written in C89.&lt;/li&gt; &#xA;&lt;/ul&gt;</summary>
  </entry>
</feed>