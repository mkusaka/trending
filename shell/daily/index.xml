<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub Shell Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2024-07-12T01:36:59Z</updated>
  <subtitle>Daily Trending of Shell in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>ckan/ckan-docker</title>
    <updated>2024-07-12T01:36:59Z</updated>
    <id>tag:github.com,2024-07-12:/ckan/ckan-docker</id>
    <link href="https://github.com/ckan/ckan-docker" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Scripts and images to run CKAN using Docker Compose&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;Docker Compose setup for CKAN&lt;/h1&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#1-overview&#34;&gt;1. Overview&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#2-installing-docker&#34;&gt;2. Installing Docker&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#3-docker-compose-vs-docker-compose&#34;&gt;3. docker compose vs docker-compose&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#4-install-build-and-run-ckan-plus-dependencies&#34;&gt;4. Install (build and run) CKAN plus dependencies&lt;/a&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#base-mode&#34;&gt;Base mode&lt;/a&gt;&lt;/li&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#development-mode&#34;&gt;Development mode&lt;/a&gt; &#xA;    &lt;ul&gt; &#xA;     &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#create-an-extension&#34;&gt;Create an extension&lt;/a&gt;&lt;/li&gt; &#xA;     &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#running-https-on-development-mode&#34;&gt;Running HTTPS on development mode&lt;/a&gt;&lt;/li&gt; &#xA;     &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#remote-debugging-with-vs-code&#34;&gt;Remote Debugging with VS Code&lt;/a&gt;&lt;/li&gt; &#xA;     &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#updating-the-environment-file-for-development-mode&#34;&gt;Updating the environment file for development mode&lt;/a&gt;&lt;/li&gt; &#xA;    &lt;/ul&gt; &lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#5-ckan-images&#34;&gt;5. CKAN images&lt;/a&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#extending-the-base-images&#34;&gt;Extending the base images&lt;/a&gt;&lt;/li&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#applying-patches&#34;&gt;Applying patches&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#6-debugging-with-pdb&#34;&gt;6. Debugging with pdb&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#7-datastore-and-datapusher&#34;&gt;7. Datastore and Datapusher&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#8-nginx&#34;&gt;8. NGINX&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#9-ckanext-envvars&#34;&gt;9. ckanext-envvars&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#10-CKAN_SITE_URL&#34;&gt;10. CKAN_SITE_URL&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#11-manage-new-users&#34;&gt;11. Manage new users&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#12-changing-the-base-image&#34;&gt;12. Changing the base image&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#13-replacing-datapusher-with-xLoader&#34;&gt;13. Replacing DataPusher with XLoader&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;1. Overview&lt;/h2&gt; &#xA;&lt;p&gt;This is a set of configuration and setup files to run a CKAN site.&lt;/p&gt; &#xA;&lt;p&gt;The CKAN images used are from the official CKAN &lt;a href=&#34;https://github.com/ckan/ckan-docker-base&#34;&gt;ckan-docker&lt;/a&gt; repo&lt;/p&gt; &#xA;&lt;p&gt;The non-CKAN images are as follows:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;DataPusher: CKAN&#39;s &lt;a href=&#34;https://github.com/ckan/ckan-base/tree/main/datapusher&#34;&gt;pre-configured DataPusher image&lt;/a&gt;.&lt;/li&gt; &#xA; &lt;li&gt;PostgreSQL: Official PostgreSQL image. Database files are stored in a named volume.&lt;/li&gt; &#xA; &lt;li&gt;Solr: CKAN&#39;s &lt;a href=&#34;https://github.com/ckan/ckan-solr&#34;&gt;pre-configured Solr image&lt;/a&gt;. Index data is stored in a named volume.&lt;/li&gt; &#xA; &lt;li&gt;Redis: standard Redis image&lt;/li&gt; &#xA; &lt;li&gt;NGINX: latest stable nginx image that includes SSL and Non-SSL endpoints&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;The site is configured using environment variables that you can set in the &lt;code&gt;.env&lt;/code&gt; file.&lt;/p&gt; &#xA;&lt;h2&gt;2. Installing Docker&lt;/h2&gt; &#xA;&lt;p&gt;Install Docker by following the following instructions: &lt;a href=&#34;https://docs.docker.com/engine/install/ubuntu/&#34;&gt;Install Docker Engine on Ubuntu&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p&gt;To verify a successful Docker installation, run &lt;code&gt;docker run hello-world&lt;/code&gt; and &lt;code&gt;docker version&lt;/code&gt;. These commands should output versions for client and server.&lt;/p&gt; &#xA;&lt;h2&gt;3. docker compose &lt;em&gt;vs&lt;/em&gt; docker-compose&lt;/h2&gt; &#xA;&lt;p&gt;All Docker Compose commands in this README will use the V2 version of Compose ie: &lt;code&gt;docker compose&lt;/code&gt;. The older version (V1) used the &lt;code&gt;docker-compose&lt;/code&gt; command. Please see &lt;a href=&#34;https://docs.docker.com/compose/compose-v2/&#34;&gt;Docker Compose&lt;/a&gt; for more information.&lt;/p&gt; &#xA;&lt;h2&gt;4. Install (build and run) CKAN plus dependencies&lt;/h2&gt; &#xA;&lt;h3&gt;Base mode&lt;/h3&gt; &#xA;&lt;p&gt;Use this if you are a maintainer and will not be making code changes to CKAN or to CKAN extensions&lt;/p&gt; &#xA;&lt;p&gt;Copy the included &lt;code&gt;.env.example&lt;/code&gt; and rename it to &lt;code&gt;.env&lt;/code&gt;. Modify it depending on your own needs.&lt;/p&gt; &#xA;&lt;p&gt;Please note that when accessing CKAN directly (via a browser) ie: not going through NGINX you will need to make sure you have &#34;ckan&#34; set up to be an alias to localhost in the local hosts file. Either that or you will need to change the &lt;code&gt;.env&lt;/code&gt; entry for &lt;code&gt;CKAN_SITE_URL&lt;/code&gt;&lt;/p&gt; &#xA;&lt;p&gt;Using the default values on the &lt;code&gt;.env.example&lt;/code&gt; file will get you a working CKAN instance. There is a sysadmin user created by default with the values defined in &lt;code&gt;CKAN_SYSADMIN_NAME&lt;/code&gt; and &lt;code&gt;CKAN_SYSADMIN_PASSWORD&lt;/code&gt;(&lt;code&gt;ckan_admin&lt;/code&gt; and &lt;code&gt;test1234&lt;/code&gt; by default). This should be obviously changed before running this setup as a public CKAN instance.&lt;/p&gt; &#xA;&lt;p&gt;To build the images:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;docker compose build&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;To start the containers:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;docker compose up&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;This will start up the containers in the current window. By default the containers will log direct to this window with each container using a different colour. You could also use the -d &#34;detach mode&#34; option ie: &lt;code&gt;docker compose up -d&lt;/code&gt; if you wished to use the current window for something else.&lt;/p&gt; &#xA;&lt;p&gt;At the end of the container start sequence there should be 6 containers running&lt;/p&gt; &#xA;&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/54408245/207012236-f9571baa-4d99-4ffe-bd93-30b11c4829e0.png&#34; alt=&#34;Screenshot 2022-12-12 at 10 36 21 am&#34;&gt;&lt;/p&gt; &#xA;&lt;p&gt;After this step, CKAN should be running at &lt;code&gt;CKAN_SITE_URL&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;h3&gt;Development mode&lt;/h3&gt; &#xA;&lt;p&gt;Use this mode if you are making code changes to CKAN and either creating new extensions or making code changes to existing extensions. This mode also uses the &lt;code&gt;.env&lt;/code&gt; file for config options.&lt;/p&gt; &#xA;&lt;p&gt;To develop local extensions use the &lt;code&gt;docker-compose.dev.yml&lt;/code&gt; file:&lt;/p&gt; &#xA;&lt;p&gt;To build the images:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;docker compose -f docker-compose.dev.yml build&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;To start the containers:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;docker compose -f docker-compose.dev.yml up&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;See &lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#5-ckan-images&#34;&gt;CKAN images&lt;/a&gt; for more details of what happens when using development mode.&lt;/p&gt; &#xA;&lt;h4&gt;Create an extension&lt;/h4&gt; &#xA;&lt;p&gt;You can use the ckan &lt;a href=&#34;https://docs.ckan.org/en/latest/extensions/tutorial.html#creating-a-new-extension&#34;&gt;extension&lt;/a&gt; instructions to create a CKAN extension, only executing the command inside the CKAN container and setting the mounted &lt;code&gt;src/&lt;/code&gt; folder as output:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;docker compose -f docker-compose.dev.yml exec ckan-dev /bin/sh -c &#34;ckan -c /srv/app/ckan.ini generate extension --output-dir /srv/app/src_extensions&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/54408245/220623568-b4e074c7-6d07-4d27-ae29-35ce70961463.png&#34; alt=&#34;Screenshot 2023-02-22 at 1 45 55 pm&#34;&gt;&lt;/p&gt; &#xA;&lt;p&gt;The new extension files and directories are created in the &lt;code&gt;/srv/app/src_extensions/&lt;/code&gt; folder in the running container. They will also exist in the local src/ directory as local &lt;code&gt;/src&lt;/code&gt; directory is mounted as &lt;code&gt;/srv/app/src_extensions/&lt;/code&gt; on the ckan container. You might need to change the owner of its folder to have the appropiate permissions.&lt;/p&gt; &#xA;&lt;h4&gt;Running HTTPS on development mode&lt;/h4&gt; &#xA;&lt;p&gt;Sometimes is useful to run your local development instance under HTTPS, for instance if you are using authentication extensions like &lt;a href=&#34;https://github.com/keitaroinc/ckanext-saml2auth&#34;&gt;ckanext-saml2auth&lt;/a&gt;. To enable it, set the following in your &lt;code&gt;.env&lt;/code&gt; file:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;  USE_HTTPS_FOR_DEV=true&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;and update the site URL setting:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;  CKAN_SITE_URL=https://localhost:5000&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;After recreating the &lt;code&gt;ckan-dev&lt;/code&gt; container, you should be able to access CKAN at &lt;a href=&#34;https://localhost:5000&#34;&gt;https://localhost:5000&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h4&gt;Remote Debugging with VS Code&lt;/h4&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://code.visualstudio.com/&#34;&gt;Visual Studio Code&lt;/a&gt; is a free IDE that includes remote debugging for Python applications. To debug CKAN you must enable &lt;code&gt;debugpy&lt;/code&gt; for your development instance in your &lt;code&gt;.env&lt;/code&gt; file:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;  USE_DEBUGPY_FOR_DEV=true&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Then start the containers in &lt;a href=&#34;https://raw.githubusercontent.com/ckan/ckan-docker/master/#development-mode&#34;&gt;development mode&lt;/a&gt; and launch VS Code.&lt;/p&gt; &#xA;&lt;p&gt;In VS Code:&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt;Install the &#34;Dev Container&#34; extension: press CTRL+SHIFT+X, type &#34;dev container&#34;, click &#34;install&#34;&lt;/li&gt; &#xA; &lt;li&gt;Click the &#34;Open a Remote Window&#34; button in the bottom-left of the VS Code window&lt;/li&gt; &#xA; &lt;li&gt;Click &#34;Attach to Running Container...&#34; and select your ckan-dev container, e.g. &#34;ckan-docker-ckan-dev-1&#34;&lt;/li&gt; &#xA; &lt;li&gt;Click the &#34;Run and Debug&#34; icon on the left panel then &#34;create a launch.json&#34;, select &#34;Python Debugger&#34;, &#34;Remote Attach&#34;, host &#34;localhost&#34; and port &#34;5678&#34;&lt;/li&gt; &#xA; &lt;li&gt;Press F5 or click the &#34;Run&#34; menu and &#34;Start Debugging&#34;&lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;p&gt;You can now set breakpoints and remote debug your CKAN development instance.&lt;/p&gt; &#xA;&lt;h4&gt;Updating the environment file for development mode&lt;/h4&gt; &#xA;&lt;p&gt;The Docker Compose environment &lt;code&gt;.env&lt;/code&gt; file by default is set up for production mode. There are a few changes needed if you would like to run in Development mode:&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt;Change the &lt;code&gt;CKAN_SITE_URL&lt;/code&gt; variable to be: &lt;a href=&#34;http://localhost:5000&#34;&gt;http://localhost:5000&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;Update the &lt;code&gt;CKAN__DATAPUSHER__CALLBACK_URL_BASE&lt;/code&gt; variable to use the &lt;code&gt;ckan-dev&lt;/code&gt; container name: &lt;a href=&#34;http://ckan-dev:5000&#34;&gt;http://ckan-dev:5000&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;Update the &lt;code&gt;DATAPUSHER_REWRITE_URL&lt;/code&gt; variable to also use the &lt;code&gt;ckan-dev&lt;/code&gt; container name &lt;a href=&#34;http://ckan-dev:5000&#34;&gt;http://ckan-dev:5000&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;h2&gt;5. CKAN images&lt;/h2&gt; &#xA;&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/54408245/207079416-a01235af-2dea-4425-b6fd-f8c3687dd993.png&#34; alt=&#34;ckan images&#34;&gt;&lt;/p&gt; &#xA;&lt;p&gt;The Docker image config files used to build your CKAN project are located in the &lt;code&gt;ckan/&lt;/code&gt; folder. There are two Docker files:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Dockerfile&lt;/code&gt;: this is based on &lt;code&gt;ckan/ckan-base:&amp;lt;version&amp;gt;&lt;/code&gt;, a base image located in the DockerHub repository, that has CKAN installed along with all its dependencies, properly configured and running on &lt;a href=&#34;https://uwsgi-docs.readthedocs.io/en/latest/&#34;&gt;uWSGI&lt;/a&gt; (production setup)&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Dockerfile.dev&lt;/code&gt;: this is based on &lt;code&gt;ckan/ckan-base:&amp;lt;version&amp;gt;-dev&lt;/code&gt; also located located in the DockerHub repository, and extends &lt;code&gt;ckan/ckan-base:&amp;lt;version&amp;gt;&lt;/code&gt; to include:&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Any extension cloned on the &lt;code&gt;src&lt;/code&gt; folder will be installed in the CKAN container when booting up Docker Compose (&lt;code&gt;docker compose up&lt;/code&gt;). This includes installing any requirements listed in a &lt;code&gt;requirements.txt&lt;/code&gt; (or &lt;code&gt;pip-requirements.txt&lt;/code&gt;) file and running &lt;code&gt;python setup.py develop&lt;/code&gt;.&lt;/li&gt; &#xA;   &lt;li&gt;CKAN is started running this: &lt;code&gt;/usr/bin/ckan -c /srv/app/ckan.ini run -H 0.0.0.0&lt;/code&gt;.&lt;/li&gt; &#xA;   &lt;li&gt;Make sure to add the local plugins to the &lt;code&gt;CKAN__PLUGINS&lt;/code&gt; env var in the &lt;code&gt;.env&lt;/code&gt; file.&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Any custom changes to the scripts run during container start up can be made to scripts in the &lt;code&gt;setup/&lt;/code&gt; directory. For instance if you wanted to change the port on which CKAN runs you would need to make changes to the Docker Compose yaml file, and the &lt;code&gt;start_ckan.sh.override&lt;/code&gt; file. Then you would need to add the following line to the Dockerfile ie: &lt;code&gt;COPY setup/start_ckan.sh.override ${APP_DIR}/start_ckan.sh&lt;/code&gt;. The &lt;code&gt;start_ckan.sh&lt;/code&gt; file in the locally built image would override the &lt;code&gt;start_ckan.sh&lt;/code&gt; file included in the base image&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Extending the base images&lt;/h3&gt; &#xA;&lt;p&gt;The CKAN base images are built from &lt;a href=&#34;https://github.com/ckan/ckan-docker-base/&#34;&gt;https://github.com/ckan/ckan-docker-base/&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p&gt;You can modify the docker files to build your own customized image tailored to your project, installing any extensions and extra requirements needed. For example here is where you would update to use a different CKAN base image ie: &lt;code&gt;ckan/ckan-base:&amp;lt;new version&amp;gt;&lt;/code&gt;&lt;/p&gt; &#xA;&lt;p&gt;To perform extra initialization steps you can add scripts to your custom images and copy them to the &lt;code&gt;/docker-entrypoint.d&lt;/code&gt; folder (The folder should be created for you when you build the image). Any &lt;code&gt;*.sh&lt;/code&gt; and &lt;code&gt;*.py&lt;/code&gt; file in that folder will be executed just after the main initialization script (&lt;a href=&#34;https://github.com/ckan/ckan-docker-base/raw/main/ckan-2.9/base/setup/prerun.py&#34;&gt;&lt;code&gt;prerun.py&lt;/code&gt;&lt;/a&gt;) is executed and just before the web server and supervisor processes are started.&lt;/p&gt; &#xA;&lt;p&gt;For instance, consider the following custom image:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;ckan&#xA;├── docker-entrypoint.d&#xA;│   └── setup_validation.sh&#xA;├── Dockerfile&#xA;└── Dockerfile.dev&#xA;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;We want to install an extension like &lt;a href=&#34;https://github.com/frictionlessdata/ckanext-validation&#34;&gt;ckanext-validation&lt;/a&gt; that needs to create database tables on startup time. We create a &lt;code&gt;setup_validation.sh&lt;/code&gt; script in a &lt;code&gt;docker-entrypoint.d&lt;/code&gt; folder with the necessary commands:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#!/bin/bash&#xA;&#xA;# Create DB tables if not there&#xA;ckan -c /srv/app/ckan.ini validation init-db &#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;And then in our &lt;code&gt;Dockerfile.dev&lt;/code&gt; file we install the extension and copy the initialization scripts:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-Dockerfile&#34;&gt;FROM ckan/ckan-base:2.9.7-dev&#xA;&#xA;RUN pip install -e git+https://github.com/frictionlessdata/ckanext-validation.git#egg=ckanext-validation &amp;amp;&amp;amp; \&#xA;    pip install -r https://raw.githubusercontent.com/frictionlessdata/ckanext-validation/master/requirements.txt&#xA;&#xA;COPY docker-entrypoint.d/* /docker-entrypoint.d/&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;NB: There are a number of extension examples commented out in the Dockerfile.dev file&lt;/p&gt; &#xA;&lt;h3&gt;Applying patches&lt;/h3&gt; &#xA;&lt;p&gt;When building your project specific CKAN images (the ones defined in the &lt;code&gt;ckan/&lt;/code&gt; folder), you can apply patches to CKAN core or any of the built extensions. To do so create a folder inside &lt;code&gt;ckan/patches&lt;/code&gt; with the name of the package to patch (ie &lt;code&gt;ckan&lt;/code&gt; or &lt;code&gt;ckanext-??&lt;/code&gt;). Inside you can place patch files that will be applied when building the images. The patches will be applied in alphabetical order, so you can prefix them sequentially if necessary.&lt;/p&gt; &#xA;&lt;p&gt;For instance, check the following example image folder:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;ckan&#xA;├── patches&#xA;│   ├── ckan&#xA;│   │   ├── 01_datasets_per_page.patch&#xA;│   │   ├── 02_groups_per_page.patch&#xA;│   │   ├── 03_or_filters.patch&#xA;│   └── ckanext-harvest&#xA;│       └── 01_resubmit_objects.patch&#xA;├── setup&#xA;├── Dockerfile&#xA;└── Dockerfile.dev&#xA;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;6. Debugging with pdb&lt;/h2&gt; &#xA;&lt;p&gt;Add these lines to the &lt;code&gt;ckan-dev&lt;/code&gt; service in the docker-compose.dev.yml file&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;ports:&#xA;  - &#34;0.0.0.0:${CKAN_PORT}:5000&#34;&#xA;&#xA;stdin_open: true&#xA;tty: true&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Debug with pdb (example) - Interact with &lt;code&gt;docker attach $(docker container ls -qf name=ckan)&lt;/code&gt;&lt;/p&gt; &#xA;&lt;p&gt;command: &lt;code&gt;python -m pdb /usr/lib/ckan/venv/bin/ckan --config /srv/app/ckan.ini run --host 0.0.0.0 --passthrough-errors&lt;/code&gt;&lt;/p&gt; &#xA;&lt;h2&gt;7. Datastore and datapusher&lt;/h2&gt; &#xA;&lt;p&gt;The Datastore database and user is created as part of the entrypoint scripts for the db container. There is also a Datapusher container running the latest version of Datapusher.&lt;/p&gt; &#xA;&lt;h2&gt;8. NGINX&lt;/h2&gt; &#xA;&lt;p&gt;The base Docker Compose configuration uses an NGINX image as the front-end (ie: reverse proxy). It includes HTTPS running on port number 8443. A &#34;self-signed&#34; SSL certificate is generated as part of the ENTRYPOINT. The NGINX &lt;code&gt;server_name&lt;/code&gt; directive and the &lt;code&gt;CN&lt;/code&gt; field in the SSL certificate have been both set to &#39;localhost&#39;. This should obviously not be used for production.&lt;/p&gt; &#xA;&lt;p&gt;Creating the SSL cert and key files as follows: &lt;code&gt;openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 -subj &#34;/C=DE/ST=Berlin/L=Berlin/O=None/CN=localhost&#34; -keyout ckan-local.key -out ckan-local.crt&lt;/code&gt; The &lt;code&gt;ckan-local.*&lt;/code&gt; files will then need to be moved into the nginx/setup/ directory&lt;/p&gt; &#xA;&lt;h2&gt;9. ckanext-envvars&lt;/h2&gt; &#xA;&lt;p&gt;The ckanext-envvars extension is used in the CKAN Docker base repo to build the base images. This extension checks for environmental variables conforming to an expected format and updates the corresponding CKAN config settings with its value.&lt;/p&gt; &#xA;&lt;p&gt;For the extension to correctly identify which env var keys map to the format used for the config object, env var keys should be formatted in the following way:&lt;/p&gt; &#xA;&lt;p&gt;All uppercase&lt;br&gt; Replace periods (&#39;.&#39;) with two underscores (&#39;__&#39;)&lt;br&gt; Keys must begin with &#39;CKAN&#39; or &#39;CKANEXT&#39;, if they do not you can prepend them with &#39;&lt;code&gt;CKAN___&lt;/code&gt;&#39;&lt;/p&gt; &#xA;&lt;p&gt;For example:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;code&gt;CKAN__PLUGINS=&#34;envvars image_view text_view recline_view datastore datapusher&#34;&lt;/code&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;CKAN__DATAPUSHER__CALLBACK_URL_BASE=http://ckan:5000&lt;/code&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;CKAN___BEAKER__SESSION__SECRET=CHANGE_ME&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;These parameters can be added to the &lt;code&gt;.env&lt;/code&gt; file&lt;/p&gt; &#xA;&lt;p&gt;For more information please see &lt;a href=&#34;https://github.com/okfn/ckanext-envvars&#34;&gt;ckanext-envvars&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h2&gt;10. CKAN_SITE_URL&lt;/h2&gt; &#xA;&lt;p&gt;For convenience the CKAN_SITE_URL parameter should be set in the .env file. For development it can be set to &lt;a href=&#34;http://localhost:5000&#34;&gt;http://localhost:5000&lt;/a&gt; and non-development set to &lt;a href=&#34;https://localhost:8443&#34;&gt;https://localhost:8443&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h2&gt;11. Manage new users&lt;/h2&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt; &lt;p&gt;Create a new user from the Docker host, for example to create a new user called &#39;admin&#39;&lt;/p&gt; &lt;p&gt;&lt;code&gt;docker exec -it &amp;lt;container-id&amp;gt; ckan -c ckan.ini user add admin email=admin@localhost&lt;/code&gt;&lt;/p&gt; &lt;p&gt;To delete the &#39;admin&#39; user&lt;/p&gt; &lt;p&gt;&lt;code&gt;docker exec -it &amp;lt;container-id&amp;gt; ckan -c ckan.ini user remove admin&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Create a new user from within the ckan container. You will need to get a session on the running container&lt;/p&gt; &lt;p&gt;&lt;code&gt;ckan -c ckan.ini user add admin email=admin@localhost&lt;/code&gt;&lt;/p&gt; &lt;p&gt;To delete the &#39;admin&#39; user&lt;/p&gt; &lt;p&gt;&lt;code&gt;ckan -c ckan.ini user remove admin&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;h2&gt;12. Changing the base image&lt;/h2&gt; &#xA;&lt;p&gt;The base image used in the CKAN Dockerfile and Dockerfile.dev can be changed so a different DockerHub image is used eg: ckan/ckan-base:2.9.9 could be used instead of ckan/ckan-base:2.10.1&lt;/p&gt; &#xA;&lt;h2&gt;13. Replacing DataPusher with XLoader&lt;/h2&gt; &#xA;&lt;p&gt;Check out the wiki page for this: &lt;a href=&#34;https://github.com/ckan/ckan-docker/wiki/Replacing-DataPusher-with-XLoader&#34;&gt;https://github.com/ckan/ckan-docker/wiki/Replacing-DataPusher-with-XLoader&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Copying and License&lt;/h2&gt; &#xA;&lt;p&gt;This material is copyright (c) 2006-2023 Open Knowledge Foundation and contributors.&lt;/p&gt; &#xA;&lt;p&gt;It is open and licensed under the GNU Affero General Public License (AGPL) v3.0 whose full text may be found at:&lt;/p&gt; &#xA;&lt;p&gt;&lt;a href=&#34;http://www.fsf.org/licensing/licenses/agpl-3.0.html&#34;&gt;http://www.fsf.org/licensing/licenses/agpl-3.0.html&lt;/a&gt;&lt;/p&gt;</summary>
  </entry>
</feed>