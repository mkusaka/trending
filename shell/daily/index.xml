<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub Shell Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2025-02-23T01:38:10Z</updated>
  <subtitle>Daily Trending of Shell in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>itdoginfo/podkop</title>
    <updated>2025-02-23T01:38:10Z</updated>
    <id>tag:github.com,2025-02-23:/itdoginfo/podkop</id>
    <link href="https://github.com/itdoginfo/podkop" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Dev podkop&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;Вещи, которые вам нужно знать перед установкой&lt;/h1&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Это альфа версия, которая находится в активной разработке. Из версии в версию что-то может меняться.&lt;/li&gt; &#xA; &lt;li&gt;Основной функционал работает, но побочные штуки сейчас могут сбоить.&lt;/li&gt; &#xA; &lt;li&gt;При обновлении &lt;strong&gt;обязатально&lt;/strong&gt; сбрасывайте кэш LuCI.&lt;/li&gt; &#xA; &lt;li&gt;Также при обновлении всегда заходите в конфигурацию и проверяйте свои настройки. Конфигурация может измениться.&lt;/li&gt; &#xA; &lt;li&gt;Необходимо минимум 15МБ свободного места на роутере. Роутерами с флешками на 16МБ сразу мимо.&lt;/li&gt; &#xA; &lt;li&gt;При старте программы редактируется конфиг Dnsmasq.&lt;/li&gt; &#xA; &lt;li&gt;Podkop редактирует конфиг sing-box. Обязательно сохраните ваш конфиг sing-box перед установкой, если он вам нужен.&lt;/li&gt; &#xA; &lt;li&gt;Информация здесь может быть устаревшей. Все изменения фиксируются в телеграм-чате &lt;a href=&#34;https://t.me/itdogchat&#34;&gt;https://t.me/itdogchat&lt;/a&gt; - топик &lt;strong&gt;Podkop&lt;/strong&gt;.&lt;/li&gt; &#xA; &lt;li&gt;Если у вас не что-то не работает, то следуюет сходить в телеграм чат, прочитать закрепы и выполнить что там написано..&lt;/li&gt; &#xA; &lt;li&gt;Если у вас установлен Getdomains, его следует удалить.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h1&gt;Удаление GetDomains скриптом&lt;/h1&gt; &#xA;&lt;pre&gt;&lt;code&gt;sh &amp;lt;(wget -O - https://raw.githubusercontent.com/itdoginfo/domain-routing-openwrt/refs/heads/master/getdomains-uninstall.sh)&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Оставляет туннели, зоны, forwarding. А также stubby и dnscrypt. Они не помешают. Конфиг sing-box будет перезаписан в podkop.&lt;/p&gt; &#xA;&lt;h1&gt;Установка Podkop&lt;/h1&gt; &#xA;&lt;p&gt;Пакет работает на всех архитектурах. Тестировался на &lt;strong&gt;ванильной&lt;/strong&gt; OpenWrt 23.05 и OpenWrt 24.10. На FriendlyWrt 23.05 присуствуют зависимости от iptables, которые ломают tproxy. Если у вас появляется warning про это в логах, следуйте инструкции по приведённой там ссылке.&lt;/p&gt; &#xA;&lt;p&gt;Поддержки APK на данный момент нет. APK будет сделан после того как разгребу основное.&lt;/p&gt; &#xA;&lt;h2&gt;Автоматическая&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code&gt;sh &amp;lt;(wget -O - https://raw.githubusercontent.com/itdoginfo/podkop/refs/heads/main/install.sh)&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Скрипт также предложит выбрать, какой туннель будет использоваться. Для выбранного туннеля будут установлены нужные пакеты, а для Wireguard и AmneziaWG также будет предложена автоматическая настройка - прямо в консоли скрипт запросит данные конфига. Для AmneziaWG можно также выбрать вариант с использованием конфига обычного Wireguard и автоматической обфускацией до AmneziaWG.&lt;/p&gt; &#xA;&lt;p&gt;Для AmneziaWG скрипт проверяет наличие пакетов под вашу платформу в &lt;a href=&#34;https://github.com/Slava-Shchipunov/awg-openwrt/releases&#34;&gt;стороннем репозитории&lt;/a&gt;, так как в официальном репозитории OpenWRT они отсутствуют, и автоматически их устанавливает.&lt;/p&gt; &#xA;&lt;h2&gt;Вручную&lt;/h2&gt; &#xA;&lt;p&gt;Сделать &lt;code&gt;opkg update&lt;/code&gt;, чтоб установились зависимости. Скачать пакеты &lt;code&gt;podkop_*.ipk&lt;/code&gt; и &lt;code&gt;luci-app-podkop_*.ipk&lt;/code&gt; из релиза. &lt;code&gt;opkg install&lt;/code&gt; сначала первый, потом второй.&lt;/p&gt; &#xA;&lt;h1&gt;Обновление&lt;/h1&gt; &#xA;&lt;p&gt;Та же самая команда, что для установки. Скрипт обнаружит уже установленный podkop и предложит обновиться.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;sh &amp;lt;(wget -O - https://raw.githubusercontent.com/itdoginfo/podkop/refs/heads/main/install.sh)&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h1&gt;Удаление&lt;/h1&gt; &#xA;&lt;pre&gt;&lt;code&gt;opkg remove luci-i18n-podkop-ru luci-app-podkop podkop&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Если был установлен русский язык&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;opkg remove luci-i18n-podkop-ru&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h1&gt;Использование&lt;/h1&gt; &#xA;&lt;p&gt;Конфиг: /etc/config/podkop&lt;/p&gt; &#xA;&lt;p&gt;Luci: Services/podkop&lt;/p&gt; &#xA;&lt;h2&gt;Режимы&lt;/h2&gt; &#xA;&lt;h3&gt;Proxy&lt;/h3&gt; &#xA;&lt;p&gt;Для VLESS и Shadowsocks. Другие протоколы тоже будут, кидайте в чат примеры строк без чувствительных данных.&lt;/p&gt; &#xA;&lt;p&gt;В этом режиме просто копируйте строку в &lt;strong&gt;Proxy String&lt;/strong&gt; и из неё автоматически настроится sing-box.&lt;/p&gt; &#xA;&lt;h3&gt;VPN&lt;/h3&gt; &#xA;&lt;p&gt;Здесь у вас должен быть уже настроен WG/OpenVPN/OpenConnect etc, зона Zone и Forwarding не обязательны.&lt;/p&gt; &#xA;&lt;p&gt;Просто выбрать интерфейс из списка.&lt;/p&gt; &#xA;&lt;h2&gt;Настройка доменов и подсетей&lt;/h2&gt; &#xA;&lt;p&gt;&lt;strong&gt;Community Lists&lt;/strong&gt; - Включить списки комьюнити&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;Subnets list enable&lt;/strong&gt; - Включить подсети из общего списка, выбрать из предложенных.&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;Custom domains enable&lt;/strong&gt; - Добавить свои домены&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;Custom subnets enable&lt;/strong&gt; - Добавить подсети или IP-адреса. Для подсетей задать маску.&lt;/p&gt; &#xA;&lt;h1&gt;Известные баги&lt;/h1&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Не отрабатывает service podkop stop, если podkop запущен и не может, к пример, зарезолвить домен с сломанным DNS&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Update list из remote url domain не удаляет старые домены. А добавляет новые. Для подсетей тоже самое скорее всего. Пересоздавать ruleset?&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h1&gt;ToDo&lt;/h1&gt; &#xA;&lt;p&gt;Этот раздел не означает задачи, которые нужно брать и делать. Это общий список хотелок. Если вы хотите помочь, пожалуйста, спросите сначала в телеграмме.&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Проверка, что версия в makefile совпадает с тегом&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Диагностика: Proxy check completed successfully предположительно не показывает IP, если вернулся это IPv6.&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Сделать галку запрещающую подкопу редачить dhcp. Допилить в исключение вместе с пустыми полями proxy и vpn&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Обработка ошибки &lt;code&gt;sing-box[9345]: FATAL[0000] start service: initialize DNS rule[2]: rule-set not found: main&lt;/code&gt;. Когда не задана строка\интерфейс&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;Низкий приоритет&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Галочка, которая режет доступ к doh серверам&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Свой конфиг sing-box&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; IPv6. Только после наполнения Wiki&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;Рефактор&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Handle для sing-box&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Handle для dnsmasq&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Формирование json для sing-box на уровне jq, а не шаблонов&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Unit тесты (BATS)&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; disabled&gt; Интеграционые тесты бекенда (OpenWrt rootfs + BATS)&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h1&gt;Разработка&lt;/h1&gt; &#xA;&lt;p&gt;Есть два варианта:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Просто поставить пакет на роутер или виртуалку и прям редактировать через SFTP (opkg install openssh-sftp-server)&lt;/li&gt; &#xA; &lt;li&gt;SDK, чтоб собирать пакеты&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;Для сборки пакетов нужен SDK, один из вариантов скачать прям файл и разархивировать &lt;a href=&#34;https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/&#34;&gt;https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/&lt;/a&gt; Нужен файл с SDK в имени&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;wget https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/openwrt-sdk-23.05.5-x86-64_gcc-12.3.0_musl.Linux-x86_64.tar.xz&#xA;tar xf openwrt-sdk-23.05.5-x86-64_gcc-12.3.0_musl.Linux-x86_64.tar.xz&#xA;mv openwrt-sdk-23.05.5-x86-64_gcc-12.3.0_musl.Linux-x86_64 SDK&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Последнее для удобства.&lt;/p&gt; &#xA;&lt;p&gt;Создаём директорию для пакета&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;mkdir package/utilites&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Симлинк из репозитория&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;ln -s ~/podkop/podkop package/utilites/podkop&#xA;ln -s ~/podkop/luci-app-podkop package/luci-app-podkop&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;В первый раз для сборки luci-app необходимо обновить пакеты&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;./scripts/feeds update -a&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Для make можно добавить флаг -j N, где N - количество ядер для сборки. Первый раз пройдёт быстрее.&lt;/p&gt; &#xA;&lt;p&gt;При первом make выводится менюшка, можно просто save, exit и всё. Первый раз долго грузит зависимости.&lt;/p&gt; &#xA;&lt;p&gt;Сборка пакета. Сами пакеты собираются быстро.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;make package/podkop/{clean,compile} V=s&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Также для luci&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;make package/luci-app-podkop/{clean,compile} V=s&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;.ipk лежат в &lt;code&gt;bin/packages/x86_64/base/&lt;/code&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Примеры строкs&lt;/h2&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/itdoginfo/podkop/raw/main/String-example.md&#34;&gt;https://github.com/itdoginfo/podkop/blob/main/String-example.md&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Ошибки&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code&gt;Makefile:17: /SDK/feeds/luci/luci.mk: No such file or directory&#xA;make[2]: *** No rule to make target &#39;/SDK/feeds/luci/luci.mk&#39;.  Stop.&#xA;time: package/luci/luci-app-podkop/clean#0.00#0.00#0.00&#xA;    ERROR: package/luci/luci-app-podkop failed to build.&#xA;make[1]: *** [package/Makefile:129: package/luci/luci-app-podkop/clean] Error 1&#xA;make[1]: Leaving directory &#39;/SDK&#39;&#xA;make: *** [/SDK/include/toplevel.mk:226: package/luci-app-podkop/clean] Error 2&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Не загружены пакеты для luci&lt;/p&gt; &#xA;&lt;h2&gt;make зависимости&lt;/h2&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://openwrt.org/docs/guide-developer/toolchain/install-buildsystem&#34;&gt;https://openwrt.org/docs/guide-developer/toolchain/install-buildsystem&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p&gt;Ubuntu&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;sudo apt update&#xA;sudo apt install build-essential clang flex bison g++ gawk \&#xA;gcc-multilib g++-multilib gettext git libncurses-dev libssl-dev \&#xA;python3-distutils rsync unzip zlib1g-dev file wget&#xA;&lt;/code&gt;&lt;/pre&gt;</summary>
  </entry>
</feed>