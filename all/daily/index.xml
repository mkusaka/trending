<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub All Languages Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2023-09-25T01:23:55Z</updated>
  <subtitle>Daily Trending of All Languages in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>ChenyangSi/FreeU</title>
    <updated>2023-09-25T01:23:55Z</updated>
    <id>tag:github.com,2023-09-25:/ChenyangSi/FreeU</id>
    <link href="https://github.com/ChenyangSi/FreeU" rel="alternate"></link>
    <summary type="html">&lt;p&gt;FreeU: Free Lunch in Diffusion U-Net&lt;/p&gt;&lt;hr&gt;&lt;div align=&#34;center&#34;&gt; &#xA; &lt;h1&gt;FreeU: Free Lunch in Diffusion U-Net&lt;/h1&gt; &#xA; &lt;div&gt; &#xA;  &lt;a href=&#34;https://chenyangsi.github.io/&#34; target=&#34;_blank&#34;&gt;Chenyang Si&lt;/a&gt;&#xA;  &lt;sup&gt;&lt;/sup&gt;, &#xA;  &lt;a href=&#34;https://ziqihuangg.github.io/&#34; target=&#34;_blank&#34;&gt;Ziqi Huang&lt;/a&gt;&#xA;  &lt;sup&gt;&lt;/sup&gt;, &#xA;  &lt;a href=&#34;https://yumingj.github.io/&#34; target=&#34;_blank&#34;&gt;Yuming Jiang&lt;/a&gt;&#xA;  &lt;sup&gt;&lt;/sup&gt;, &#xA;  &lt;a href=&#34;https://liuziwei7.github.io/&#34; target=&#34;_blank&#34;&gt;Ziwei Liu&lt;/a&gt;&#xA;  &lt;sup&gt;&lt;/sup&gt; &#xA; &lt;/div&gt; &#xA; &lt;div&gt; &#xA;  &lt;sup&gt;&lt;/sup&gt;S-Lab, Nanyang Technological University &#xA; &lt;/div&gt; &#xA; &lt;p&gt;&lt;a href=&#34;https://arxiv.org/pdf/2309.11497.pdf&#34;&gt;Paper&lt;/a&gt; | &lt;a href=&#34;https://chenyangsi.top/FreeU/&#34;&gt;Project Page&lt;/a&gt; | &lt;a href=&#34;https://www.youtube.com/watch?v=-CZ5uWxvX30&amp;amp;t=2s&#34;&gt;Video&lt;/a&gt; &lt;br&gt;&lt;/p&gt; &#xA; &lt;p&gt;&lt;strong&gt;We propose FreeU, a method that substantially improves diffusion model sample quality at no costs: no training, no additional parameter introduced, and no increase in memory or sampling time.&lt;/strong&gt;&lt;/p&gt; &#xA; &lt;div style=&#34;width: 100%; text-align: center; margin:auto;&#34;&gt; &#xA;  &lt;img style=&#34;width:100%&#34; src=&#34;https://raw.githubusercontent.com/ChenyangSi/FreeU/main/readme_teaser.jpg&#34;&gt; &#xA; &lt;/div&gt; &#xA; &lt;p&gt;&lt;span&gt;ðŸ“–&lt;/span&gt; For more visual results, go checkout our &lt;a href=&#34;https://chenyangsi.top/FreeU/&#34; target=&#34;_blank&#34;&gt;project page&lt;/a&gt;&lt;/p&gt; &#xA;&lt;/div&gt; &#xA;&lt;h2&gt;FreeU Code&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def Fourier_filter(x, threshold, scale):&#xA;    # FFT&#xA;    x_freq = fft.fftn(x, dim=(-2, -1))&#xA;    x_freq = fft.fftshift(x_freq, dim=(-2, -1))&#xA;    &#xA;    B, C, H, W = x_freq.shape&#xA;    mask = torch.ones((B, C, H, W)).cuda() &#xA;&#xA;    crow, ccol = H // 2, W //2&#xA;    mask[..., crow - threshold:crow + threshold, ccol - threshold:ccol + threshold] = scale&#xA;    x_freq = x_freq * mask&#xA;&#xA;    # IFFT&#xA;    x_freq = fft.ifftshift(x_freq, dim=(-2, -1))&#xA;    x_filtered = fft.ifftn(x_freq, dim=(-2, -1)).real&#xA;    &#xA;    return x_filtered&#xA;&#xA;class Free_UNetModel(UNetModel):&#xA;    &#34;&#34;&#34;&#xA;    :param b1: backbone factor of the first stage block of decoder.&#xA;    :param b2: backbone factor of the second stage block of decoder.&#xA;    :param s1: skip factor of the first stage block of decoder.&#xA;    :param s2: skip factor of the second stage block of decoder.&#xA;    &#34;&#34;&#34;&#xA;&#xA;    def __init__(&#xA;        self,&#xA;        b1,&#xA;        b2,&#xA;        s1,&#xA;        s2,&#xA;        *args,&#xA;        **kwargs&#xA;    ):&#xA;        super().__init__(*args, **kwargs)&#xA;        self.b1 = b1 &#xA;        self.b2 = b2&#xA;        self.s1 = s1&#xA;        self.s2 = s2&#xA;&#xA;    def forward(self, x, timesteps=None, context=None, y=None, **kwargs):&#xA;        &#34;&#34;&#34;&#xA;        Apply the model to an input batch.&#xA;        :param x: an [N x C x ...] Tensor of inputs.&#xA;        :param timesteps: a 1-D batch of timesteps.&#xA;        :param context: conditioning plugged in via crossattn&#xA;        :param y: an [N] Tensor of labels, if class-conditional.&#xA;        :return: an [N x C x ...] Tensor of outputs.&#xA;        &#34;&#34;&#34;&#xA;        assert (y is not None) == (&#xA;            self.num_classes is not None&#xA;        ), &#34;must specify y if and only if the model is class-conditional&#34;&#xA;        hs = []&#xA;        t_emb = timestep_embedding(timesteps, self.model_channels, repeat_only=False)&#xA;        emb = self.time_embed(t_emb)&#xA;&#xA;        if self.num_classes is not None:&#xA;            assert y.shape[0] == x.shape[0]&#xA;            emb = emb + self.label_emb(y)&#xA;&#xA;        h = x.type(self.dtype)&#xA;        for module in self.input_blocks:&#xA;            h = module(h, emb, context)&#xA;            hs.append(h)&#xA;        h = self.middle_block(h, emb, context)&#xA;        for module in self.output_blocks:&#xA;            hs_ = hs.pop()&#xA;&#xA;            # --------------- FreeU code -----------------------&#xA;            # Only operate on the first two stages&#xA;            if h.shape[1] == 1280:&#xA;                h[:,:640] = h[:,:640] * self.b1&#xA;                hs_ = Fourier_filter(hs_, threshold=1, scale=self.s1)&#xA;            if h.shape[1] == 640:&#xA;                h[:,:320] = h[:,:320] * self.b2&#xA;                hs_ = Fourier_filter(hs_, threshold=1, scale=self.s2)&#xA;            # ---------------------------------------------------------&#xA;&#xA;            h = th.cat([h, hs_], dim=1)&#xA;            h = module(h, emb, context)&#xA;        h = h.type(x.dtype)&#xA;        if self.predict_codebook_ids:&#xA;            return self.id_predictor(h)&#xA;        else:&#xA;            return self.out(h)&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Parameters&lt;/h2&gt; &#xA;&lt;p&gt;Feel free to adjust these parameters based on your models, image/video style, or tasks. The following parameters are for reference only.&lt;/p&gt; &#xA;&lt;h3&gt;SD1.4:&lt;/h3&gt; &#xA;&lt;p&gt;&lt;strong&gt;b1&lt;/strong&gt;: 1.2, &lt;strong&gt;b2&lt;/strong&gt;: 1.4, &lt;strong&gt;s1&lt;/strong&gt;: 0.9, &lt;strong&gt;s2&lt;/strong&gt;: 0.2&lt;/p&gt; &#xA;&lt;h3&gt;SD2.1&lt;/h3&gt; &#xA;&lt;p&gt;&lt;strong&gt;b1&lt;/strong&gt;: 1.1, &lt;strong&gt;b2&lt;/strong&gt;: 1.2, &lt;strong&gt;s1&lt;/strong&gt;: 0.9, &lt;strong&gt;s2&lt;/strong&gt;: 0.2&lt;/p&gt; &#xA;&lt;h3&gt;Range for More Parameters&lt;/h3&gt; &#xA;&lt;p&gt;When trying additional parameters, consider the following ranges:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;strong&gt;b1&lt;/strong&gt;: 1 â‰¤ b1 â‰¤ 1.2&lt;/li&gt; &#xA; &lt;li&gt;&lt;strong&gt;b2&lt;/strong&gt;: 1.2 â‰¤ b2 â‰¤ 1.6&lt;/li&gt; &#xA; &lt;li&gt;&lt;strong&gt;s1&lt;/strong&gt;: s1 â‰¤ 1&lt;/li&gt; &#xA; &lt;li&gt;&lt;strong&gt;s2&lt;/strong&gt;: s2 â‰¤ 1&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;If you find FreeU useful for your work please cite:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;@article{Si2023FreeU,&#xA;  author    = {Chenyang Si, Ziqi Huang, Yuming Jiang, Ziwei Liu},&#xA;  title     = {FreeU: Free Lunch in Diffusion U-Net},&#xA;  journal   = {arXiv},&#xA;  year      = {2023},&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;&lt;span&gt;ðŸ—ž&lt;/span&gt; License&lt;/h2&gt; &#xA;&lt;p&gt;Distributed under the MIT License. See &lt;code&gt;LICENSE&lt;/code&gt; for more information.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>ananthakumaran/paisa</title>
    <updated>2023-09-25T01:23:55Z</updated>
    <id>tag:github.com,2023-09-25:/ananthakumaran/paisa</id>
    <link href="https://github.com/ananthakumaran/paisa" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Paisa â€“ Personal Finance Manager. demo: https://demo.paisa.fyi&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;Paisa&lt;/h1&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://matrix.to/#/#paisa:matrix.org&#34;&gt;&lt;img src=&#34;https://img.shields.io/matrix/paisa%3Amatrix.org?logo=matrix&#34; alt=&#34;Matrix&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;Paisa&lt;/strong&gt; is a Personal finance manager. It builds on top of the &lt;a href=&#34;https://www.ledger-cli.org/&#34;&gt;ledger&lt;/a&gt; double entry accounting tool. Checkout &lt;a href=&#34;https://paisa.fyi&#34;&gt;documentation&lt;/a&gt; to get started.&lt;/p&gt; &#xA;&lt;h1&gt;Demo&lt;/h1&gt; &#xA;&lt;p&gt;A demo of the Web UI can be found at &lt;a href=&#34;https://demo.paisa.fyi&#34;&gt;https://demo.paisa.fyi&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Status&lt;/h2&gt; &#xA;&lt;p&gt;I use it to track my personal finance. It&#39;s more like alpha product now, usable, but I might update things based on the feedback I receive. Feel free to open an issue if you found a bug or start a discussion if you have a feature request. If you have any question, you can ask on &lt;a href=&#34;https://matrix.to/#/#paisa:matrix.org&#34;&gt;Matrix chat&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;License&lt;/h2&gt; &#xA;&lt;p&gt;This software is licensed under &lt;a href=&#34;https://raw.githubusercontent.com/ananthakumaran/paisa/master/COPYING&#34;&gt;the AGPL 3 or later license&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;Contribution Policy&lt;/h2&gt; &#xA;&lt;p&gt;Paisa is open source, but I do not plan to accept any pull request for now. If you have a feature request, start a &lt;a href=&#34;https://github.com/ananthakumaran/paisa/discussions&#34;&gt;discussion&lt;/a&gt;, or if you found a bug, create a new &lt;a href=&#34;https://github.com/ananthakumaran/paisa/issues&#34;&gt;issue&lt;/a&gt;. Since this a UI project, I would prefer to have full control over how things are done. I might relax this restriction later.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>dvlab-research/LongLoRA</title>
    <updated>2023-09-25T01:23:55Z</updated>
    <id>tag:github.com,2023-09-25:/dvlab-research/LongLoRA</id>
    <link href="https://github.com/dvlab-research/LongLoRA" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Efficient long-context fine-tuning, supervised fine-tuning, LongQA dataset.&lt;/p&gt;&lt;hr&gt;&lt;p&gt;&lt;a href=&#34;https://9415315be10389c622.gradio.live&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/Gradio-Online%20Demo-blue&#34; alt=&#34;Gradio&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h1&gt;LongLoRA: Efficient Fine-tuning of Long-Context Large Language Models&lt;/h1&gt; &#xA;&lt;h2&gt;News&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; checked disabled&gt; [2023.9.22] We release our &lt;strong&gt;13B and 70B 32k models with the supervised fine-tuning&lt;/strong&gt;, which is feasible for long context QA. Please check &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-chat-longlora-32k-sft&#34;&gt;Llama-2-13b-chat-longlora-32k-sft&lt;/a&gt; and &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-70b-chat-longlora-32k-sft&#34;&gt;Llama-2-70b-chat-longlora-32k-sft&lt;/a&gt;. To our best knowledge, &lt;strong&gt;this is the first work that release 70B model with 32k context length&lt;/strong&gt;.&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; checked disabled&gt; [2023.9.22] We release all our fine-tuned &lt;a href=&#34;https://huggingface.co/Yukang&#34;&gt;models&lt;/a&gt;, including &lt;strong&gt;70B-32k models&lt;/strong&gt;, &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-70b-longlora-32k&#34;&gt;LLaMA2-LongLoRA-70B-32k&lt;/a&gt;, &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-100k-ft&#34;&gt;LLaMA2-LongLoRA-7B-100k&lt;/a&gt;. Welcome to check them out!&lt;/li&gt; &#xA; &lt;li&gt;&lt;input type=&#34;checkbox&#34; checked disabled&gt; [2023.9.22] We release &lt;a href=&#34;http://arxiv.org/abs/2309.12307&#34;&gt;Paper&lt;/a&gt; and this GitHub repo, including training and evaluation code.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;&lt;strong&gt;LongLoRA: Efficient Fine-tuning of Long-Context Large Language Models [&lt;a href=&#34;http://arxiv.org/abs/2309.12307&#34;&gt;Paper&lt;/a&gt;]&lt;/strong&gt; &lt;br&gt; &lt;a href=&#34;https://scholar.google.com/citations?user=6p0ygKUAAAAJ&amp;amp;hl=en&#34;&gt;Yukang Chen&lt;/a&gt;, &lt;a href=&#34;https://scholar.google.com/citations?user=QNnWmasAAAAJ&#34;&gt;Shengju Qian&lt;/a&gt;, &lt;a href=&#34;https://scholar.google.com/citations?user=WxL13BAAAAAJ&amp;amp;hl&#34;&gt;Haotian Tang&lt;/a&gt;, &lt;a href=&#34;https://scholar.google.com/citations?user=tqNDPA4AAAAJ&amp;amp;hl=zh-CN&#34;&gt;Xin Lai&lt;/a&gt;, &lt;a href=&#34;https://scholar.google.com/citations?user=3coYSTUAAAAJ&amp;amp;hl=en&#34;&gt;Zhijian Liu&lt;/a&gt;, &lt;a href=&#34;https://scholar.google.com/citations?user=E0iCaa4AAAAJ&amp;amp;hl=zh-CN&#34;&gt;Song Han&lt;/a&gt;, &lt;a href=&#34;https://scholar.google.com/citations?user=XPAkzTEAAAAJ&amp;amp;hl=en&#34;&gt;Jiaya Jia&lt;/a&gt;&lt;br&gt;&lt;/p&gt; &#xA;&lt;p&gt;&lt;font size=&#34;7&#34;&gt;&lt;/font&gt;&lt;/p&gt;&#xA;&lt;div align=&#34;center&#34;&gt;&#xA; &lt;font size=&#34;7&#34;&gt; &lt;a href=&#34;http://arxiv.org/abs/2309.12307&#34;&gt;&lt;strong&gt;Paper&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://huggingface.co/Yukang&#34;&gt;&lt;strong&gt;Models&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/#training&#34;&gt;&lt;strong&gt;Training&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/#inference&#34;&gt;&lt;strong&gt;Inference&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://9415315be10389c622.gradio.live&#34;&gt;&lt;strong&gt;Online Demo&lt;/strong&gt;&lt;/a&gt;&lt;/font&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;&lt;/p&gt; &#xA;&lt;p align=&#34;center&#34;&gt; &lt;img src=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/imgs/demo-harry-potter1.png&#34; width=&#34;100%&#34;&gt; &lt;/p&gt; &#xA;&lt;p align=&#34;center&#34;&gt; &lt;img src=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/imgs/demo-harry-potter2.png&#34; width=&#34;100%&#34;&gt; &lt;/p&gt; &#xA;&lt;p align=&#34;center&#34;&gt; &lt;img src=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/imgs/demo-deadth-ends.png&#34; width=&#34;100%&#34;&gt; &lt;/p&gt; &#xA;&lt;p align=&#34;center&#34;&gt; &lt;img src=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/imgs/demo-two-towers.png&#34; width=&#34;100%&#34;&gt; &lt;/p&gt; &#xA;&lt;p align=&#34;center&#34;&gt; &lt;img src=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/imgs/demo-paper1.png&#34; width=&#34;100%&#34;&gt; &lt;/p&gt; &#xA;&lt;p align=&#34;center&#34;&gt; &lt;img src=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/imgs/demo-paper2.png&#34; width=&#34;100%&#34;&gt; &lt;/p&gt; &#xA;&lt;h2&gt;Abstract&lt;/h2&gt; &#xA;&lt;p&gt;We present LongLoRA, an efficient fine-tuning approach that extends the context sizes of pre-trained large language models (LLMs), with limited computation cost. Typically, training LLMs with long context sizes is computationally expensive, requiring extensive training hours and GPU resources. In this paper, we speed up the context extension of LLMs in two aspects. On the one hand, although dense global attention is needed during inference, fine-tuning the model can be effectively and efficiently done by sparse local attention. The proposed shift short attention effectively enables context extension, leading to non-trivial computation saving with similar performance to fine-tuning with vanilla attention. On the other hand, we find that LoRA for context extension works well under the premise of trainable embedding and normalization. LongLoRA demonstrates strong empirical results on various tasks on LLaMA2 models from 7B/13B to 70B. LongLoRA adopts LLaMA2 7B from 4k context to 100k, or LLaMA2 70B to 32k on a single 8x A100 machine. LongLoRA extends models&#39; context while retaining their original architectures, and is compatible with most existing techniques, like FlashAttention-2. In addition, to make LongLoRA practical, we collect a dataset, LongQA, for supervised fine-tuning. It contains more than 3k long context question-answer pairs. For more details, please refer to the &lt;a href=&#34;http://arxiv.org/abs/2309.12307&#34;&gt;paper&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;Highlights&lt;/h2&gt; &#xA;&lt;p&gt;&lt;strong&gt;LongLoRA&lt;/strong&gt; speed up the context extension of pre-trained large language models in both attention-level and weight-level.&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt;The proposed shifted short attention is easy to implement, compatible with Flash-Attention, and not required during inference.&lt;/li&gt; &#xA; &lt;li&gt;We release all our models, including models from 7B to 70B, context length from 8k to 100k, including &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-100k-ft&#34;&gt;LLaMA2-LongLoRA-7B-100k&lt;/a&gt;, &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-longlora-64k&#34;&gt;LLaMA2-LongLoRA-13B-64k&lt;/a&gt;, and &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-70b-longlora-32k&#34;&gt;LLaMA2-LongLoRA-70B-32k&lt;/a&gt;.&lt;/li&gt; &#xA; &lt;li&gt;We build up a long-context QA dataset, LongQA, for supervised fine-tuning (SFT). We release 13B and 70B 32k models with SFT, &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-chat-longlora-32k-sft&#34;&gt;Llama-2-13b-chat-longlora-32k-sft&lt;/a&gt; and &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-70b-chat-longlora-32k-sft&#34;&gt;Llama-2-70b-chat-longlora-32k-sft&lt;/a&gt;. We will further release the dataset in the next month.&lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;h2&gt;Installation&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code&gt;pip install -r requirements.txt&#xA;pip install flash-attn --no-build-isolation&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Released models&lt;/h2&gt; &#xA;&lt;h3&gt;Models with supervised fine-tuning&lt;/h3&gt; &#xA;&lt;table&gt; &#xA; &lt;thead&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;th align=&#34;left&#34;&gt;Model&lt;/th&gt; &#xA;   &lt;th&gt;Size&lt;/th&gt; &#xA;   &lt;th&gt;Context&lt;/th&gt; &#xA;   &lt;th&gt;Train&lt;/th&gt; &#xA;   &lt;th&gt;Link&lt;/th&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/thead&gt; &#xA; &lt;tbody&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-13b-chat-longlora-32k-sft&lt;/td&gt; &#xA;   &lt;td&gt;13B&lt;/td&gt; &#xA;   &lt;td&gt;32768&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-chat-longlora-32k-sft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-70b-chat-longlora-32k-sft&lt;/td&gt; &#xA;   &lt;td&gt;70B&lt;/td&gt; &#xA;   &lt;td&gt;32768&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-70b-chat-longlora-32k-sft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/tbody&gt; &#xA;&lt;/table&gt; &#xA;&lt;h3&gt;Models with context extension via fully fine-tuning&lt;/h3&gt; &#xA;&lt;table&gt; &#xA; &lt;thead&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;th align=&#34;left&#34;&gt;Model&lt;/th&gt; &#xA;   &lt;th&gt;Size&lt;/th&gt; &#xA;   &lt;th&gt;Context&lt;/th&gt; &#xA;   &lt;th&gt;Train&lt;/th&gt; &#xA;   &lt;th&gt;Link&lt;/th&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/thead&gt; &#xA; &lt;tbody&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-7b-longlora-8k-ft&lt;/td&gt; &#xA;   &lt;td&gt;7B&lt;/td&gt; &#xA;   &lt;td&gt;8192&lt;/td&gt; &#xA;   &lt;td&gt;Full FT&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-8k-ft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-7b-longlora-16k-ft&lt;/td&gt; &#xA;   &lt;td&gt;7B&lt;/td&gt; &#xA;   &lt;td&gt;16384&lt;/td&gt; &#xA;   &lt;td&gt;Full FT&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-16k-ft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-7b-longlora-32k-ft&lt;/td&gt; &#xA;   &lt;td&gt;7B&lt;/td&gt; &#xA;   &lt;td&gt;32768&lt;/td&gt; &#xA;   &lt;td&gt;Full FT&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-32k-ft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-7b-longlora-100k-ft&lt;/td&gt; &#xA;   &lt;td&gt;7B&lt;/td&gt; &#xA;   &lt;td&gt;100000&lt;/td&gt; &#xA;   &lt;td&gt;Full FT&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-100k-ft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-13b-longlora-8k-ft&lt;/td&gt; &#xA;   &lt;td&gt;13B&lt;/td&gt; &#xA;   &lt;td&gt;8192&lt;/td&gt; &#xA;   &lt;td&gt;Full FT&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-longlora-8k-ft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-13b-longlora-16k-ft&lt;/td&gt; &#xA;   &lt;td&gt;13B&lt;/td&gt; &#xA;   &lt;td&gt;16384&lt;/td&gt; &#xA;   &lt;td&gt;Full FT&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-longlora-16k-ft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-13b-longlora-32k-ft&lt;/td&gt; &#xA;   &lt;td&gt;13B&lt;/td&gt; &#xA;   &lt;td&gt;32768&lt;/td&gt; &#xA;   &lt;td&gt;Full FT&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-longlora-32k-ft&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/tbody&gt; &#xA;&lt;/table&gt; &#xA;&lt;h3&gt;Models with context extension via improved LoRA fine-tuning&lt;/h3&gt; &#xA;&lt;table&gt; &#xA; &lt;thead&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;th align=&#34;left&#34;&gt;Model&lt;/th&gt; &#xA;   &lt;th&gt;Size&lt;/th&gt; &#xA;   &lt;th&gt;Context&lt;/th&gt; &#xA;   &lt;th&gt;Train&lt;/th&gt; &#xA;   &lt;th&gt;Link&lt;/th&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/thead&gt; &#xA; &lt;tbody&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-7b-longlora-8k&lt;/td&gt; &#xA;   &lt;td&gt;7B&lt;/td&gt; &#xA;   &lt;td&gt;8192&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-8k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-7b-longlora-16k&lt;/td&gt; &#xA;   &lt;td&gt;7B&lt;/td&gt; &#xA;   &lt;td&gt;16384&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-16k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-7b-longlora-32k&lt;/td&gt; &#xA;   &lt;td&gt;7B&lt;/td&gt; &#xA;   &lt;td&gt;32768&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-7b-longlora-32k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-13b-longlora-8k&lt;/td&gt; &#xA;   &lt;td&gt;13B&lt;/td&gt; &#xA;   &lt;td&gt;8192&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-longlora-8k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-13b-longlora-16k&lt;/td&gt; &#xA;   &lt;td&gt;13B&lt;/td&gt; &#xA;   &lt;td&gt;16384&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-longlora-16k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-13b-longlora-32k&lt;/td&gt; &#xA;   &lt;td&gt;13B&lt;/td&gt; &#xA;   &lt;td&gt;32768&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-longlora-32k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-13b-longlora-64k&lt;/td&gt; &#xA;   &lt;td&gt;13B&lt;/td&gt; &#xA;   &lt;td&gt;65536&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-longlora-64k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-70b-longlora-32k&lt;/td&gt; &#xA;   &lt;td&gt;70B&lt;/td&gt; &#xA;   &lt;td&gt;32768&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-70b-longlora-32k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Llama-2-70b-chat-longlora-32k&lt;/td&gt; &#xA;   &lt;td&gt;70B&lt;/td&gt; &#xA;   &lt;td&gt;32768&lt;/td&gt; &#xA;   &lt;td&gt;LoRA+&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-70b-chat-longlora-32k&#34;&gt;link&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/tbody&gt; &#xA;&lt;/table&gt; &#xA;&lt;h2&gt;Training&lt;/h2&gt; &#xA;&lt;h3&gt;Pre-trained weights&lt;/h3&gt; &#xA;&lt;p&gt;We use LLaMA2 models as the pre-trained weights and fine-tune them to long context window sizes. Please download &lt;a href=&#34;https://huggingface.co/meta-llama/Llama-2-7b-hf&#34;&gt;Llama-2-7b-hf&lt;/a&gt;, &lt;a href=&#34;https://huggingface.co/meta-llama/Llama-2-7b-hf&#34;&gt;Llama-2-13b-hf&lt;/a&gt;, and &lt;a href=&#34;https://huggingface.co/meta-llama/Llama-2-70b-hf&#34;&gt;Llama-2-7b-hf&lt;/a&gt;, based on your choices.&lt;/p&gt; &#xA;&lt;h3&gt;Fine-tuning&lt;/h3&gt; &#xA;&lt;pre&gt;&lt;code&gt;torchrun --nproc_per_node=8 fine-tune.py  \&#xA;        --model_name_or_path path_to/Llama-2-7b-hf \&#xA;        --bf16 True \&#xA;        --output_dir path_to_saving_checkpoints       \&#xA;        --cache_dir path_to_cache \&#xA;        --model_max_length 8192 \&#xA;        --use_flash_attn True \&#xA;        --low_rank_training False \&#xA;        --num_train_epochs 1  \&#xA;        --per_device_train_batch_size 1     \&#xA;        --per_device_eval_batch_size 2     \&#xA;        --gradient_accumulation_steps 8     \&#xA;        --evaluation_strategy &#34;no&#34;     \&#xA;        --save_strategy &#34;steps&#34;     \&#xA;        --save_steps 1000     \&#xA;        --save_total_limit 2     \&#xA;        --learning_rate 2e-5     \&#xA;        --weight_decay 0.0     \&#xA;        --warmup_steps 20     \&#xA;        --lr_scheduler_type &#34;constant_with_warmup&#34;     \&#xA;        --logging_steps 1     \&#xA;        --deepspeed &#34;ds_configs/stage2.json&#34; \&#xA;        --tf32 True \&#xA;        --max_steps 1000&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Please remember to change &lt;code&gt;path_to/Llama-2-7b-hf&lt;/code&gt;, &lt;code&gt;path_to_saving_checkpoints&lt;/code&gt;, &lt;code&gt;path_to_cache&lt;/code&gt; to your own directory.&lt;/li&gt; &#xA; &lt;li&gt;Note that you can change &lt;code&gt;model_max_length&lt;/code&gt; to other values.&lt;/li&gt; &#xA; &lt;li&gt;You could change &lt;code&gt;ds_configs/stage2.json&lt;/code&gt; to &lt;code&gt;ds_configs/stage3.json&lt;/code&gt; if you want.&lt;/li&gt; &#xA; &lt;li&gt;Please set &lt;code&gt;use_flash_attn&lt;/code&gt; as &lt;code&gt;False&lt;/code&gt; if you use V100 machines or do not install flash attention.&lt;/li&gt; &#xA; &lt;li&gt;You can set &lt;code&gt;low_rank_training&lt;/code&gt; as &lt;code&gt;False&lt;/code&gt; if you want to use fully fine-tuning. It will cost more GPU memory and slower, but the performance will be a bit better.&lt;/li&gt; &#xA; &lt;li&gt;When training is finished, to get the full model weight:&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;pre&gt;&lt;code&gt;cd path_to_saving_checkpoints &amp;amp;&amp;amp; python zero_to_fp32.py . pytorch_model.bin&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Supervised Fine-tuning&lt;/h3&gt; &#xA;&lt;pre&gt;&lt;code&gt;torchrun --nproc_per_node=8 supervised-fine-tune.py  \&#xA;        --model_name_or_path path_to_finetuned_models \&#xA;        --bf16 True \&#xA;        --output_dir path_to_saving_checkpoints       \&#xA;        --model_max_length 32768 \&#xA;        --use_flash_attn True \&#xA;        --data_path LongQA.json \&#xA;        --low_rank_training True \&#xA;        --num_train_epochs 3  \&#xA;        --per_device_train_batch_size 1     \&#xA;        --per_device_eval_batch_size 2     \&#xA;        --gradient_accumulation_steps 1     \&#xA;        --evaluation_strategy &#34;no&#34;     \&#xA;        --save_strategy &#34;steps&#34;     \&#xA;        --save_steps 1000     \&#xA;        --save_total_limit 2     \&#xA;        --learning_rate 2e-5     \&#xA;        --weight_decay 0.0     \&#xA;        --warmup_steps 20     \&#xA;        --lr_scheduler_type &#34;constant_with_warmup&#34;     \&#xA;        --logging_steps 1     \&#xA;        --deepspeed &#34;ds_configs/stage2.json&#34; \&#xA;        --tf32 True&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;We typically make supervised fine-tuning upon the fine-tuned context extended models, &lt;code&gt;path_to_finetuned_models&lt;/code&gt;, like &lt;code&gt;Llama-2-13b-longlora-32k&lt;/code&gt; or &lt;code&gt;Llama-2-13b-longlora-32k-ft&lt;/code&gt;.&lt;/li&gt; &#xA; &lt;li&gt;During our dataset collection, it is hard for us to collect many high-quality QA that are larger than 32768. Thus, if you use our &lt;code&gt;LongQA.json&lt;/code&gt;, please also set &lt;code&gt;model_max_length&lt;/code&gt; as 32768.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Get trainable weights in low-rank training&lt;/h3&gt; &#xA;&lt;p&gt;In low-rank training, we set embedding and normalization layers as trainable. Please use the following line to extract the trainable weights &lt;code&gt;trainable_params.bin&lt;/code&gt; from &lt;code&gt;pytorch_model.bin&lt;/code&gt;&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 get_trainable_weights.py --checkpoint_path path_to_saving_checkpoints --trainable_params &#34;embed,norm&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Merge LoRA Weight&lt;/h3&gt; &#xA;&lt;p&gt;Merge the LoRA weights of &lt;code&gt;pytorch_model.bin&lt;/code&gt; and trainable parameters &lt;code&gt;trainable_params.bin&lt;/code&gt;, save the resulting model into your desired path in the Hugging Face format:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 merge_lora_weights_and_save_hf_model.py \&#xA;        --base_model path_to/Llama-2-7b-hf \&#xA;        --peft_model path_to_saving_checkpoints \&#xA;        --context_size 8192 \&#xA;        --save_path path_to_saving_merged_model&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;For example,&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 merge_lora_weights_and_save_hf_model.py \&#xA;        --base_model /dataset/pretrained-models/Llama-2-7b-hf \&#xA;        --peft_model /dataset/yukangchen/hf_models/lora-models/Llama-2-7b-longlora-8k \&#xA;        --context_size 8192 \&#xA;        --save_path /dataset/yukangchen/models/Llama-2-7b-longlora-8k-merged&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Validation&lt;/h3&gt; &#xA;&lt;p&gt;To evaluate a model that is trained in the low-rank setting, please set both &lt;code&gt;base_model&lt;/code&gt; and &lt;code&gt;peft_model&lt;/code&gt;. &lt;code&gt;base_model&lt;/code&gt; is the pre-trained weight. &lt;code&gt;peft_model&lt;/code&gt; is the path to the saved checkpoint, which should contain &lt;code&gt;trainable_params.bin&lt;/code&gt;, &lt;code&gt;adapter_model.bin&lt;/code&gt; and &lt;code&gt;adapter_config.json&lt;/code&gt;. For example,&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 eval.py --seq_len 8192 --context_size 8192 --batch_size 1 --base_model path_to/Llama-2-7b-hf --peft_model path_to_saving_checkpoints --data_path pg19/test.bin&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;To evaluate a model that is fully fine-tuned, you only need to set &lt;code&gt;base_model&lt;/code&gt; as the path to the saved checkpoint, which should contain &lt;code&gt;pytorch_model.bin&lt;/code&gt; and &lt;code&gt;config.json&lt;/code&gt;. &lt;code&gt;peft_model&lt;/code&gt; should be ignored.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 eval.py --seq_len 8192 --context_size 8192 --batch_size 1 --base_model path_to_saving_checkpoints --data_path pg19/test.bin&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Note that &lt;code&gt;--seq_len&lt;/code&gt; is to set the sequence length for evaluation. &lt;code&gt;--context_size&lt;/code&gt; is to set the context length of the model during fine-tuning. &lt;code&gt;--seq_len&lt;/code&gt; should not be larger than &lt;code&gt;--context_size&lt;/code&gt;.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;We have already tokenized the validation and test splits of PG19 and proof-pile dataset into &lt;code&gt;pg19/validation.bin&lt;/code&gt;, &lt;code&gt;pg19/test.bin&lt;/code&gt;, and &lt;code&gt;proof-pile/test_sampled_data.bin&lt;/code&gt;, with the tokenizer of LLaMA. &lt;code&gt;proof-pile/test_sampled_data.bin&lt;/code&gt; contains 128 documents that are randomly sampled from the total proof-pile test split. For each document, it has at least 32768 tokens. We also release the sampled ids in &lt;a href=&#34;https://drive.google.com/file/d/1cnzWODLRQYAd7HeugzLCIhaqzaLZv7J5/view?usp=share_link&#34;&gt;proof-pile/test_sampled_ids.bin&lt;/a&gt;. You can download them from the links below.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;table&gt; &#xA; &lt;thead&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;th align=&#34;left&#34;&gt;Dataset&lt;/th&gt; &#xA;   &lt;th&gt;Split&lt;/th&gt; &#xA;   &lt;th&gt;Link&lt;/th&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/thead&gt; &#xA; &lt;tbody&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;PG19&lt;/td&gt; &#xA;   &lt;td&gt;validation&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://drive.google.com/file/d/1rbJvb0qRIf2mQoN2ON7S93TbTzMnlrN6/view?usp=share_link&#34;&gt;pg19/validation.bin&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;PG19&lt;/td&gt; &#xA;   &lt;td&gt;test&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://drive.google.com/file/d/1QANDMdctpacPAYgS04adDXqByGEq-Ret/view?usp=share_link&#34;&gt;pg19/test.bin&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td align=&#34;left&#34;&gt;Proof-pile&lt;/td&gt; &#xA;   &lt;td&gt;test&lt;/td&gt; &#xA;   &lt;td&gt;&lt;a href=&#34;https://drive.google.com/file/d/1bUI5lPDvrqzY_XXJJ2sSuvZx0Y9AZClE/view?usp=share_link&#34;&gt;proof-pile/test_sampled_data.bin&lt;/a&gt;&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/tbody&gt; &#xA;&lt;/table&gt; &#xA;&lt;h2&gt;Inference&lt;/h2&gt; &#xA;&lt;p&gt;To chat with &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-13b-chat-longlora-32k-sft&#34;&gt;Llama-2-13b-chat-longlora-32k-sft&lt;/a&gt; or &lt;a href=&#34;https://huggingface.co/Yukang/Llama-2-70b-chat-longlora-32k-sft&#34;&gt;Llama-2-70b-chat-longlora-32k-sft&lt;/a&gt;, you need to run &lt;code&gt;merge_lora_weights_and_save_hf_model.py&lt;/code&gt; first, and then:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 inference.py  \&#xA;        --base_model path_to_model \&#xA;        --question $question \&#xA;        --context_size $context_length \&#xA;        --max_gen_len $max_gen_len \&#xA;        --flash_attn True \&#xA;        --material $material_content \&#xA;        --material_type $material_type \&#xA;        --material_title $material_title&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;For example, if we want to ask a question related to a book:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 inference.py  \&#xA;        --base_model /data/models/Llama-2-13b-chat-longlora-32k-sft \&#xA;        --question &#34;Why doesn&#39;t Professor Snape seem to like Harry?&#34; \&#xA;        --context_size 32768 \&#xA;        --max_gen_len 512 \&#xA;        --flash_attn True \&#xA;        --material &#34;materials/Harry Potter and the Philosophers Stone_section2.txt&#34; \&#xA;        --material_type &#34;book&#34; \&#xA;        --material_title &#34;Harry Potter and the Philosophers Stone&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Note that you can ignore &lt;code&gt;material_type&lt;/code&gt; or &lt;code&gt;material_title&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;p&gt;If we want to ask a question related to a paper:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 inference.py  \&#xA;        --base_model /data/models/Llama-2-13b-chat-longlora-32k-sft \&#xA;        --question &#34;What are the main contributions and novelties of this work?&#34; \&#xA;        --context_size 32768 \&#xA;        --max_gen_len 512 \&#xA;        --flash_attn True \&#xA;        --material &#34;materials/paper1.txt&#34; \&#xA;        --material_type &#34;paper&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Demo&lt;/h2&gt; &#xA;&lt;p&gt;If you want to deploy your own demo, you can run the&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 demo.py  \&#xA;&#x9;--base_model path_to_model \&#xA;&#x9;--context_size $context_size \&#xA;&#x9;--max_gen_len $max_gen_len \&#xA;&#x9;--flash_attn True&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;For example,&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;python3 demo.py  \&#xA;&#x9;--base_model /data/models/Llama-2-13b-chat-longlora-32k-sft \&#xA;&#x9;--context_size 32768 \&#xA;&#x9;--max_gen_len 512 \&#xA;&#x9;--flash_attn True&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Note that &lt;code&gt;flash_attn=True&lt;/code&gt; will make the generation slow but save much GPU memory.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Pdf2text&lt;/h2&gt; &#xA;&lt;p&gt;During our dataset collection, we convert paper and books from pdf to text. The conversion quality has a large influence on the final model quality. We think that this step is non-trivial. We release the tool for the pdf2txt conversion, in the folder &lt;code&gt;pdf2txt&lt;/code&gt;. It is built upon &lt;code&gt;pdf2image&lt;/code&gt;, &lt;code&gt;easyocr&lt;/code&gt;, &lt;code&gt;ditod&lt;/code&gt; and &lt;code&gt;detectron2&lt;/code&gt;. Please refer to the &lt;a href=&#34;https://raw.githubusercontent.com/dvlab-research/LongLoRA/main/pdf2txt/README.md&#34;&gt;README.md&lt;/a&gt; in &lt;code&gt;pdf2txt&lt;/code&gt; for more details.&lt;/p&gt; &#xA;&lt;h2&gt;Citation&lt;/h2&gt; &#xA;&lt;p&gt;If you find this project useful in your research, please consider citing:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;@article{longlora,&#xA;  title={LongLoRA: Efficient Fine-tuning of Long-Context Large Language Models},&#xA;  author={Yukang Chen and Shengju Qian and Haotian Tang and Xin Lai and Zhijian Liu and Song Han and Jiaya Jia},&#xA;  journal={arXiv:2309.12307},&#xA;  year={2023}&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Acknowledgement&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;This work is built upon the &lt;a href=&#34;https://ai.meta.com/llama&#34;&gt;LLaMA2&lt;/a&gt; as the pre-trained models.&lt;/li&gt; &#xA; &lt;li&gt;This work is based on &lt;a href=&#34;https://github.com/microsoft/DeepSpeed&#34;&gt;DeepSpeed&lt;/a&gt;, &lt;a href=&#34;https://github.com/huggingface/peft&#34;&gt;peft&lt;/a&gt;, and &lt;a href=&#34;https://github.com/Dao-AILab/flash-attention&#34;&gt;Flash-Attention2&lt;/a&gt; for acceleration.&lt;/li&gt; &#xA; &lt;li&gt;The perplexity evaluation code is modified upon &lt;a href=&#34;https://github.com/epfml/landmark-attention&#34;&gt;Landmark Attention&lt;/a&gt;.&lt;/li&gt; &#xA; &lt;li&gt;We use &lt;a href=&#34;https://github.com/DachengLi1/LongChat&#34;&gt;LongChat&lt;/a&gt; for the retrieval evaluation.&lt;/li&gt; &#xA;&lt;/ul&gt;</summary>
  </entry>
</feed>