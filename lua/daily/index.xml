<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub Lua Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2023-06-09T01:42:12Z</updated>
  <subtitle>Daily Trending of Lua in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>jankozik/mpvplugin-videocut</title>
    <updated>2023-06-09T01:42:12Z</updated>
    <id>tag:github.com,2023-06-09:/jankozik/mpvplugin-videocut</id>
    <link href="https://github.com/jankozik/mpvplugin-videocut" rel="alternate"></link>
    <summary type="html">&lt;p&gt;An mpv plugin for cutting videos incredibly quickly.&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;mpv-videocut&lt;/h1&gt; &#xA;&lt;p&gt;This extension allows you to:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Quickly cut videos both losslessly and re-encoded-ly.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Specify custom actions in a &lt;code&gt;config.lua&lt;/code&gt; file to support your own use cases without having to modify the script itself or write your own extension.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Bookmark timestamps to a &lt;code&gt;.book&lt;/code&gt; file and load them as chapters.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Save cut information to a &lt;code&gt;.list&lt;/code&gt; file for backup and make cuts later.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Choose meaningful channel names to organize the aforementioned actions.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;All directly in the fantastic media player &lt;a href=&#34;https://mpv.io/installation/&#34;&gt;mpv&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;Requirements&lt;/h2&gt; &#xA;&lt;p&gt;Besides mpv, you must have &lt;code&gt;ffmpeg&lt;/code&gt; in your PATH.&lt;/p&gt; &#xA;&lt;h2&gt;Installation&lt;/h2&gt; &#xA;&lt;h4&gt;Linux/MacOS&lt;/h4&gt; &#xA;&lt;pre&gt;&lt;code&gt;git clone -b release --single-branch &#34;https://github.com/jankozik/mpvplugin-videocut.git&#34; ~/.config/mpv/scripts/mpv-cut&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h4&gt;Windows&lt;/h4&gt; &#xA;&lt;p&gt;In &lt;code&gt;%AppData%\Roaming\mpv\scripts&lt;/code&gt; or &lt;code&gt;Users\user\scoop\persist\mpv\scripts&lt;/code&gt; run:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;git clone -b release --single-branch &#34;https://github.com/jankozik/mpvplugin-videocut.git&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;That&#39;s all you have to do, next time you run mpv the script will be automatically loaded.&lt;/p&gt; &#xA;&lt;h2&gt;Usage&lt;/h2&gt; &#xA;&lt;h3&gt;Cutting A Video Losslessly&lt;/h3&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Press &lt;code&gt;c&lt;/code&gt; to begin a cut.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Seek to a later time in the video.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Press &lt;code&gt;c&lt;/code&gt; again to make the cut.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;The resulting cut will be placed in the same directory as the source file.&lt;/p&gt; &#xA;&lt;h3&gt;Actions&lt;/h3&gt; &#xA;&lt;p&gt;You can press &lt;code&gt;a&lt;/code&gt; to cycle between three default actions:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Copy (lossless cut, rounds to keyframes).&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Encode (re-encoded cut, exact).&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;List (simply add the timestamps for the cut to a &lt;code&gt;.list&lt;/code&gt; file).&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;&lt;code&gt;mpv-cut&lt;/code&gt; uses an extensible list of &lt;em&gt;actions&lt;/em&gt; that you can modify in your &lt;code&gt;config.lua&lt;/code&gt;. This makes it easy to change the &lt;code&gt;ffmpeg&lt;/code&gt; command (or any command for that matter) to suit your specific situation. It should be possible to create custom actions with limited coding knowledge. More details in &lt;a href=&#34;https://raw.githubusercontent.com/jankozik/mpvplugin-videocut/main/#config&#34;&gt;config&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;h3&gt;Bookmarking&lt;/h3&gt; &#xA;&lt;p&gt;Press &lt;code&gt;i&lt;/code&gt; to append the current timestamp to a &lt;code&gt;.book&lt;/code&gt; file. This automatically reloads the timestamps as chapters in mpv. You can navigate between these chapters with the default mpv bindings, &lt;code&gt;!&lt;/code&gt; and &lt;code&gt;@&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;h3&gt;Channels&lt;/h3&gt; &#xA;&lt;p&gt;The resulting cuts and bookmark files will be prefixed a channel number. This is to help you categorize cuts and bookmarks. You can press &lt;code&gt;-&lt;/code&gt; to decrement the channel and &lt;code&gt;=&lt;/code&gt; to increment the channel.&lt;/p&gt; &#xA;&lt;p&gt;You can configure a name for each channel as shown below.&lt;/p&gt; &#xA;&lt;h3&gt;Making Cuts&lt;/h3&gt; &#xA;&lt;p&gt;If you want to make all the cuts stored in a cut list, simply press &lt;code&gt;0&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;Config&lt;/h2&gt; &#xA;&lt;p&gt;You can configure settings by creating a &lt;code&gt;config.lua&lt;/code&gt; file in the same directory as &lt;code&gt;main.lua&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;p&gt;You can include or omit any of the following:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-lua&#34;&gt;-- Key config&#xA;KEY_CUT = &#34;c&#34;&#xA;KEY_CYCLE_ACTION = &#34;a&#34;&#xA;KEY_BOOKMARK_ADD = &#34;i&#34;&#xA;KEY_CHANNEL_INC = &#34;=&#34;&#xA;KEY_CHANNEL_DEC = &#34;-&#34;&#xA;KEY_MAKE_CUTS = &#34;0&#34;&#xA;&#xA;-- The list of channel names, you can choose whatever you want.&#xA;CHANNEL_NAMES[1] = &#34;FUNNY&#34;&#xA;CHANNEL_NAMES[2] = &#34;COOL&#34;&#xA;&#xA;-- The default channel&#xA;CHANNEL = 1&#xA;&#xA;-- The default action&#xA;ACTION = ACTIONS.ENCODE&#xA;&#xA;-- The action to use when making cuts from a cut list&#xA;MAKE_CUT = ACTIONS.COPY&#xA;&#xA;-- Delete a default action&#xA;ACTIONS.LIST = nil&#xA;&#xA;-- Specify custom actions&#xA;ACTIONS.ENCODE = function(d)&#xA;&#x9;local args = {&#xA;&#x9;&#x9;&#34;ffmpeg&#34;,&#xA;&#x9;&#x9;&#34;-nostdin&#34;, &#34;-y&#34;,&#xA;&#x9;&#x9;&#34;-loglevel&#34;, &#34;error&#34;,&#xA;&#x9;&#x9;&#34;-i&#34;, d.inpath,&#xA;&#x9;&#x9;&#34;-ss&#34;, d.start_time,&#xA;&#x9;&#x9;&#34;-t&#34;, d.duration,&#xA;&#x9;&#x9;&#34;-pix_fmt&#34;, &#34;yuv420p&#34;,&#xA;&#x9;&#x9;&#34;-crf&#34;, &#34;16&#34;,&#xA;&#x9;&#x9;&#34;-preset&#34;, &#34;superfast&#34;,&#xA;&#x9;&#x9;utils.join_path(d.indir, &#34;ENCODE_&#34; .. d.channel .. &#34;_&#34; .. d.infile_noext .. &#34;_FROM_&#34; .. d.start_time_hms .. &#34;_TO_&#34; .. d.end_time_hms .. d.ext)&#xA;&#x9;}&#xA;&#x9;mp.command_native_async({&#xA;&#x9;&#x9;name = &#34;subprocess&#34;,&#xA;&#x9;&#x9;args = args,&#xA;&#x9;&#x9;playback_only = false,&#xA;&#x9;}, function() print(&#34;Done&#34;) end)&#xA;end&#xA;&#xA;-- The table that gets passed to an action will have the following properties:&#xA;-- inpath, indir, infile, infile_noext, ext&#xA;-- channel&#xA;-- start_time, end_time, duration&#xA;-- start_time_hms, end_time_hms, duration_hms&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Optimized MPV Input Config&lt;/h2&gt; &#xA;&lt;p&gt;This is my &lt;code&gt;input.conf&lt;/code&gt; file, and it is optimized for both normal playback and quickly editing videos.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;RIGHT seek 2 exact&#xA;LEFT seek -2 exact&#xA;&#xA;] add speed 0.5&#xA;[ add speed -0.5&#xA;} add speed 0.25&#xA;{ add speed -0.25&#xA;&#xA;SPACE cycle pause; set speed 1    # Reset speed whenever pausing.&#xA;BS script-binding osc/visibility  # Make progress bar stay visible.&#xA;UP seek 0.01 keyframes            # Seek by keyframes only.&#xA;DOWN seek -0.01 keyframes         # Seek by keyframes only.&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;You may also want to change your key repeat delay and rate by tweaking &lt;code&gt;input-ar-delay&lt;/code&gt; and &lt;code&gt;input-ar-rate&lt;/code&gt; to your liking in &lt;code&gt;mpv.conf&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;FAQ&lt;/h2&gt; &#xA;&lt;h3&gt;What Is The Point Of A Cut List?&lt;/h3&gt; &#xA;&lt;p&gt;There are plenty of reasons, but to give some examples:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Video seems to be pretty complex, at least to me. One video file may cause certain issues, and another may not, which makes writing an ffmpeg command that accounts for all scenarios difficult. If you spend a ton of time making many cuts in a long movie only to find that the colors look off because of some 10-bit h265 dolby mega surround whatever the fuck, with a cut list it&#39;s trivial to edit the ffmpeg command and re-make the cuts.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Maybe you forget that the foreign language video you&#39;re cutting has softsubs rather than hardsubs, and you make a bunch of encode cuts resulting in cuts that have no subtitles.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;You delete the source video for storage reasons, but still want to have a back up of the cut timestamps in the event you need to remake the cuts.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Why Would I Bookmark Instead Of Cutting?&lt;/h3&gt; &#xA;&lt;p&gt;Suppose you&#39;re watching a movie or show for your own enjoyment, but you also want to compile funny moments to post online or send to your friends. It would ruin your viewing experience to wait for a funny moment to be over in order to make a cut. Instead, you can quickly make a bookmark whenever you laugh, and once you&#39;re done watching you can go back and make actual cuts.&lt;/p&gt; &#xA;&lt;h3&gt;Why Is Lossless Cutting Called &#34;Copy&#34;?&lt;/h3&gt; &#xA;&lt;p&gt;This refers to ffmpeg&#39;s &lt;code&gt;-copy&lt;/code&gt; flag which copies the input stream instead of re-encoding it, meaning that the cut will process extremely quickly and the resulting video will retain 100% of the original quality. The main drawback is that the cut may have some extra video at the beginning and end, and as a result of that there may be some slightly wonky behavior with video players and editors.&lt;/p&gt; &#xA;&lt;h3&gt;Why Would I Re-Encode A Video?&lt;/h3&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;As mentioned above, copying the input stream is very fast and lossless but the cuts are not exact. Sometimes you want a cut to be exact.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;If you want to change the framerate.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;If you want to encode hardsubs.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;If the video&#39;s compression isn&#39;t efficient enough to upload to a messaging platform or something, you may want to compress it more.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;How Can I Merge (Concatenate) The Resulting Cuts Into One File?&lt;/h3&gt; &#xA;&lt;p&gt;To concatenate videos with ffmpeg, you need to create a file with content like this:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;file cut_1.mp4&#xA;file cut_2.mp4&#xA;file cut_3.mp4&#xA;file cut_4.mp4&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;You can name the file whatever you want, here I named it &lt;code&gt;concat.txt&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;p&gt;Then run the command:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;ffmpeg -f concat -safe 0 -i concat.txt -c copy out.mp4&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;That&#39;s annoying though, so you can skip manually creating the file by using bash. This command will concatenate all files in the current directory that begin with &#34;COPY_&#34;:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;ffmpeg -f concat -safe 0 -i &amp;lt;(printf &#39;file %q\n&#39; &#34;$PWD&#34;/COPY_*) -c copy lol.mp4&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;You need to escape apostrophes which is why we are using &lt;code&gt;printf %q &#34;$string&#34;&lt;/code&gt;.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Instead of actually creating a file we just use process substitution &lt;code&gt;&amp;lt;(whatever)&lt;/code&gt; to create a temporary file, which is why we need the &lt;code&gt;$PWD&lt;/code&gt; in there for the absolute path.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;You can also do it in vim, among other things.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;ls | vim -&#xA;:%s/&#39;/\\&#39;/g&#xA;:%norm Ifile &#xA;:wq concat.txt&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;This substitution might not cover all cases, but whatever, if you&#39;re concatenating a file named &lt;code&gt;[{}1;&#39;][&#34;!.mp4&lt;/code&gt; you can figure it out yourself.&lt;/p&gt; &#xA;&lt;h3&gt;Can I Make Seeking And Reverse Playback Faster?&lt;/h3&gt; &#xA;&lt;p&gt;Depending on the encoding of the video file being played, the following may be quite slow:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;The use of &lt;code&gt;exact&lt;/code&gt; in &lt;code&gt;input.conf&lt;/code&gt;.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;The use of the &lt;code&gt;.&lt;/code&gt; and &lt;code&gt;,&lt;/code&gt; keys to go frame by frame.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;The holding down of the &lt;code&gt;,&lt;/code&gt; key to play the video in reverse.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;Long story short, if the video uses an encoding that is difficult for mpv to decode, exact seeking and backwards playback won&#39;t be smooth, which for normal playback is not a problem at all, since by default mpv very quickly seeks keyframe-wise when you press &lt;code&gt;left arrow&lt;/code&gt; or &lt;code&gt;right arrow&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;p&gt;However if we are very intensively cutting a video, it may be useful to be able to quickly seek to an exact time, and to quickly play in reverse. In this case, it is useful to first make a proxy of the original video which is very easy to decode, generate a cut list with the proxy, and then apply the cut list to the original video.&lt;/p&gt; &#xA;&lt;p&gt;To create a proxy which will be very easy to decode, you can use this ffmpeg command:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;ffmpeg -noautorotate -i input.mp4 -pix_fmt yuv420p -g 1 -sn -an -vf colormatrix=bt601:bt709,scale=w=1280:h=1280:force_original_aspect_ratio=decrease:force_divisible_by=2 -c:v libx264 -crf 16 -preset superfast -tune fastdecode proxy.mp4&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;The important options here are the &lt;code&gt;-g 1&lt;/code&gt; and the scale filter. The other options are more or less irrelevant. The resulting video file should seek extremely quickly and play backwards just fine.&lt;/p&gt; &#xA;&lt;p&gt;Once you are done generating the cut list, simply open the &lt;code&gt;cut_list.txt&lt;/code&gt; file, substitute the proxy file name for the original file name, and run &lt;code&gt;make_cuts&lt;/code&gt; on it.&lt;/p&gt;</summary>
  </entry>
</feed>