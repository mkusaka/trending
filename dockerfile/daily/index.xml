<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub Dockerfile Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2024-12-03T01:31:01Z</updated>
  <subtitle>Daily Trending of Dockerfile in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>hyperliquid-dex/node</title>
    <updated>2024-12-03T01:31:01Z</updated>
    <id>tag:github.com,2024-12-03:/hyperliquid-dex/node</id>
    <link href="https://github.com/hyperliquid-dex/node" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;Running a node&lt;/h1&gt; &#xA;&lt;h2&gt;Machine Specs&lt;/h2&gt; &#xA;&lt;p&gt;Recommended hardware: 4 CPU cores, 16 gb RAM, 50 gb disk.&lt;/p&gt; &#xA;&lt;p&gt;Currently only Ubuntu 24.04 is supported.&lt;/p&gt; &#xA;&lt;p&gt;Ports 4001 and 4002 are used for gossip and must be open to the public. Otherwise the node IP address will be deprioritized by peers in the p2p network.&lt;/p&gt; &#xA;&lt;p&gt;For lowest latency, run the node in Tokyo, Japan.&lt;/p&gt; &#xA;&lt;h2&gt;Setup&lt;/h2&gt; &#xA;&lt;p&gt;Configure chain to testnet. Mainnet will be available once testing is complete on testnet:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;echo &#39;{&#34;chain&#34;: &#34;Testnet&#34;}&#39; &amp;gt; ~/visor.json&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Download the visor binary, which will spawn and manage the child node process:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;curl https://binaries.hyperliquid.xyz/Testnet/hl-visor &amp;gt; ~/hl-visor &amp;amp;&amp;amp; chmod a+x ~/hl-visor&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Running non-validator&lt;/h2&gt; &#xA;&lt;p&gt;Run &lt;code&gt;~/hl-visor run-non-validator&lt;/code&gt;. It may take a while as the node navigates the network to find an appropriate peer to stream from. Logs like &lt;code&gt;applied block X&lt;/code&gt; mean the node should be streaming live data.&lt;/p&gt; &#xA;&lt;h2&gt;Reading L1 data&lt;/h2&gt; &#xA;&lt;p&gt;The node process will write data to &lt;code&gt;~/hl/data&lt;/code&gt;. With default settings, the network will generate around 20 gb of logs per day, so it is also recommended to archive or delete old files.&lt;/p&gt; &#xA;&lt;p&gt;Blocks parsed as transactions will be streamed to &lt;code&gt;~/hl/data/replica_cmds/{start_time}/{date}/{height}&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;p&gt;State snapshots will be saved every 10000 blocks to &lt;code&gt;~/hl/data/periodic_abci_states/{date}/{height}.rmp&lt;/code&gt;&lt;/p&gt; &#xA;&lt;p&gt;The state can be translated to JSON format for examination:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;./hl-node --chain Testnet translate-abci-state ~/hl/data/periodic_abci_states/{date}/{height}.rmp /tmp/out.json&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Flags&lt;/h3&gt; &#xA;&lt;p&gt;Certain flags can be turned on when running validators or non-validators:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;code&gt;--write-trades&lt;/code&gt; will stream trades to &lt;code&gt;~/hl/data/node_trades/hourly/{date}/{hour}&lt;/code&gt;.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;--write-order-statuses&lt;/code&gt; will write every L1 order status to &lt;code&gt;~/hl/data/node_order_statuses/hourly/{date}/{hour}&lt;/code&gt;. Orders can be a substantial amount of data.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;--replica-cmds-style&lt;/code&gt; configures what is written down to &lt;code&gt;~/hl/data/replica_cmds/{start_time}/{date}/{height}&lt;/code&gt;. Possible values are &lt;code&gt;actions&lt;/code&gt; for only actions (default), &lt;code&gt;actions-and-responses&lt;/code&gt; for actions and responses, and &lt;code&gt;recent-actions&lt;/code&gt; which is the same as &lt;code&gt;actions&lt;/code&gt; but only preserving the two latest height files.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;--serve-eth-rpc&lt;/code&gt; enables the EVM rpc. More details in the following section.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;For example, to run a non-validator with all flags enabled:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;~/hl-visor run-non-validator --write-trades --write-order-statuses --write-replica-cmd-resps --serve-eth-rpc&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;EVM&lt;/h2&gt; &#xA;&lt;p&gt;EVM RPC can be enabled by passing the &lt;code&gt;--serve-eth-rpc&lt;/code&gt; flag &lt;code&gt;~/hl-visor run-non-validator --serve-eth-rpc&lt;/code&gt;. Once running, requests can be sent as follows: &lt;code&gt;curl -X POST --header &#39;Content-Type: application/json&#39; --data &#39;{&#34;jsonrpc&#34;:&#34;2.0&#34;,&#34;method&#34;:&#34;eth_getBlockByNumber&#34;,&#34;params&#34;:[&#34;latest&#34;,false],&#34;id&#34;:1}&#39; http://localhost:3001/evm&lt;/code&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Delegation&lt;/h2&gt; &#xA;&lt;p&gt;The native token on testnet is TESTH with token address &lt;code&gt;0x65af5d30d57264645731588b2ebfa8e3&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;p&gt;Delegations occur from the staking balance, which is separate from the spot balance. The token can be transferred from the spot balance into the staking balance by running&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;./hl-node --chain Testnet --key &amp;lt;delegator-wallet-key&amp;gt; staking-deposit &amp;lt;wei&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;The token can be delegated by running&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;./hl-node --chain Testnet --key &amp;lt;delegator-wallet-key&amp;gt; delegate &amp;lt;validator-address&amp;gt; &amp;lt;amount-in-wei&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Optionally &lt;code&gt;--undelegate&lt;/code&gt; can be passed to undelegate from the validator.&lt;/p&gt; &#xA;&lt;p&gt;Delegations can be seen by running&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;curl -X POST --header &#34;Content-Type: application/json&#34; --data &#39;{ &#34;type&#34;: &#34;delegations&#34;, &#34;user&#34;: &amp;lt;delegator-address&amp;gt;}&#39; https://api.hyperliquid-testnet.xyz/info&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Staking withdrawals are subject to a 5 minute unbonding queue to allow for slashing in the case of malicious behavior. Rewards are sent to the unwithdrawn balance at the end of each epoch. Information about pending withdrawals and rewards can be seen by running&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;curl -X POST --header &#34;Content-Type: application/json&#34; --data &#39;{ &#34;type&#34;: &#34;delegatorSummary&#34;, &#34;user&#34;: &amp;lt;delegator-address&amp;gt;}&#39; https://api.hyperliquid-testnet.xyz/info&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;To initiate a staking withdrawal:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;./hl-node --chain Testnet --key &amp;lt;delegator-wallet-key&amp;gt; staking-withdrawal &amp;lt;wei&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;The withdrawal will be reflected in the exchange balance automatically once the unbonding period ends.&lt;/p&gt; &#xA;&lt;h2&gt;Running a validating node&lt;/h2&gt; &#xA;&lt;p&gt;The non-validating node setup above is a prerequisite for running a validating node.&lt;/p&gt; &#xA;&lt;h3&gt;Generate config&lt;/h3&gt; &#xA;&lt;p&gt;Generate two wallets: a validator wallet and a signer wallet (use cryptographically secure keys, e.g. the output of &lt;code&gt;openssl rand -hex 32&lt;/code&gt;). The validator wallet is &#34;cold&#34; in the sense that it holds funds and receives delegation rewards. The signer wallet is &#34;hot&#34; in the sense that it is used only for signing consensus messages. They can be the same wallet for simplicity.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;echo &#39;{&#34;key&#34;: &#34;&amp;lt;signer-key&amp;gt;&#34;}&#39; &amp;gt; ~/hl/hyperliquid_data/node_config.json&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;In the commands below, &lt;code&gt;&amp;lt;signer-key&amp;gt;&lt;/code&gt; is the same hex string in the config file above and &lt;code&gt;&amp;lt;validator-key&amp;gt;&lt;/code&gt; is analogous (do not lose either key).&lt;/p&gt; &#xA;&lt;h3&gt;Ensure validator user exists&lt;/h3&gt; &#xA;&lt;p&gt;Both the signer address and the validator address should have non-zero perps USDC balance, or they will not be able to send the signed actions to register as a validator or otherwise operate properly. These command print the addresses:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;~/hl-node --chain Testnet --key &amp;lt;signer-key&amp;gt; print-address&#xA;~/hl-node --chain Testnet --key &amp;lt;validator-key&amp;gt; print-address&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Join network&lt;/h3&gt; &#xA;&lt;p&gt;During the initial phase of testing, the validator address from the previous step needs to be whitelisted.&lt;/p&gt; &#xA;&lt;p&gt;Register public IP and signer address of validator, along with display name and description. On testnet, self-delegate 1 TESTH to run the validator.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;~/hl-node --chain Testnet --key &amp;lt;validator-key&amp;gt; send-signed-action &#39;{&#34;type&#34;: &#34;CValidatorAction&#34;, &#34;register&#34;: {&#34;profile&#34;: {&#34;node_ip&#34;: {&#34;Ip&#34;: &#34;1.2.3.4&#34;}, &#34;signer&#34;: &#34;&amp;lt;signer-address&amp;gt;&#34;, &#34;name&#34;: &#34;...&#34;, &#34;description&#34;: &#34;...&#34; }, &#34;initial_wei&#34;: 100000}}&#39;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Make sure ports 4000-4010 are open to other validators (currently only ports 4001-4006 are used, but additional ports in the range 4000-4010 may be used in the future). Either open the ports to the public, or keep a firewall allowing the validators which are found in &lt;code&gt;c_staking&lt;/code&gt; in the state snapshots. Note that the validator set and IPs are dynamic.&lt;/p&gt; &#xA;&lt;h3&gt;Run the validator&lt;/h3&gt; &#xA;&lt;p&gt;Run the validator using the visor binary to pick up updates &lt;code&gt;curl https://binaries.hyperliquid.xyz/Testnet/hl-visor &amp;gt; hl-visor &amp;amp;&amp;amp; ./hl-visor run-validator&lt;/code&gt;&lt;/p&gt; &#xA;&lt;p&gt;To debug an issue, it is often easier to run &lt;code&gt;./hl-node --chain Testnet run-validator&lt;/code&gt; to immediately see stderr and disable restarts.&lt;/p&gt; &#xA;&lt;p&gt;The validator bootstraps the state with a non-validator first. To use a known reliable peer for faster bootstrapping:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;echo &#39;{ &#34;root_node_ips&#34;: [{&#34;Ip&#34;: &#34;1.2.3.4&#34;}], &#34;try_new_peers&#34;: false, &#34;chain&#34;: &#34;Testnet&#34; }&#39; &amp;gt; ~/override_gossip_config.json&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Begin validating&lt;/h3&gt; &#xA;&lt;p&gt;For now, registering and changing IP address automatically jails the validator so that it does not participate in consensus initially. When the expected outputs are streaming to &lt;code&gt;~/hl/data/node_logs/consensus/hourly/{date}/{hour}&lt;/code&gt;, send the following action to begin participating in consensus:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;~/hl-node --chain Testnet --key &amp;lt;signer-key&amp;gt; send-signed-action &#39;{&#34;type&#34;: &#34;CSignerAction&#34;, &#34;unjailSelf&#34;: null}&#39;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;To exit consensus, run the following command to &#34;self jail&#34; and wait for the validator to leave the active set before shutting down.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;~/hl-node --chain Testnet --key &amp;lt;signer-key&amp;gt; send-signed-action &#39;{&#34;type&#34;: &#34;CSignerAction&#34;, &#34;jailSelf&#34;: null}&#39;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Jailing&lt;/h3&gt; &#xA;&lt;p&gt;Performance and uptime are critical for the mainnet L1. To achieve this, a key feature of HyperBFT consensus is &#34;jailing.&#34; When a validator is jailed, it can still participate in the consensus network by forwarding messages to peers, but does not vote on or propose blocks. To avoid jailing, it is recommended to achieve 200ms two-way latency to at least 1/3 of validators by stake.&lt;/p&gt; &#xA;&lt;p&gt;Once a validator is jailed, it can only be unjailed through the &lt;code&gt;unjailSelf&lt;/code&gt; action described above. This action will only succeed if the L1 time is later than the &#34;jailed until&#34; time of the validator. Self-jailing does not advance the &#34;jailed until&#34; duration, and is therefore the only way to disable a validator without penalty.&lt;/p&gt; &#xA;&lt;p&gt;To debug a validator that repeatedly gets jailed, first check stdout for signs of crashing or other unusual logs. If the binary is running without problems, logs in &lt;code&gt;~/hl/data/node_logs/status/&lt;/code&gt; may be helpful to debug latencies to other validators or other connectivity issues.&lt;/p&gt; &#xA;&lt;h3&gt;Alerting&lt;/h3&gt; &#xA;&lt;p&gt;It is recommended for validators to set up an alerting system to maintain optimal uptime.&lt;/p&gt; &#xA;&lt;p&gt;To configure Slack to alert on critical messages:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;echo &#39;{&#34;testnet_slack_channel&#34;: &#34;C000...&#34;, &#34;slack_key&#34;: &#34;Bearer xoxb-...&#34;}&#39; &amp;gt; ~/hl/api_secrets.json&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Test the Slack alert configuration:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;~/hl-node --chain Testnet send-slack-alert &#34;hello hyperliquid&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Alternative alerting systems can be configured by filtering to the lines in stdout at level &lt;code&gt;CRIT&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;Misc&lt;/h2&gt; &#xA;&lt;p&gt;See information about the current validators:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;curl -X POST --header &#34;Content-Type: application/json&#34; --data &#39;{ &#34;type&#34;: &#34;validatorSummaries&#34;}&#39; https://api.hyperliquid-testnet.xyz/info&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Change validator profile if already registered:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;~/hl-node --chain Testnet --key &amp;lt;validator-key&amp;gt; send-signed-action &#39;{&#34;type&#34;: &#34;CValidatorAction&#34;, &#34;changeProfile&#34;: {&#34;node_ip&#34;: {&#34;Ip&#34;: &#34;1.2.3.4&#34;}, &#34;name&#34;: &#34;...&#34;}}&#39;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Other validator profile options:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;code&gt;disable_delegations&lt;/code&gt;: Disables delegations when this is set to true.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;commission_bps&lt;/code&gt;: Amount of the staking rewards the validator takes before the remainder is distributed proportionally to stake delegated. Defaults to 10000 (all rewards go to the validator) and is not allowed to increase.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;signer&lt;/code&gt;: Allows the validator to set a hot address for signing consensus messages.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Running with Docker&lt;/h3&gt; &#xA;&lt;p&gt;To build the node, run:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker compose build&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;To run the node, run:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker compose up -d&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Troubleshooting&lt;/h3&gt; &#xA;&lt;p&gt;Crash logs from the child process will be written to &lt;code&gt;~/hl/data/visor_child_stderr/{date}/{node_binary_index}&lt;/code&gt;&lt;/p&gt;</summary>
  </entry>
</feed>