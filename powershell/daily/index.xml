<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub PowerShell Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2023-06-14T01:45:54Z</updated>
  <subtitle>Daily Trending of PowerShell in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>Kevin-Robertson/Powermad</title>
    <updated>2023-06-14T01:45:54Z</updated>
    <id>tag:github.com,2023-06-14:/Kevin-Robertson/Powermad</id>
    <link href="https://github.com/Kevin-Robertson/Powermad" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PowerShell MachineAccountQuota and DNS exploit tools&lt;/p&gt;&lt;hr&gt;&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/5897462/62258617-2154ee00-b3d9-11e9-9414-67fadeb35f2f.png&#34; alt=&#34;Powermad_logo&#34;&gt;&lt;/p&gt; &#xA;&lt;h1&gt;&lt;strong&gt;PowerShell MachineAccountQuota and DNS exploit tools&lt;/strong&gt;&lt;/h1&gt; &#xA;&lt;h2&gt;Wiki&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://github.com/Kevin-Robertson/Powermad/wiki&#34;&gt;https://github.com/Kevin-Robertson/Powermad/wiki&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Blog Post&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://blog.netspi.com/exploiting-adidns/&#34;&gt;Beyond LLMNR/NBNS Spoofing - Exploiting Active Directory-Integrated DNS&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Functions&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/Kevin-Robertson/Powermad/master/#machineaccountquota-functions&#34;&gt;MachineAccountQuota Functions&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/Kevin-Robertson/Powermad/master/#dns-functions&#34;&gt;DNS Functions&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/Kevin-Robertson/Powermad/master/#dynamic-updates-functions&#34;&gt;Dynamic Updates Functions&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/Kevin-Robertson/Powermad/master/#adidns-functions&#34;&gt;ADIDNS Functions&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/Kevin-Robertson/Powermad/master/#miscellaneous-functions&#34;&gt;Miscellaneous Functions&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;MachineAccountQuota Functions&lt;/h2&gt; &#xA;&lt;p&gt;The default Active Directory ms-DS-MachineAccountQuota attribute setting allows all domain users to add up to 10 machine accounts to a domain. Powermad includes a set of functions for exploiting ms-DS-MachineAccountQuota without attaching an actual system to AD.&lt;/p&gt; &#xA;&lt;h3&gt;Get-MachineAccountAttribute&lt;/h3&gt; &#xA;&lt;p&gt;This function can return values populated in a machine account attribute.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Get the value of &#39;description&#39; from a machine account names &#39;test&#39;.&lt;br&gt; &lt;code&gt;Get-MachineAccountAttribute -MachineAccount test -Attribute discription&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Get-MachineAccountCreator&lt;/h3&gt; &#xA;&lt;p&gt;This function leverages the ms-DS-CreatorSID property on machine accounts to return a list of usernames or SIDs and the associated machine account. The ms-DS-CreatorSID property is only populated when a machine account is created by an unprivileged user.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Get a list of all populated ms-DS-CreatorSID attributes.&lt;br&gt; &lt;code&gt;Get-MachineAccountCreator&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Disable-MachineAccount&lt;/h3&gt; &#xA;&lt;p&gt;This function can disable a machine account that was added through New-MachineAccount. This function should be used with the same user that created the machine account.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Disable a machine account named test.&lt;br&gt; &lt;code&gt;Disable-MachineAccount -MachineAccount test&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Enable-MachineAccount&lt;/h3&gt; &#xA;&lt;p&gt;This function can enable a machine account that was disabled through Disable-MachineAccount. This function should be used with the same user that created the machine account.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Enable a machine account named test.&lt;br&gt; &lt;code&gt;Enable-MachineAccount -MachineAccount test&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;New-MachineAccount&lt;/h3&gt; &#xA;&lt;p&gt;This function can add a new machine account directly through an LDAP add request to a domain controller and not by impacting the host system’s attachment status to Active Directory.&lt;/p&gt; &#xA;&lt;p&gt;The LDAP add request is modeled after the add request used when joining a system to a domain. The following (mostly validated by the DC) attributes are set:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;objectClass = Computer&lt;/li&gt; &#xA; &lt;li&gt;SamAccountName = Machine account name with trailing $&lt;/li&gt; &#xA; &lt;li&gt;userAccountControl = 4096&lt;/li&gt; &#xA; &lt;li&gt;DnsHostName = FQDN&lt;/li&gt; &#xA; &lt;li&gt;ServicePrincipalName = 2 HOST and 2 RestrictedKrbHost SPNs using both the FQDN and account name&lt;/li&gt; &#xA; &lt;li&gt;unicodePwd = the specified password&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;A new machine account can be used for tasks such as leveraging privilege provided to the ‘Domain Computers’ group or as an additional account for domain enumeration, DNS exploits, etc. By default, machine accounts do not have logon locally permission. You can either use tools/clients that accept network credentials directly or through the use of ‘runsas /netonly’ or @harmj0y’s Invoke-UserImpersonation/Invoke-RevertToSelf included with PowerView.&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://github.com/PowerShellMafia/PowerSploit/tree/dev/Recon&#34;&gt;https://github.com/PowerShellMafia/PowerSploit/tree/dev/Recon&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;Machine accounts created with standard users will have the mS-DS-CreatorSID populated with the standard user’s SID.&lt;/p&gt; &#xA;&lt;p&gt;Note that ms-DS-MachineAccountQuota does not provide the ability for authenticated users to delete added machine accounts from AD. Elevated privilege will need to be acquired to remove the account if you want to avoid passing the task off to your client.&lt;/p&gt; &#xA;&lt;h5&gt;Examples:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Add a new machine account&lt;br&gt; &lt;code&gt;New-MachineAccount -MachineAccount test&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Use the added account with runas /netonly&lt;br&gt; &lt;code&gt;runas /netonly /user:domain\test$ powershell&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Remove-MachineAccount&lt;/h3&gt; &#xA;&lt;p&gt;This function removes a machine account with a privileged account.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Remove a machine account named test with domain admin credentials&lt;br&gt; &lt;code&gt;Remove-MachineAccount -MachineAccount test -Credential $domainadmin&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Set-MachineAccountAttribute&lt;/h3&gt; &#xA;&lt;p&gt;This function can populate some attributes for an account that was added through New-MachineAccount, if a user has write access. This function should be used with the same user that created the machine account.&lt;/p&gt; &#xA;&lt;p&gt;Here is a list of some of the usual write access enabled attributes:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;AccountDisabled&lt;/li&gt; &#xA; &lt;li&gt;description&lt;/li&gt; &#xA; &lt;li&gt;displayName&lt;/li&gt; &#xA; &lt;li&gt;DnsHostName&lt;/li&gt; &#xA; &lt;li&gt;ServicePrincipalName&lt;/li&gt; &#xA; &lt;li&gt;userParameters&lt;/li&gt; &#xA; &lt;li&gt;userAccountControl&lt;/li&gt; &#xA; &lt;li&gt;msDS-AdditionalDnsHostName&lt;/li&gt; &#xA; &lt;li&gt;msDS-AllowedToActOnBehalfOfOtherIdentity&lt;/li&gt; &#xA; &lt;li&gt;SamAccountName&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h5&gt;Examples:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Remove the trailing &#39;$&#39; from the SamAccountName attribute&lt;br&gt; &lt;code&gt;Set-MachineAccountAttribute -MachineName test -Attribute SamAccountName -Value test&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Use the modified account with runas /netonly&lt;br&gt; &lt;code&gt;runas /netonly /user:domain\test powershell&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Invoke-AgentSmith&lt;/h3&gt; &#xA;&lt;p&gt;This function leverages New-MachineAccount to recursively create as many machine accounts as possible from a single unprivileged account through MachineAccountQuota. See the following blog post for details:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://blog.netspi.com/machineaccountquota-transitive-quota&#34;&gt;https://blog.netspi.com/machineaccountquota-transitive-quota&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;DNS Functions&lt;/h2&gt; &#xA;&lt;p&gt;By default, authenticated users have the &#39;Create all child objects&#39; permission on the Active Directory-Integrated DNS (ADIDNS) zone. Most records that do not currently exist in an AD zone can be added/deleted.&lt;/p&gt; &#xA;&lt;h2&gt;Dynamic Updates Functions&lt;/h2&gt; &#xA;&lt;h3&gt;Invoke-DNSUpdate&lt;/h3&gt; &#xA;&lt;p&gt;This function can be used to add/delete dynamic DNS records if the default setting of enabled secure dynamic updates is configured on a domain controller. A, AAAA, CNAME, MX, PTR, SRV, and TXT records are currently supported. Invoke-DNSUpdate is modeled after BIND`s nsupdate tool when using the &#39;-g&#39; or &#39;gsstsig&#39; options.&lt;/p&gt; &#xA;&lt;h5&gt;Examples:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Add an A record&lt;br&gt; &lt;code&gt;Invoke-DNSUpdate -DNSType A -DNSName www -DNSData 192.168.100.125&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Delete an A record&lt;br&gt; &lt;code&gt;Invoke-DNSUpdate -DNSType A -DNSName www.test.local&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Add an SRV record&lt;br&gt; &lt;code&gt;Invoke-DNSUpdate -DNSType SRV -DNSName _autodiscover._tcp.test.local -DNSData system.test.local -DNSPriority 100 -DNSWeight 80 -DNSPort 443&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;ADIDNS Functions&lt;/h2&gt; &#xA;&lt;h3&gt;Disable-ADIDNSNode&lt;/h3&gt; &#xA;&lt;p&gt;This function can tombstone an ADIDNS node.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;p&gt;*Tombstone a wildcard record.&lt;br&gt; `Disable-ADIDNSNode -Node *&lt;/p&gt; &#xA;&lt;h3&gt;Enable-ADIDNSNode&lt;/h3&gt; &#xA;&lt;p&gt;This function can turn a tombstoned node back into a valid record.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Enable a wildcard record.&lt;br&gt; &lt;code&gt;Enable-ADIDNSNode -Node *&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Get-ADIDNSNodeAttribute&lt;/h3&gt; &#xA;&lt;p&gt;This function can return values populated in a DNS node attribute.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Get the value populated dnsRecord attribute of a node named test.&lt;br&gt; &lt;code&gt;Get-ADIDNSNodeAttribute -Node test -Attribute dnsRecord&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Get-ADIDNSNodeOwner&lt;/h3&gt; &#xA;&lt;p&gt;This function can return the owner of an ADIDNS Node.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Get the owner of a node named test. &lt;code&gt;Get-ADIDNSNodeOwner -Node test&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Get-ADIDNSPermission&lt;/h3&gt; &#xA;&lt;p&gt;This function gets a DACL of an ADIDNS node or zone.&lt;/p&gt; &#xA;&lt;h5&gt;Examples:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Get the DACL for the default Active Directory-Integrated Zone from a domain attached system.&lt;br&gt; &lt;code&gt;Get-ADIDNSPermission&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Get the DACL for a DNS node named test from a domain attached system.&lt;br&gt; &lt;code&gt;Get-ADIDNSPermission -Node test&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Get-ADIDNSZone&lt;/h3&gt; &#xA;&lt;p&gt;This function can return ADIDNS zones.&lt;/p&gt; &#xA;&lt;h5&gt;Examples:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Get all ADIDNS zones.&lt;br&gt; &lt;code&gt;Get-ADIDNSZone&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Grant-ADIDNSPermission&lt;/h3&gt; &#xA;&lt;p&gt;This function adds an ACE to a DNS node or zone DACL.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Add full access to a wildcard record for &#34;Authenticated Users&#34;.&lt;/li&gt; &#xA; &lt;li&gt;Add full access to a wildcard record for &#34;Authenticated Users&#34;.&lt;br&gt; &lt;code&gt;Grant-ADIDNSPermission -Node * -Principal &#34;authenticated users&#34;&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;New-ADIDNSNode&lt;/h3&gt; &#xA;&lt;p&gt;This function adds a DNS node to an Active Directory-Integrated DNS (ADIDNS) Zone through an encrypted LDAP add request.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Add a wildcard record to a ADIDNS zone and tombstones the node.&lt;br&gt; &lt;code&gt;New-ADIDNSNode -Node * -Tombstone&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;New-DNSRecordArray&lt;/h3&gt; &#xA;&lt;p&gt;This function creates a valid byte array for the dnsRecord attribute.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Create a dnsRecord array for an A record pointing to 192.168.0.1.&lt;br&gt; &lt;code&gt;New-DNSRecordArray -Data 192.168.0.1&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;New-SOASerialNumberArray&lt;/h3&gt; &#xA;&lt;p&gt;This function gets the current SOA serial number for a DNS zone and increments it by the set amount.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Generate a byte array from the currect SOA serial number incremented by one.&lt;br&gt; &lt;code&gt;New-SOASerialNumberArray&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Rename-ADIDNSNode&lt;/h3&gt; &#xA;&lt;p&gt;This function can rename a DNS node.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Renames a DNS node named test to test2.&lt;br&gt; &lt;code&gt;Rename-ADIDNSNode -Node test -NodeNew test2&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Remove-ADIDNSNode&lt;/h3&gt; &#xA;&lt;p&gt;This function can remove a DNS node.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Removes a wildcard node.&lt;br&gt; &lt;code&gt;Remove-ADIDNSNode -Node *&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Revoke-ADIDNSPermission&lt;/h3&gt; &#xA;&lt;p&gt;This function removes an ACE to a DNS node or zone DACL.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Remove the GenericAll ACE associated with the user1 account.&lt;br&gt; &lt;code&gt;Revoke-ADIDNSPermission -Node * -Principal user1 -Access GenericAll&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Set-ADIDNSNodeAttribute&lt;/h3&gt; &#xA;&lt;p&gt;This function can append, populate, or overwrite values in a DNS node attribute.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Set the writable description attribute on a node named test.&lt;br&gt; &lt;code&gt;Set-ADIDNSNodeAttribute -Node test -Attribute description -Value &#34;do not delete&#34;&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Set-ADIDNSNodeOwner&lt;/h3&gt; &#xA;&lt;p&gt;This function can set the owner of a DNS Node. Note that a token with SeRestorePrivilege is required.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Set the owner of a node named test to user1.&lt;br&gt; &lt;code&gt;Set-ADIDNSNodeOwner -Node test -Principal user1&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h1&gt;Miscellaneous Functions&lt;/h1&gt; &#xA;&lt;h2&gt;Get-KerberosAESKey&lt;/h2&gt; &#xA;&lt;p&gt;This function can generate Kerberos AES 256 and 128 keys from a known username and password. This can be used to test pass the hash in invoke-DNSUpdate.&lt;/p&gt; &#xA;&lt;h5&gt;Example:&lt;/h5&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Generate keys for a valid AD user named &lt;a href=&#34;mailto:user@test.local&#34;&gt;user@test.local&lt;/a&gt;.&lt;br&gt; &lt;code&gt;Get-KerberosAESKey -Salt TEST.LOCALuser&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt;</summary>
  </entry>
</feed>