<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub PowerShell Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2024-05-21T01:31:37Z</updated>
  <subtitle>Daily Trending of PowerShell in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>matriex/cmatrix</title>
    <updated>2024-05-21T01:31:37Z</updated>
    <id>tag:github.com,2024-05-21:/matriex/cmatrix</id>
    <link href="https://github.com/matriex/cmatrix" rel="alternate"></link>
    <summary type="html">&lt;p&gt;The Matrix effect&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;cmatrix Effect&lt;/h1&gt; &#xA;&lt;p&gt;The matrix effect on Windows through &lt;code&gt;PowerShell&lt;/code&gt;&lt;/p&gt; &#xA;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/matriex/cmatrix/master/demo.gif&#34; alt=&#34;Matrix&#34; title=&#34;Matrix effect&#34;&gt;&lt;/p&gt; &#xA;&lt;h2&gt;How to&lt;/h2&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt; &lt;p&gt;Open &lt;code&gt;Windows Powershell&lt;/code&gt; (in some cases Admin privilege might be needed)&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Either download and save &lt;a href=&#34;https://raw.githubusercontent.com/matriex/cmatrix/master/cmatrix.psm1&#34;&gt;cmatrix.psm1&lt;/a&gt; or just clonethis repo using &lt;code&gt;git clone https://github.com/matriex/cmatrix&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Import the module, set the timeout and enable it:&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;Set-Executionpolicy remotesigned&#xA;Import-Module .\cmatrix&#xA;Set-ScreenSaverTimeout -Seconds 5&#xA;Enable-ScreenSaver&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;If you are happy with it, then you can put it also in one of your module folders that you can get via &lt;code&gt;$env:PSModulePath&lt;/code&gt;. Just create a folder named &lt;code&gt;cmatrix&lt;/code&gt; and put &lt;code&gt;cmatrix.psm1&lt;/code&gt; in it and then the next time you can just import it as &lt;code&gt;Import-Module cmatrix&lt;/code&gt; without having to specify the full path.&lt;/p&gt; &#xA;&lt;p&gt;&lt;em&gt;Author: Oisin Grehan&lt;/em&gt;&lt;/p&gt; &#xA;&lt;p&gt;&lt;em&gt;Contributor: Christoph Bergmeister&lt;/em&gt;&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>workoho/Entra-Tiering-Security-Model</title>
    <updated>2024-05-21T01:31:37Z</updated>
    <id>tag:github.com,2024-05-21:/workoho/Entra-Tiering-Security-Model</id>
    <link href="https://github.com/workoho/Entra-Tiering-Security-Model" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Implement a powerful Tiering Security Model in Microsoft Entra for your Cloud Administrator identities using Azure Automation.&lt;/p&gt;&lt;hr&gt;&lt;p&gt;&lt;a name=&#34;readme-top&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;!-- PROJECT SHIELDS --&gt; &#xA;&lt;!--&#xA;*** I&#39;m using markdown &#34;reference style&#34; links for readability.&#xA;*** Reference links are enclosed in brackets [ ] instead of parentheses ( ).&#xA;*** See the bottom of this document for the declaration of the reference variables&#xA;*** for contributors-url, forks-url, etc. This is an optional, concise syntax you may use.&#xA;*** https://www.markdownguide.org/basic-syntax/#reference-style-links&#xA;--&gt; &#xA;&lt;div align=&#34;center&#34;&gt; &#xA; &lt;p&gt;&lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model/graphs/contributors&#34;&gt;&lt;img src=&#34;https://img.shields.io/github/contributors/Workoho/Entra-Tiering-Security-Model.svg?style=for-the-badge&#34; alt=&#34;Contributors&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model/network/members&#34;&gt;&lt;img src=&#34;https://img.shields.io/github/forks/Workoho/Entra-Tiering-Security-Model.svg?style=for-the-badge&#34; alt=&#34;Forks&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model/stargazers&#34;&gt;&lt;img src=&#34;https://img.shields.io/github/stars/Workoho/Entra-Tiering-Security-Model.svg?style=for-the-badge&#34; alt=&#34;Stargazers&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model/issues&#34;&gt;&lt;img src=&#34;https://img.shields.io/github/issues/Workoho/Entra-Tiering-Security-Model.svg?style=for-the-badge&#34; alt=&#34;Issues&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model/raw/master/LICENSE.txt&#34;&gt;&lt;img src=&#34;https://img.shields.io/github/license/Workoho/Entra-Tiering-Security-Model.svg?style=for-the-badge&#34; alt=&#34;MIT License&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://workoho.com/&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/Workoho.com-00B3CE?style=for-the-badge&amp;amp;logo=data:image/svg%2bxml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEzNDggOTEzIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MjsiPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNC4wNzQ3OCwwLDAsMy45NjAzOCwtNzQzMS4xNSwtNDYzNC44OCkiPgogICAgICAgIDxnPgogICAgICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg4LjY2MzI2ZS0xOCwwLjE0MTQ4MiwtMC4xNDE0ODIsOC42NjMyNmUtMTgsNDA1Ny43MiwtNDI5LjM1KSI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTI3MjYsMTM0NTIuN0wxMjc2Mi4zLDEzNDUyLjdMMTI5MzUuOCwxNDE2Ni40TDEyODk2LjEsMTQxNjYuNEwxMjcyNi44LDEzOTQ2LjRMMTI1NDMsMTM4OTAuM0wxMjcyNiwxMzQ1Mi43WiIvPgogICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDg0NDk1NCwwLDAsMC4wODQ0OTU0LDE5NDEuOCwxMTA4LjU1KSI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUxOC42MSwyOTk1LjQzTDExOTEuNDksMjk5NS40M0wxMDIyLjcsMzExMS40NkwxMDIyLjcsMzIxNS4wMUwxMjk3LjcsMzIxNS4wMUwxNTE4LjYxLDMwNjIuMDVMMTUxOC42MSwyOTk1LjQzWiIvPgogICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDg0NDk1NCwwLDAsMC4wODQ0OTU0LDE4MTQuMDMsMTEwOC41NSkiPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTE5MTMuNDIsMjk5NS40M0wxMTkxLjQ5LDI5OTUuNDNMMTAyMi43LDMxMTEuNDZMMTAyMi43LDMyMTUuMDFMMTY5Mi41MiwzMjE1LjAxTDE5MTMuNDIsMzA2Mi4wNUwxOTEzLjQyLDI5OTUuNDNaIi8+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDg0NDk1NCwwLDAsMC4wODQ0OTU0LDE3MzEuODUsOTE3LjIxKSI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTkxMy40MiwyOTk1LjQzTDEyNTUuNzQsMjk5NS40M0wxMDg2Ljk0LDMxMTEuNDZMMTA4Ni45NCwzMjE1LjAxTDE2OTIuNTIsMzIxNS4wMUwxOTEzLjQyLDMwNjIuMDVMMTkxMy40MiwyOTk1LjQzWiIgc3R5bGU9ImZpbGw6d2hpdGU7Ii8+CiAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoMC45Mzc1NTgsMCwwLDAuOTM3NTU4LC00NzYwLjU0LC00MDgzLjg4KSI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNzIwMi4xMiw1NjcxLjYzTDcyMDIuMTIsNTY4MC45TDcxNjMuNiw1NzIzLjM0TDcyNDAuODksNTgxOC43Mkw3MjQwLjg5LDU4MjcuOTlMNzIxMy40Myw1ODI3Ljk5TDcxMzkuNTMsNTczNy4wN0w3MTA0LjYxLDU3MzcuMDdMNzEwNC42MSw1ODI3Ljk5TDcwNzcuMzIsNTgyNy45OUw3MDc3LjMyLDU2MjMuOTFMNzEwNC42MSw1NjIzLjkxTDcxMDQuNjEsNTcwOS42MUw3MTM5LjUzLDU3MDkuNjFMNzE3NC42Niw1NjcxLjYzTDcyMDIuMTIsNTY3MS42M1oiIHN0eWxlPSJmaWxsOndoaXRlO2ZpbGwtcnVsZTpub256ZXJvOyIvPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K&#34; alt=&#34;Workoho&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;/div&gt; &#xA;&lt;!-- PROJECT LOGO --&gt; &#xA;&lt;br&gt; &#xA;&lt;div align=&#34;center&#34;&gt; &#xA; &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model&#34;&gt; &lt;img src=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/images/logo.svg?sanitize=true&#34; alt=&#34;Logo&#34; width=&#34;180&#34; height=&#34;180&#34;&gt; &lt;/a&gt; &#xA; &lt;h3 align=&#34;center&#34;&gt;Cloud Administration Tiering Security Model for Microsoft Entra&lt;/h3&gt; &#xA; &lt;p align=&#34;center&#34;&gt; Implement a powerful Tiering Security Model in Microsoft Entra for your Cloud Administrator identities using Azure Automation. &lt;br&gt; &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model/wiki&#34;&gt;&lt;strong&gt;Explore the docs »&lt;/strong&gt;&lt;/a&gt; &lt;br&gt; &lt;/p&gt;&#xA; &lt;p&gt;&lt;a href=&#34;https://codespaces.new/Workoho/Entra-Tiering-Security-Model&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/Open%20in-GitHub%20Codespaces-blue?logo=github&#34; alt=&#34;Open template in GitHub Codespaces&#34;&gt;&lt;/a&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;a href=&#34;https://vscode.dev/github/Workoho/Entra-Tiering-Security-Model&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/View%20Online%20in-Visual%20Studio%20Code-blue?logo=visual-studio-code&#34; alt=&#34;View template online in Visual Studio Code&#34;&gt;&lt;/a&gt; &lt;br&gt; &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model/issues/new?labels=bug&amp;amp;template=bug-report---.md&#34;&gt;Report Bug&lt;/a&gt; · &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model/issues/new?labels=enhancement&amp;amp;template=feature-request---.md&#34;&gt;Request Feature&lt;/a&gt;&lt;/p&gt; &#xA; &lt;p&gt;&lt;/p&gt; &#xA;&lt;/div&gt; &#xA;&lt;!-- TABLE OF CONTENTS --&gt; &#xA;&lt;details&gt; &#xA; &lt;summary&gt;Table of Contents&lt;/summary&gt; &#xA; &lt;ol&gt; &#xA;  &lt;li&gt; &lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#about-the-project&#34;&gt;About The Project&lt;/a&gt; &#xA;   &lt;ul&gt; &#xA;    &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#built-with&#34;&gt;Built With&lt;/a&gt;&lt;/li&gt; &#xA;   &lt;/ul&gt; &lt;/li&gt; &#xA;  &lt;li&gt; &lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#getting-started&#34;&gt;Getting Started&lt;/a&gt; &#xA;   &lt;ul&gt; &#xA;    &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#prerequisites&#34;&gt;Prerequisites&lt;/a&gt;&lt;/li&gt; &#xA;    &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#installation&#34;&gt;Installation&lt;/a&gt;&lt;/li&gt; &#xA;    &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#minimum-permissions-for-the-administrator-account-during-the-initial-interactive-setup-session&#34;&gt;Overview of permissions during setup&lt;/a&gt;&lt;/li&gt; &#xA;    &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#minimum-permissions-after-the-setup-of-the-azure-automation-account&#34;&gt;Overview of permissions after setup&lt;/a&gt;&lt;/li&gt; &#xA;   &lt;/ul&gt; &lt;/li&gt; &#xA;  &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#usage&#34;&gt;Usage&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#contributing&#34;&gt;Contributing&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#license&#34;&gt;License&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#maintainers&#34;&gt;Maintainers&lt;/a&gt;&lt;/li&gt; &#xA; &lt;/ol&gt; &#xA;&lt;/details&gt; &#xA;&lt;!-- ABOUT THE PROJECT --&gt; &#xA;&lt;h2&gt;About The Project&lt;/h2&gt; &#xA;&lt;p&gt;This project provides you with a template for implementing a basic security model for tier separation in your Microsoft cloud environment. This significantly helps to separate the security of your on-premises and cloud environment and &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/architecture/protect-m365-from-on-premises-attacks&#34;&gt;protect Microsoft 365 from on-premises attacks&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;p&gt;The implementation and maintenance effort can be uge and requires deep knowledge in multiple Microsoft technologies and security principles. Using this project as a template, it helps to set up highly protected security groups using &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-restricted-management&#34;&gt;Management Restricted Administrative Units&lt;/a&gt; and by delegation of maintenance and provisioning tasks for dedicated, cloud-native Cloud Administrator accounts to a locked &lt;a href=&#34;https://learn.microsoft.com/en-us/azure/automation/overview&#34;&gt;Azure Automation account&lt;/a&gt; with &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview&#34;&gt;System-Assigned Managed Identity&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;p&gt;These highly protected security groups form the basis for the implementation of Microsoft Entra security measures in Conditional Access, such as &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-conditional-access-cloud-apps#authentication-context&#34;&gt;Authentication Contexts&lt;/a&gt; for the use of &lt;a href=&#34;https://learn.microsoft.com/en-us/graph/identity-governance-pim-rules-overview#activation-rules&#34;&gt;Activation Rules in Privileged Identity Management&lt;/a&gt; and &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/protected-actions-overview&#34;&gt;Protected Actions&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;p&gt;The following graphic illustrates the tier separation concept at a high level:&lt;/p&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/documents/Entra-Tiering-Security-Model-Cloud%20Account%20Tier%20Separation.pdf&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/images/Entra-Tiering-Security-Model-Cloud%20Account%20Tier%20Separation.png&#34; alt=&#34;How the Tier separation works&#34; title=&#34;Cloud Administrator Account Tier Separation&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p&gt;The lifecycle management of dedicated, cloud-native Cloud Administrator accounts is tied to a primary user account. The properties are automatically copied from this account and can be updated regularly to keep them synchronized.&lt;/p&gt; &#xA;&lt;p&gt;Preferably, the primary account is a company account or can even be an external guest account (not implemented yet). This ties the lifecycle management of the dedicated Cloud Administrator account to the existing lifecycle of the users.&lt;/p&gt; &#xA;&lt;p&gt;If your Microsoft Entra tenant was configured for &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/hybrid/whatis-hybrid-identity&#34;&gt;Hybrid Identities&lt;/a&gt;, only synchronized identitied from your on-premises Active Directory are eligible to create a cloud administration account.&lt;/p&gt; &#xA;&lt;blockquote&gt; &#xA; &lt;p&gt;&lt;span&gt;ℹ&lt;/span&gt; In case of using guest accounts, we strongly recommend to implement an appropriate lifecycle management first, for example with &lt;a href=&#34;https://easylife365.cloud/products/collaboration/&#34;&gt;EasyLife 365 Collaboration&lt;/a&gt;.&lt;/p&gt; &#xA; &lt;p&gt;&lt;em&gt;Workoho&lt;/em&gt; is an official EasyLife partner. &lt;a href=&#34;https://workoho.com/kontakt/&#34;&gt;Contact us&lt;/a&gt; if you need help managing your guest identities.&lt;/p&gt; &#xA;&lt;/blockquote&gt; &#xA;&lt;p&gt;The following graphic illustrates the lifecycle concept at a high level:&lt;/p&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/documents/Entra-Tiering-Security-Model-Cloud%20Admin%20Lifecycle.pdf&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/images/Entra-Tiering-Security-Model-Cloud%20Admin%20Lifecycle.png&#34; alt=&#34;How lifecycle management for dedicated Cloud Administrator account works&#34; title=&#34;Connection between Dedicated Cloud Administrator and Primary Account&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h3&gt;Built With&lt;/h3&gt; &#xA;&lt;div align=&#34;center&#34;&gt; &#xA; &lt;p&gt;&lt;a href=&#34;https://github.com/workoho/AzAuto-Common-Runbook-FW&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/Azure_Automation_Framework-1F4386?style=for-the-badge&amp;amp;logo=microsoftazure&amp;amp;logoColor=white&#34; alt=&#34;Azure Automation Framework&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://github.com/features/codespaces&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/GitHub_Codespaces-09091E?style=for-the-badge&amp;amp;logo=github&amp;amp;logoColor=white&#34; alt=&#34;GitHub Codespaces&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://code.visualstudio.com/&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/Visual_Studio_Code-2C2C32?style=for-the-badge&amp;amp;logo=visualstudiocode&amp;amp;logoColor=3063B4&#34; alt=&#34;Visual Studio Code&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://microsoft.com/PowerShell&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/PowerShell-2C3C57?style=for-the-badge&amp;amp;logo=powershell&amp;amp;logoColor=white&#34; alt=&#34;PowerShell&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;/div&gt; &#xA;&lt;p align=&#34;right&#34;&gt;(&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#readme-top&#34;&gt;back to top&lt;/a&gt;)&lt;/p&gt; &#xA;&lt;!-- GETTING STARTED --&gt; &#xA;&lt;h2&gt;Getting Started&lt;/h2&gt; &#xA;&lt;p&gt;The entire setup is fully automatic (thanks to the amazing &lt;a href=&#34;https://github.com/workoho/AzAuto-Common-Runbook-FW&#34;&gt;Azure Automation Common Runbook Framework&lt;/a&gt;), but requires some preparation and decision making to start.&lt;/p&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://asciinema.org/a/646552&#34;&gt;&lt;img src=&#34;https://asciinema.org/a/646552.svg?sanitize=true&#34; alt=&#34;asciicast&#34;&gt;&lt;/a&gt; &lt;em&gt;Preview of the setup procedure&lt;/em&gt;&lt;/p&gt; &#xA;&lt;h3&gt;Prerequisites&lt;/h3&gt; &#xA;&lt;p&gt;Your Microsoft Entra ID tenant must be enabled and licensed for &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-configure&#34;&gt;Privileged Identity Management&lt;/a&gt;, which is a premium feature and part of the Microsoft Entra ID P2 licensing plan. Note that this could also be part of your Microsoft 365 E5 or Enterprise Mobility &amp;amp; Security E5 license. Visit &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/fundamentals/get-started-premium&#34;&gt;Sign up for Microsoft Entra ID P1 or P2 editions &lt;/a&gt; on Microsoft Learn for further information.&lt;/p&gt; &#xA;&lt;p&gt;You must also have free Exchange Online licenses for each dedicated Cloud Administrator account to enable email forwarding. &lt;em&gt;Exchange Online Kiosk&lt;/em&gt; is a good and cost-effective solution, but any other license with an Exchange service plan is also suitable.&lt;/p&gt; &#xA;&lt;p&gt;Furthermore, &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-emergency-access&#34;&gt;emergency access admin accounts&lt;/a&gt; must be in place to have them available for &lt;em&gt;&#34;break glass&#34;&lt;/em&gt; scenarios.&lt;/p&gt; &#xA;&lt;p&gt;We assume that the following requirements for your local Windows, macOS, or Linux machine are already met and do not describe them in detail here:&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/devops/develop/git/install-and-set-up-git&#34;&gt;Git&lt;/a&gt; is installed.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell&#34;&gt;PowerShell&lt;/a&gt; is installed.&lt;/p&gt; &lt;p&gt;We recommend using the latest version of PowerShell Core, but Windows PowerShell should do as well.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Optional: &lt;a href=&#34;https://www.7-zip.org/download.html&#34;&gt;7-Zip&lt;/a&gt; is installed. This may be used to encrypt configuration files if you would like to protect their content, but still check them into your Git repository.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Following PowerShell modules are installed:&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;&lt;code&gt;Microsoft.Graph&lt;/code&gt;&lt;/li&gt; &#xA;   &lt;li&gt;&lt;code&gt;Microsoft.Graph.Beta&lt;/code&gt;&lt;/li&gt; &#xA;   &lt;li&gt;&lt;code&gt;Az&lt;/code&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;p&gt;For local run and/or development, further modules are required:&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;&lt;code&gt;ExchangeOnlineManagement&lt;/code&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Might be optional, but &lt;em&gt;highly recommended&lt;/em&gt;: &lt;a href=&#34;https://code.visualstudio.com/docs/setup/setup-overview&#34;&gt;Visual Studio Code&lt;/a&gt; is installed.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;On Windows, it is preferred to have &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/create-symbolic-links&#34;&gt;SeCreateSymbolicLinkPrivilege&lt;/a&gt; enabled for your local user account. However, this is not a fixed requirement.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;blockquote&gt; &#xA; &lt;p&gt;&lt;span&gt;💟&lt;/span&gt; Or: You forget about all of these dependencies and start right away with our prepared build and runtime environment using GitHub Codespaces: No time to setup your local machine, no policy restrictions - simply start effortless &lt;span&gt;😎&lt;/span&gt;&lt;/p&gt; &#xA; &lt;p&gt;&lt;a href=&#34;https://codespaces.new/Workoho/Entra-Tiering-Security-Model&#34;&gt;&lt;img src=&#34;https://github.com/codespaces/badge.svg?sanitize=true&#34; alt=&#34;Open template in GitHub Codespaces&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA; &lt;p&gt;Alternatively, you may use any type of &lt;a href=&#34;https://code.visualstudio.com/docs/devcontainers/containers&#34;&gt;development container&lt;/a&gt; with your local Visual Studio Code setup. We provide pre-configured Docker containers for Windows Subsystem for Linux (Intel x64), Linux (Intel x64 and ARM64), and macOS (Intel x64 and Apple Silicon).&lt;/p&gt; &#xA; &lt;p&gt;For further information, read &lt;a href=&#34;https://code.visualstudio.com/docs/containers/choosing-dev-environment&#34;&gt;Choosing your development environment&lt;/a&gt; at Visual Studio Code Docs.&lt;/p&gt; &#xA;&lt;/blockquote&gt; &#xA;&lt;h3&gt;Installation&lt;/h3&gt; &#xA;&lt;p&gt;The following steps only need to be performed once to get you started:&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt; &lt;p&gt;Open a PowerShell command line prompt.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Make a local clone of this repository and change to the directory afterwards:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;$CORP=&#39;CORP&#39;&#xA;mkdir $CORP&#xA;cd $CORP&#xA;git clone https://github.com/workoho/Entra-Tiering-Security-Model.git $CORP.Entra-Tiering-Security-Model&#xA;cd $CORP.Entra-Tiering-Security-Model&#xA;&#xA;# Rename the Visual Studio Code workspace&#xA;Rename-Item ./Entra-Tiering-Security-Model.code-workspace $CORP.Entra-Tiering-Security-Model.code-workspace&#xA;&#xA;# Remove the remote tracking and rename the remote from &#39;origin&#39; to &#39;base&#39; for future updating&#xA;git branch --unset-upstream main&#xA;git remote rename origin base&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;You should set &lt;code&gt;$CORP&lt;/code&gt; to your company name code to indicate that this is containing your own setup.&lt;/p&gt; &lt;p&gt;Note that we are also creating a dedicated folder for our project. In step 3, we are going to clone a second repository containing the Azure Automation Common Runbook Framework code that lives in parallel to our project repository. In case you are dealing with different environments, this ensures each environment uses its own copy of the framework and can check out their version of the framework without interfering your other environment.&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;em&gt;Optional:&lt;/em&gt; You may add your own remote respository to upload your local changes, for example to an empty (private) repository you have created in your own GitHub organization:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;git remote add origin git@github.com:username/CORP.Entra-Tiering-Security-Model.git&#xA;git push --set-upstream origin main&#xA;git push --tags origin&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Note that the URL depends on how you authenticate and access your remote repository and may look different. For example, if you prefer to access your repository via HTTPS instead of SSH, the command would look like this:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;git remote add origin https://github.com/username/CORP.Entra-Tiering-Security-Model.git&#xA;git push --set-upstream origin main&#xA;git push --tags origin&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Trigger downloading the upstream Azure Automation Common Runbook Framework:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;./scripts/AzAutoFWProject/Update-AzAutoFWProject.ps1&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;This will automatically clone the upstream framework into a directory that is parallel to your project repository. It will automatically check out the desired version of the framework, based on your settings in &lt;code&gt;./config/AzAutoFWProject/AzAutoFWProject.psd1&lt;/code&gt;. The default is a static reference to the latest stable version at the time you cloned the repository.&lt;/p&gt; &lt;p&gt;The resulting folder structure now should look like this:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-plaintext&#34;&gt;PS&amp;gt; dir ..&#xA;&#xA;    Directory: /Users/me/Developer/CORP&#xA;&#xA;UnixMode    User  Group  LastWriteTime     Size  Name&#xA;----------  ----  -----  ----------------  ----  ----&#xA;drwxr-xr-x  me    staff  06.03.2024 10:20  640   AzAuto-Common-Runbook-FW&#xA;drwxr-xr-x  me    staff  06.03.2024 10:20  672   CORP.Entra-Tiering-Security-Model&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Also, shared resources like script and runbooks will either be copied into your project repository, or symlinked (depending on your operating system and its settings). For example, on &lt;strong&gt;macOS&lt;/strong&gt; and &lt;strong&gt;Linux&lt;/strong&gt; (including Windows Subsystem for Linux), symlinking shared resources is the default behaviour to ensure they will always be in sync.&lt;/p&gt; &lt;p&gt;On &lt;strong&gt;Windows&lt;/strong&gt;, symlinking may only be used if the &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/create-symbolic-links&#34;&gt;SeCreateSymbolicLinkPrivilege&lt;/a&gt; permission was enabled for your local user account. Otherwise, the resources will be copied. If you would like to update the shared resources, you may execute the &lt;code&gt;./scripts/AzAutoFWProject/Update-AzAutoFWProject.ps1&lt;/code&gt; update script at any time.&lt;/p&gt; &lt;p&gt;&lt;strong&gt;Good to know:&lt;/strong&gt; When you open the project repository in &lt;em&gt;Visual Studio Code&lt;/em&gt;, an &lt;a href=&#34;https://code.visualstudio.com/docs/editor/tasks&#34;&gt;automated task&lt;/a&gt; will run the update script so you don&#39;t have to.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;The configuration is splitted into two separate files:&lt;/p&gt; &#xA;  &lt;ol&gt; &#xA;   &lt;li&gt; &lt;p&gt;Local configuration in &lt;code&gt;./config/AzAutoFWProject/AzAutoFWProject.local.psd1&lt;/code&gt;:&lt;/p&gt; &lt;p&gt;This file typically exists on your local machine only. It may contain parts of the configuration that you consider to be confidential for your company.&lt;/p&gt; &lt;p&gt;The &lt;code&gt;Update-AzAutoFWProject.ps1&lt;/code&gt; script you ran before already should have created a copy for you but you may also do this manually:&lt;/p&gt; &lt;p&gt;Copy the configuration template from &lt;code&gt;./config/AzAutoFwProject/AzAutoFWProject.local.template.psd1&lt;/code&gt; to &lt;code&gt;./config/AzAutoFwProject/AzAutoFWProject.local.psd1&lt;/code&gt;:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;copy ./config/AzAutoFWProject/AzAutoFWProject.local.template.psd1 ./config/AzAutoFWProject/AzAutoFWProject.local.psd1&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Please note that by default, this configuration file is ignored by the Git repository to avoid accidential leaks of potential sensitive information.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;Public configuration in &lt;code&gt;./config/AzAutoFWProject/AzAutoFWProject.psd1&lt;/code&gt;:&lt;/p&gt; &lt;p&gt;This file is part of your Git project repository and subject to tracking of changes. Essential parts of the configuration are done in this file where the general information is not considered a secret and its content is to be shared with everyone with access to your Git repository.&lt;/p&gt; &lt;p&gt;The &lt;code&gt;Update-AzAutoFWProject.ps1&lt;/code&gt; script you ran before already should have created a copy for you but you may also do this manually:&lt;/p&gt; &lt;p&gt;Copy the configuration template from &lt;code&gt;./config/AzAutoFwProject/AzAutoFWProject.template.psd1&lt;/code&gt; to &lt;code&gt;./config/AzAutoFwProject/AzAutoFWProject.psd1&lt;/code&gt;:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;copy ./config/AzAutoFWProject/AzAutoFWProject.template.psd1 ./config/AzAutoFWProject/AzAutoFWProject.psd1&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;/li&gt; &#xA;  &lt;/ol&gt; &lt;p&gt;&lt;strong&gt;Important:&lt;/strong&gt; Some parts of the configuration may be moved between the two files. However, it is not a general concept and is only supported where it is explicitly explained.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Open &lt;code&gt;./config/AzAutoFWProject/AzAutoFWProject.local.psd1&lt;/code&gt; in your favorite editor.&lt;/p&gt; &lt;p&gt;This project template provides a pre-configured build and development environment for &lt;em&gt;Visual Studio Code&lt;/em&gt;, which is why we recommend using this to edit configuration files. You will also be able to collapse and extend longer regions and sections to maneuver through it.&lt;/p&gt; &lt;p&gt;In this configuration file, you will need to enter details like:&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;Name&lt;/code&gt;&lt;/p&gt; &lt;p&gt;Name your Automation Account to whatever you like, e.g. &lt;code&gt;prodsub-germanywestcentral-aa001&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Note that you will not be able to change the account name after the Automation Account was created.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;TenantId&lt;/code&gt;&lt;/p&gt; &lt;p&gt;The UUID of your Microsoft Entra ID tenant, e.g. &lt;code&gt;e83262cb-7b0b-4d13-9496-455b378896e4&lt;/code&gt;.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;SubscriptionId&lt;/code&gt;&lt;/p&gt; &lt;p&gt;The UUID of your Azure Subscription, e.g. &lt;code&gt;f47626a6-2970-41a8-b44c-a4a14ccff181&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Please note that the subscription &lt;strong&gt;must&lt;/strong&gt; be associated to the &lt;code&gt;TenantId&lt;/code&gt;.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;ResourceGroupName&lt;/code&gt;&lt;/p&gt; &lt;p&gt;The name of the resource group where you want your Azure Automation Account to live.&lt;/p&gt; &lt;p&gt;Please note that a pre-existing resource group &lt;strong&gt;must&lt;/strong&gt; be in the &lt;code&gt;SubscriptionId&lt;/code&gt; you entered before. If this resource group does not exist yet, it will automatically be created in the given subscription. You must have at least &lt;code&gt;Contributor&lt;/code&gt; role assigned for the subscription for this to work (also see minimum permissions for &lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#1-setup-azure-roles&#34;&gt;1. Azure roles&lt;/a&gt; below).&lt;/p&gt; &lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;p&gt;As mentioned earliert, this file is by default not tracked in the Git repository. Here are a few options how you can backup this file:&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;em&gt;Option 1 (Preferred):&lt;/em&gt; Store on a local server and keep it separate from the Git repository.&lt;/p&gt; &lt;p&gt;This is the safest option, but might not be easy to handle during daily operations when you need to find the file later.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;em&gt;Option 2:&lt;/em&gt; Encrypted ZIP archive using 7-zip.&lt;/p&gt; &lt;p&gt;As a compromise, you may add the file to an encrypted ZIP archive and add this file to the repository:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;cd ./config/AzAutoFWProject/&#xA;7z a -p -tzip AzAutoFWProject.local.psd1.zip AzAutoFWProject.local.psd1&#xA;git add --force AzAutoFWProject.local.psd1.zip&#xA;git commit -m &#34;Add ZIP-encrypted file of AzAutoFWProject.local.psd1&#34;&#xA;git push&#xA;cd -&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Attention: Make sure that you are actually adding the &lt;code&gt;.zip&lt;/code&gt; file, &lt;em&gt;not&lt;/em&gt; the plain &lt;code&gt;.psd1&lt;/code&gt; file (fans using &lt;a href=&#34;https://learn.microsoft.com/en-us/powershell/scripting/learn/shell/tab-completion&#34;&gt;tab completion&lt;/a&gt; might know what I mean).&lt;/p&gt; &lt;p&gt;Of course, you must remember the password. We recommend using a password manager to generate a long random password. If you ever want to use this file on a different machine, you will need this password to unpack the file.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;em&gt;Option 3:&lt;/em&gt; Force adding it to the Git repository.&lt;/p&gt; &lt;p&gt;If you decide to add it to your repository, it is strongly recommended to ensure only selected persons have read access to the repository to keep this information safe:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;git add --force ./config/AzAutoFWProject/AzAutoFWProject.local.psd1&#xA;git commit -m &#34;Forcibly add AzAutoFWProject.local.psd1&#34;&#xA;git push&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Review and adjust default settings in &lt;code&gt;./config/AzAutoFWProject/AzAutoFWProject.psd1&lt;/code&gt; to your liking.&lt;/p&gt; &lt;p&gt;You want to pay special attention to these three sections:&lt;/p&gt; &#xA;  &lt;ol&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;ManagedIdentity&lt;/code&gt;&lt;/p&gt; &lt;p&gt;Review the permissions that will permanently assigned to the System-Assigned Managed Identity of the Automation Account. A short justification information is provided in the configuration file so you can understand what the permissions are used for. Removing any of them will result in runbooks not working anymore.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;AdministrativeUnit&lt;/code&gt;&lt;/p&gt; &lt;p&gt;Review the &lt;code&gt;DisplayName&lt;/code&gt; for the Administrative Units to be be created and the desired permissions that the administrator account you are using for the setup will receive.&lt;/p&gt; &lt;p&gt;You may also pay attention at the specific settings that are not quite common, like enabling &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-restricted-management&#34;&gt;Restricted Management&lt;/a&gt;, or restricting the membership visibility. Note that these two settings can only be set during creation and not changed afterwards.&lt;/p&gt; &lt;p&gt;The &lt;code&gt;MembershipRule&lt;/code&gt; setting for dynamic membership is also something to look at. If you want to change the default naming schema for your dedicated Cloud Administrator accounts, you will need to adjust the rules accordingly. Please note that in that case you will also need to add additional Automation Variables for the &lt;code&gt;CloudAdmin_0100__New-CloudAdministrator-Account-V1.ps1&lt;/code&gt; runbook to know about your desired prefix and suffix preferences.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;Group&lt;/code&gt;&lt;/p&gt; &lt;p&gt;Review the &lt;code&gt;DisplayName&lt;/code&gt; for the cloud security groups to be created.&lt;/p&gt; &lt;p&gt;You should also look at the &lt;code&gt;InitialLicenseAssignment&lt;/code&gt; to validate the license assignment setup for the group, or remove that part if you prefer to handle this manually after the groups were created. Essentially, an Exchange Online mailbox is mandatory for each dedicated Cloud Administrator account that the &lt;code&gt;CloudAdmin_0100__New-CloudAdministrator-Account-V1.ps1&lt;/code&gt; runbook will create. The example provides details to assign Exchange Online Kiosk license and only enable Exchange Online service plan of it.&lt;/p&gt; &#xA;    &lt;blockquote&gt; &#xA;     &lt;p&gt;&lt;span&gt;ℹ&lt;/span&gt; You may need to add additional licensing for Microsoft Entra ID P2 to follow corporate compliance policies. If the referring primary user account is already licensed for it, and you can ensure that the dedicated Cloud Administrator account is used exclusively by the same natural person, you are generally entitled to use the features on both accounts, unless it is technically necessary to assign a license to both accounts. This assumption is based on the &lt;a href=&#34;https://www.microsoft.com/licensing/terms/product/ForOnlineServices/all&#34;&gt;Microsoft Universal License Terms for Online Services&lt;/a&gt; (search for &lt;em&gt;&#34;Customer must acquire and assign the appropriate subscription licenses ...&#34;&lt;/em&gt; in the &lt;em&gt;Licensing the Online Services&lt;/em&gt; section). &lt;strong&gt;We recommend to validate this with your Microsoft sales representative for your special situation.&lt;/strong&gt; We do not provide any legal advice at this point.&lt;/p&gt; &#xA;     &lt;p&gt;To add licenses to the configuration, you find the required &lt;code&gt;SkuPartNumber&lt;/code&gt; and &lt;code&gt;ServicePlanName&lt;/code&gt; details on the Microsoft Learn page about &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/users/licensing-service-plan-reference&#34;&gt;Product names and service plan identifiers for licensing&lt;/a&gt;. Some products may have multiple SKU Part Numbers (String IDs). To ensure you are using the correct &lt;code&gt;SkuPartNumber&lt;/code&gt;, you may use &lt;a href=&#34;https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.identity.directorymanagement/get-mgsubscribedsku&#34;&gt;&lt;code&gt;Get-MgSubscribedSku&lt;/code&gt;&lt;/a&gt; to validate this for your tenant:&lt;/p&gt; &#xA;     &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;Connect-MgGraph -ContextScope Process -Scopes Organization.Read.All&#xA;Get-MgSubscribedSku | Where-Object SkuPartNumber -like &#39;*M365_F1*&#39;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;    &lt;/blockquote&gt; &lt;p&gt;The &lt;code&gt;MembershipRule&lt;/code&gt; setting for dynamic membership is again something to look at here as well. If you want to change the default naming schema for your dedicated cloud-native Cloud Administrator accounts, you will need to adjust the rules accordingly. Please note that in that case you will also need to add additional Automation Variables for the &lt;code&gt;CloudAdmin_0100__New-CloudAdministrator-Account-V1.ps1&lt;/code&gt; to know about your desired prefix and suffix settings.&lt;/p&gt; &lt;/li&gt; &#xA;  &lt;/ol&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Start the initial setup.&lt;/p&gt; &lt;p&gt;The setup script will actively validate and confirm if the correct roles are active for the current admin user and will give explicit guidance about any missing permissions for the setup to be successful.&lt;/p&gt; &lt;p&gt;See &lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#minimum-permissions-for-the-administrator-account-during-the-initial-interactive-setup-session&#34;&gt;Minimum permissions for the administrator account during the initial interactive setup session&lt;/a&gt; if you want to prepare this upfront.&lt;/p&gt; &lt;p&gt;When you are ready, choose one of the setup options below:&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;em&gt;Option 1 (Preferred):&lt;/em&gt; Run the all-at-once script:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;./setup/AzAutoFWProject/Invoke-Setup.ps1&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Dont&#39;t worry, the setup script will ask for approval for each change it will perform with detailled information about what it will do afterwards. If you want, you may also use the &lt;code&gt;-WhatIf&lt;/code&gt; parameter for a dry-run.&lt;/p&gt; &lt;p&gt;It is also good to know that you may always start the setup script again, for example if there are still missing permissions for it to continue with the setup.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;em&gt;Option 2:&lt;/em&gt; Go through the setup step-by-step:&lt;/p&gt; &lt;p&gt;If you prefer to split the setup in parts, for example because you are working together with different teams, you may do so by only starting the part that you desire. However, it is best to keep the order right, which is shown below:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;# More general parts&#xA;./setup/AzAutoFWProject/Set-AzAutomationAccount.ps1            # Create the Automation Account&#xA;./setup/AzAutoFWProject/Set-AzAutomationRuntimeEnvironment.ps1 # Install PowerShell modules in the runtime environment of the Automation Account&#xA;./setup/AzAutoFWProject/Set-AzAutomationRunbook.ps1            # Upload all common runbooks to the Automation Account in the correct sorting order&#xA;&#xA;# Critical parts&#xA;./setup/AzAutoFWProject/Set-EntraAdministrativeUnit.ps1        # Create Restricted Administrative Units&#xA;./setup/AzAutoFWProject/Set-EntraGroup.ps1                     # Create groups inside the Restricted Administrative Units that were created before&#xA;./setup/AzAutoFWProject/Set-AzAutomationManagedIdentity.ps1    # Enable System-Assigned Managed Identity and assign desired permissions to it&#xA;&#xA;# Set configuration&#xA;./setup/AzAutoFWProject/Set-AzAutomationVariable.ps1           # Create Automation Variables in the Automation Account&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Update configuration in &lt;code&gt;./config/AzAutoFWProject/AzAutoFWProject.psd1&lt;/code&gt;:&lt;/p&gt; &lt;p&gt;Now that all parts are created, you need to update some of the configurations and add the unique object IDs. Essentially we need to update the Automation Variables that the CloudAdmin runbooks use for their configuration to know what Microsoft Entra Groups and Administrative Units we are using. There are two options to do so:&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;em&gt;Option 1 (Preferred):&lt;/em&gt; Add object IDs to the &lt;code&gt;AdministrativeUnit&lt;/code&gt; and &lt;code&gt;Group&lt;/code&gt; section:&lt;/p&gt; &lt;p&gt;The setup script output gave you information about the object ID&#39;s for the &lt;em&gt;Administrative Units&lt;/em&gt; and &lt;em&gt;Groups&lt;/em&gt;. Look for their section in the configuration file and add the object ID to the empty &lt;code&gt;Id&lt;/code&gt; property.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;em&gt;Option 2:&lt;/em&gt; Update &lt;code&gt;AutomationVariable&lt;/code&gt; configuration directly:&lt;/p&gt; &lt;p&gt;The defintion of the Automation Variables uses an internal reference to the definitions of Administrative Units and Group so that when you followed &lt;em&gt;Option 1&lt;/em&gt; from above, their IDs are automatically used. If for any reason you would like to set the object IDs in the Automation Variables directly, you may look to the &lt;code&gt;AutomationVariable&lt;/code&gt; section in the configuration file and change the &lt;code&gt;Value&lt;/code&gt; attribute accordingly. Note that in this case you must also remove the &lt;code&gt;ValueReferenceTo&lt;/code&gt; property.&lt;/p&gt; &lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;p&gt;Afterwards, re-run the &lt;code&gt;./setup/AzAutoFWProject/Set-AzAutomationVariable.ps1&lt;/code&gt; script to update the Automation Variables (use with parameter &lt;code&gt;-UpdateVariableValue&lt;/code&gt;). You may control if their values were updated successfully in the Azure Portal (find the Automation Account and navigate to &lt;em&gt;Variables&lt;/em&gt; under &lt;em&gt;Shared Resources&lt;/em&gt; in the left navigation).&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Check your initial configuration into the Git repository.&lt;/p&gt; &lt;p&gt;After successfully performing the initial setup, it is a good idea now to officially commit your initial setup details to the Git repository and upload them to the remote server:&lt;/p&gt; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;git commit --all --message &#34;Add configuration details after initial setup&#34;&#xA;git push&#xA;&lt;/code&gt;&lt;/pre&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Cleanup permissions that are no longer necessary for your own administrator account.&lt;/p&gt; &lt;p&gt;It is &lt;strong&gt;strongly recommended to review the permissions&lt;/strong&gt; you have assigned to your administrator account for the setup, as it may now be time to remove some of them. See &lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#minimum-permissions-after-the-setup-of-the-azure-automation-account&#34;&gt;Minimum permissions after the setup of the Azure Automation Account&lt;/a&gt; to give you some guidance.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;p align=&#34;right&#34;&gt;(&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#readme-top&#34;&gt;back to top&lt;/a&gt;)&lt;/p&gt; &#xA;&lt;h3&gt;Minimum permissions for the administrator account &lt;u&gt;during&lt;/u&gt; the initial interactive setup session&lt;/h3&gt; &#xA;&lt;p&gt;The setup script &lt;code&gt;./setup/AzAutoFWProject/Invoke-Setup.ps1&lt;/code&gt; and its sub-scripts require a couple of different roles to perform the setup steps. The setup script will actively validate and confirm if the correct roles are active for the current admin user and will give explicit guidance about any missing permissions for the setup to be successful.&lt;/p&gt; &#xA;&lt;p&gt;For the setup procedure to be as simple as possible, you might want to prepare for the following permissions to be available for your admin user:&lt;/p&gt; &#xA;&lt;p&gt;&lt;a id=&#34;1-setup-azure-roles&#34;&gt;&lt;/a&gt;&lt;strong&gt;1. Azure roles&lt;/strong&gt; (see &lt;a href=&#34;https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles&#34;&gt;Azure built-in roles&lt;/a&gt;):&lt;/p&gt; &#xA;&lt;p&gt;While you could run the setup script with Azure &lt;em&gt;Owner&lt;/em&gt; permissions to fulfill all needs, we recommend following the &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity-platform/secure-least-privileged-access&#34;&gt;principle of least privilege&lt;/a&gt; and only have the following Azure roles active for your administrator account:&lt;/p&gt; &#xA;&lt;p&gt;Either at &lt;em&gt;Subscription&lt;/em&gt; &lt;u&gt;or&lt;/u&gt; &lt;em&gt;Resource Group&lt;/em&gt; level:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Contributor&lt;/code&gt;&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Create new resource group (if required), new Azure Automation Account and upload new Automation Runbooks.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;User Access Administrator&lt;/code&gt; &lt;em&gt;(&lt;u&gt;optional&lt;/u&gt; condition: Constrain to Azure &lt;code&gt;Reader&lt;/code&gt; role)&lt;/em&gt;&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Delegate Azure &lt;code&gt;Reader&lt;/code&gt; role to System-Assigned Managed Identity of the Automation Account.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;To learn more about Azure role assignments with conditions, visit &lt;a href=&#34;https://learn.microsoft.com/en-us/azure/role-based-access-control/delegate-role-assignments-portal&#34;&gt;Delegate Azure role assignment management to others with conditions&lt;/a&gt; on Microsoft Learn.&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;Important:&lt;/strong&gt; Make sure your Azure roles are activated before starting the setup. See &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-resource-roles-activate-your-roles&#34;&gt;Activate my Azure resource roles in Privileged Identity Management&lt;/a&gt; if you need help.&lt;/p&gt; &#xA;&lt;p&gt;&lt;a id=&#34;2-setup-entra-roles&#34;&gt;&lt;/a&gt;&lt;strong&gt;2. Microsoft Entra directory roles&lt;/strong&gt; (see &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference&#34;&gt;Microsoft Entra built-in roles&lt;/a&gt;):&lt;/p&gt; &#xA;&lt;p&gt;While you could run the setup script with &lt;em&gt;Global Administrator&lt;/em&gt; permissions to fulfill all needs, we recommend following the &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity-platform/secure-least-privileged-access&#34;&gt;principle of least privilege&lt;/a&gt; and only have the following Entra directory roles active for your administrator account:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Cloud Application Administrator&lt;/code&gt;&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Assign app permissions to the System-Assigned Managed Identity of the Automation Account. Also, allow to perform one-time admin consent for scopes (application roles) of the &lt;em&gt;Microsoft Graph Command Line Tools&lt;/em&gt; application (see &lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#3-setup-microsoft-graph-scopes&#34;&gt;3. Microsoft Graph Command Line Tools&lt;/a&gt;).&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Privileged Role Administrator&lt;/code&gt;&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Assign Entra directory roles to System-Assigned Managed Identity of the Azure Automation Account. Also, create required Administrative Units in Microsoft Entra. This role is also required to supplement the &lt;code&gt;Cloud Application Administrator&lt;/code&gt; when assigning app permissions to highly-privileged applications like Microsoft Graph.&lt;/p&gt; &lt;p&gt;For Management Restricted Administrative Units, the setup script will automatically assign &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/custom-overview#scope&#34;&gt;scoped roles&lt;/a&gt; as &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-configure#terminology&#34;&gt;eligible&lt;/a&gt; and also activated for 2 hours for the admin running the setup script:&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;User Administrator&lt;/code&gt; (scoped to the respective Administrative Unit)&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Allow to manage the dedicated cloud-native Cloud Administrator accounts in the Administrative Unit.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;Groups Administrator&lt;/code&gt; (scoped to the respective Administrative Unit)&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Allow to create and manage the groups belonging to the Cloud Administration Tiering Model.&lt;/p&gt; &lt;/li&gt; &#xA;   &lt;li&gt; &lt;p&gt;&lt;code&gt;License Administrator&lt;/code&gt; (scoped to the respective Administrative Unit)&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Allow to manage group-based licensing for the groups belonging to the Cloud Administration Tiering Model.&lt;/p&gt; &lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;p&gt;After 2 hours, the activation will automatically expire. The admin user is eligible for the next 3 months to activate the roles again if needed. You may also manually re-configure role assignments for the Restricted Management Administrative Units as you desire. It is &lt;strong&gt;strongly recommended to limit access to Tier 0 Cloud Administrator accounts&lt;/strong&gt; only after you completed your migration to the new security model.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;&lt;strong&gt;Important:&lt;/strong&gt; Make sure your Azure roles are activated before starting the setup. See &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-how-to-activate-role&#34;&gt;Activate a Microsoft Entra role in Privileged Identity Management&lt;/a&gt; if you need help.&lt;/p&gt; &#xA;&lt;p&gt;&lt;a id=&#34;3-setup-microsoft-graph-scopes&#34;&gt;&lt;/a&gt;&lt;strong&gt;3. Microsoft Graph Command Line Tools&lt;/strong&gt; (see &lt;a href=&#34;https://learn.microsoft.com/en-us/powershell/microsoftgraph/&#34;&gt;Microsoft Graph PowerShell&lt;/a&gt; and &lt;a href=&#34;https://learn.microsoft.com/en-us/graph/permissions-reference&#34;&gt;Microsoft Graph permissions reference&lt;/a&gt;):&lt;/p&gt; &#xA;&lt;p&gt;&lt;em&gt;User consent&lt;/em&gt;:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AdministrativeUnit.Read.All&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AdministrativeUnit.ReadWrite.All&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Application.Read.All&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AppRoleAssignment.ReadWrite.All&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Directory.Read.All&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Directory.Write.Restricted&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Group.Read.All&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Group.ReadWrite.All&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Organization.Read.All&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;RoleManagement.Read.Directory&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;RoleManagement.ReadWrite.Directory&lt;/code&gt;&lt;/p&gt; &lt;p&gt;Due to the &lt;code&gt;Cloud Application Administrator&lt;/code&gt; directory role mentioned in &lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#2-setup-entra-roles&#34;&gt;2. Microsoft Entra directory roles&lt;/a&gt;, the admin user will be able to perform required admin consents right away.&lt;/p&gt; &lt;p&gt;If you would like to learn more about user and admin consent in Microsoft Entra ID, visit &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/user-admin-consent-overview&#34;&gt;this page on Microsoft Learn&lt;/a&gt;.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;blockquote&gt; &#xA; &lt;p&gt;&lt;span&gt;ℹ&lt;/span&gt; To pre-approve all required scopes at once, you may run the following command:&lt;/p&gt; &#xA; &lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;Connect-MgGraph -ContextScope Process -Scopes &#34;AdministrativeUnit.Read.All AdministrativeUnit.ReadWrite.All Application.Read.All AppRoleAssignment.ReadWrite.All Directory.Read.All Directory.Write.Restricted Group.Read.All Group.ReadWrite.All Organization.Read.All RoleManagement.Read.Directory RoleManagement.ReadWrite.Directory&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA; &lt;p&gt;Please note that it is highly recommended to refrain from selecting &lt;em&gt;&#34;Consent on behalf of your organization&#34;&lt;/em&gt;, also known as &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/user-admin-consent-overview#admin-consent&#34;&gt;admin consent&lt;/a&gt;. Instead, you should work with user consent for each individual user to contribute to the &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity-platform/secure-least-privileged-access&#34;&gt;principle of least privilege&lt;/a&gt;.&lt;/p&gt; &#xA; &lt;p&gt;Note that the appearance of this option depends on your current directory role, for example &lt;em&gt;Cloud Application Administrator&lt;/em&gt;. If you are presented with an error message, you might need to activate that role first, or &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/configure-admin-consent-workflow&#34;&gt;configure the admin consent workflow&lt;/a&gt; so that the consent request can be send to the admin team for approval.&lt;/p&gt; &#xA; &lt;p&gt;&lt;strong&gt;If you receive an error message or warning in your terminal after you have successfully consented in the browser, it is best to &lt;u&gt;execute the command again&lt;/u&gt; to check whether consent has been successfully granted. This is usually successful on the second or third attempt.&lt;/strong&gt;&lt;/p&gt; &#xA;&lt;/blockquote&gt; &#xA;&lt;p align=&#34;right&#34;&gt;(&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#readme-top&#34;&gt;back to top&lt;/a&gt;)&lt;/p&gt; &#xA;&lt;h3&gt;Minimum permissions &lt;u&gt;after&lt;/u&gt; the setup of the Azure Automation Account&lt;/h3&gt; &#xA;&lt;p&gt;After the setup was completed, it is &lt;strong&gt;strongly recommended to reduce the permissions&lt;/strong&gt; of the admin user to a minimum. Also note that this level of access shall be exclusive to Tier 0 Cloud Administrators only as soon as you have finished your migration to the new security model. This is to protect the Automation Account and the System-Assigned Managed Identity as good as possible, due to its high privileges to manage the Cloud Administrator accounts for you.&lt;/p&gt; &#xA;&lt;p&gt;&lt;a id=&#34;1-azure-roles&#34;&gt;&lt;/a&gt;&lt;strong&gt;1. Azure roles&lt;/strong&gt; (see &lt;a href=&#34;https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles&#34;&gt;Azure built-in roles&lt;/a&gt;):&lt;/p&gt; &#xA;&lt;p&gt;Either at &lt;em&gt;Resource Group&lt;/em&gt; &lt;u&gt;or&lt;/u&gt; &lt;em&gt;Automation Account&lt;/em&gt; level:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Contributor&lt;/code&gt;&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Maintenance of Azure Automation Account and Automation Runbooks.&lt;/p&gt; &lt;p&gt;Note that for the &lt;em&gt;Automation Account&lt;/em&gt; level, you may also use the &lt;code&gt;Automation Contributor&lt;/code&gt; role instead.&lt;/p&gt; &lt;p&gt;&lt;u&gt;&lt;strong&gt;Important:&lt;/strong&gt;&lt;/u&gt; It is considered a high risk to grant privileges at the subscription or even management group level to a wider public. If you decide to grant privileges at these levels, we strongly recommend limiting this access to very few people.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;&lt;a id=&#34;2-entra-roles&#34;&gt;&lt;/a&gt;&lt;strong&gt;2. Microsoft Entra directory roles&lt;/strong&gt; (see &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference&#34;&gt;Microsoft Entra built-in roles&lt;/a&gt;):&lt;/p&gt; &#xA;&lt;p&gt;For the Management Restricted Administrative Units used for Cloud Administration, &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/custom-overview#scope&#34;&gt;scoped roles&lt;/a&gt; can be assigned as &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-configure#terminology&#34;&gt;eligible&lt;/a&gt; for selected Tier 0 administrators that will provide support to other Cloud Administrators:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;User Administrator&lt;/code&gt; (scoped to the respective Administrative Unit for Tier 0, 1, or 2)&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Allow to manage the dedicated cloud-native Cloud Administrator accounts of the respective Tier.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;Groups Administrator&lt;/code&gt; (scoped to the respective Administrative Unit)&lt;/p&gt; &lt;p&gt;&lt;em&gt;Justification:&lt;/em&gt; Allow to manage the groups belonging to the Cloud Administration Tiering Model.&lt;/p&gt; &lt;p&gt;&lt;u&gt;&lt;strong&gt;Important:&lt;/strong&gt;&lt;/u&gt; It is considered a high risk to grant access to these groups. Getting access to these groups will allow to manage Cloud Administrator access outside of the Automation Account and without the restrictions and checks the &lt;code&gt;CloudAdmin_0100__New-CloudAdministrator-Account-V1.ps1&lt;/code&gt; runbook enforces for you. Be aware that this might lead to a security breach if handled in the wrong way!&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;&lt;a id=&#34;3-setup-microsoft-graph-scopes&#34;&gt;&lt;/a&gt;&lt;strong&gt;3. Microsoft Graph Command Line Tools&lt;/strong&gt;:&lt;/p&gt; &#xA;&lt;p&gt;The &lt;em&gt;delegated&lt;/em&gt; permissions you might have added for the &lt;em&gt;Microsoft Graph Command Line Tools&lt;/em&gt; during the setup session may be kept.&lt;/p&gt; &#xA;&lt;p&gt;The nature of delegated permissions is that they also require the respective privileges in Microsoft Entra to be effective. Visit &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity-platform/delegated-access-primer&#34;&gt;Understanding delegated access&lt;/a&gt; on Microsoft Learn for further details.&lt;/p&gt; &#xA;&lt;p&gt;Note that revoking &lt;em&gt;user consent&lt;/em&gt; permissions currently is only possible using Microsoft Graph, which we don&#39;t explicitly describe here.&lt;/p&gt; &#xA;&lt;p&gt;A good alternative is to restrict access to the &lt;em&gt;Microsoft Graph Command Line Tools&lt;/em&gt; enterprise application to selected accounts only. These can even be just your managed cloud administrator accounts if you wish. See &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/what-is-access-management#requiring-user-assignment-for-an-app&#34;&gt;Requiring user assignment for an app&lt;/a&gt; and &lt;a href=&#34;https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/assign-user-or-group-access-portal&#34;&gt;Manage users and groups assignment to an application&lt;/a&gt; to learn more.&lt;/p&gt; &#xA;&lt;!-- USAGE EXAMPLES --&gt; &#xA;&lt;h2&gt;Usage&lt;/h2&gt; &#xA;&lt;p&gt;This section requires further attention. :-)&lt;/p&gt; &#xA;&lt;p&gt;In general, you may have a look to the inline documentation of the runbooks if you would like to start with an idea.&lt;/p&gt; &#xA;&lt;p align=&#34;right&#34;&gt;(&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#readme-top&#34;&gt;back to top&lt;/a&gt;)&lt;/p&gt; &#xA;&lt;!-- CONTRIBUTING --&gt; &#xA;&lt;h2&gt;Contributing&lt;/h2&gt; &#xA;&lt;p&gt;Contributions are what make the open source community such an amazing place to learn, inspire, and create. Any contributions you make are &lt;strong&gt;greatly appreciated&lt;/strong&gt;.&lt;/p&gt; &#xA;&lt;p&gt;If you have a suggestion that would make this better, please fork the repo and create a pull request. You can also simply open an issue with the tag &#34;enhancement&#34;. Don&#39;t forget to give the project a star! Thanks again!&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt;Fork the Project&lt;/li&gt; &#xA; &lt;li&gt;Create your Feature Branch (&lt;code&gt;git checkout -b feature/AmazingFeature&lt;/code&gt;)&lt;/li&gt; &#xA; &lt;li&gt;Commit your Changes (&lt;code&gt;git commit -m &#39;Add some AmazingFeature&#39;&lt;/code&gt;)&lt;/li&gt; &#xA; &lt;li&gt;Push to the Branch (&lt;code&gt;git push origin feature/AmazingFeature&lt;/code&gt;)&lt;/li&gt; &#xA; &lt;li&gt;Open a Pull Request&lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;p align=&#34;right&#34;&gt;(&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#readme-top&#34;&gt;back to top&lt;/a&gt;)&lt;/p&gt; &#xA;&lt;!-- LICENSE --&gt; &#xA;&lt;h2&gt;License&lt;/h2&gt; &#xA;&lt;p&gt;Distributed under the MIT License. See &lt;code&gt;LICENSE.txt&lt;/code&gt; for more information.&lt;/p&gt; &#xA;&lt;p align=&#34;right&#34;&gt;(&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#readme-top&#34;&gt;back to top&lt;/a&gt;)&lt;/p&gt; &#xA;&lt;!-- MAINTAINERS --&gt; &#xA;&lt;h2&gt;Maintainers&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Julian Pawlowski - &lt;a href=&#34;https://github.com/jpawlowski&#34;&gt;@jpawlowski&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;Project Link: &lt;a href=&#34;https://github.com/workoho/Entra-Tiering-Security-Model&#34;&gt;https://github.com/workoho/Entra-Tiering-Security-Model&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p align=&#34;right&#34;&gt;(&lt;a href=&#34;https://raw.githubusercontent.com/workoho/Entra-Tiering-Security-Model/main/#readme-top&#34;&gt;back to top&lt;/a&gt;)&lt;/p&gt; &#xA;&lt;!-- MARKDOWN LINKS &amp; IMAGES --&gt; &#xA;&lt;!-- https://www.markdownguide.org/basic-syntax/#reference-style-links --&gt;</summary>
  </entry>
  <entry>
    <title>synacktiv/Invoke-RunAsWithCert</title>
    <updated>2024-05-21T01:31:37Z</updated>
    <id>tag:github.com,2024-05-21:/synacktiv/Invoke-RunAsWithCert</id>
    <link href="https://github.com/synacktiv/Invoke-RunAsWithCert" rel="alternate"></link>
    <summary type="html">&lt;p&gt;A PowerShell script to perform PKINIT authentication with the Windows API from a non domain-joined machine.&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;Invoke-RunAsWithCert&lt;/h1&gt; &#xA;&lt;p&gt;A PowerShell script to perform PKINIT authentication with the Windows API from a non domain-joined machine.&lt;/p&gt; &#xA;&lt;h2&gt;Description&lt;/h2&gt; &#xA;&lt;p&gt;This cmdlet creates a new logon session with the specified certificate via PKINIT.&lt;/p&gt; &#xA;&lt;p&gt;It is meant to be run on a non domain-joined VM. The cmdlet has two modes: one that sets registry keys and one that patches LSASS memory to bypass client-side checks related to the domain controller&#39;s certificate. These checks fail when running on a machine that is not joined to the domain.&lt;/p&gt; &#xA;&lt;p&gt;In registry mode (the default), administrator privileges are needed to set the relevant registry keys (and restore them at the end). If the keys are already set, administrator privileges are not required. Moreover, the CA certificate must be added to the list of trusted certification authorities. If this method fails (e.g. because of a check that is not bypassed with the registry keys), the patch method can be tried instead. It is less elegant but will bypass any client-side check related to the KDC certificate.&lt;/p&gt; &#xA;&lt;p&gt;In patch mode (&lt;code&gt;-PatchLsass&lt;/code&gt;), the &lt;code&gt;KerbCheckKdcCertificate&lt;/code&gt; function in LSASS will be patched. As &lt;code&gt;KerbCheckKdcCertificate&lt;/code&gt; is not exported by &lt;code&gt;kerberos.dll&lt;/code&gt;, symbols need to be retrieved. For the symbols to be automatically retrieved by this cmdlet, the environment variable &lt;code&gt;_NT_SYMBOL_PATH&lt;/code&gt; needs to be defined (e.g. &lt;code&gt;SRV*c:\symbols*https://msdl.microsoft.com/download/symbols&lt;/code&gt;). If the symbols are not already on disk, an Internet connection is needed to download them. The Windows SDK is also needed to download the symbols. By default, the script will look in &lt;code&gt;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64&lt;/code&gt; to find the DLLs it needs (&lt;code&gt;dbghelp.dll&lt;/code&gt; and &lt;code&gt;symsrv.dll&lt;/code&gt;).&lt;/p&gt; &#xA;&lt;p&gt;For a more detailed explanation, see the associated &lt;a href=&#34;https://www.synacktiv.com/publications/understanding-and-evading-microsoft-defender-for-identity-pkinit-detection&#34;&gt;blogpost&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;Usage&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code&gt;PS &amp;gt; Invoke-RunAsWithCert user.pfx -Domain CORP.LOCAL&#xA;&lt;/code&gt;&lt;/pre&gt;</summary>
  </entry>
</feed>