<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub PowerShell Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2023-07-15T01:42:14Z</updated>
  <subtitle>Daily Trending of PowerShell in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>mvelazc0/BadZure</title>
    <updated>2023-07-15T01:42:14Z</updated>
    <id>tag:github.com,2023-07-15:/mvelazc0/BadZure</id>
    <link href="https://github.com/mvelazc0/BadZure" rel="alternate"></link>
    <summary type="html">&lt;p&gt;BadZure orchestrates the setup of Azure Active Directory tenants, populating them with diverse entities while also introducing common security misconfigurations to create vulnerable tenants with multiple attack paths.&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;BadZure&lt;/h1&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://twitter.com/OTR_Community&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/Open_Threat_Research-Community-brightgreen.svg?sanitize=true&#34; alt=&#34;Open_Threat_Research Community&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p&gt;BadZure is a PowerShell script that leverages the Microsoft Graph SDK to orchestrate the setup of Azure Active Directory tenants, populating them with diverse entities while also introducing common security misconfigurations to create vulnerable tenants with multiple attack paths.&lt;/p&gt; &#xA;&lt;p&gt;Specifically, BadZure automates the process of creating multiple entities such as: users, groups, application registrations, service principals and administrative units. To simulate common security misconfigurations in real environments, it randomly assigns Azure AD roles, Graph permissions and application ownership privileges to randomly picked security principals enabling the creation of unique attack paths. In line with the &#39;Assume Breach&#39; principle, BadZure provides users with two methods of initial access to the vulnerable tenants it creates thereby simulating account takeover scenarios.&lt;/p&gt; &#xA;&lt;p&gt;The key advantage of BadZure lies in its ability to rapidly populate and purge existing Azure AD tenants with randomly generated vulnerable configurations and pre-configured initial access facilitating continous and iterative attack simulation (red team) and detection development (blue team) experimentation. It is designed for security practitioners with an interest in exploring and understanding Azure AD security.&lt;/p&gt; &#xA;&lt;h2&gt;Goals / Use Cases&lt;/h2&gt; &#xA;&lt;p&gt;BadZure was written to enable the author to quickly stand up vulnerable environments, simulate attacks and collect attack telemetry to develop and test detection analytics for Azure AD attacks.&lt;/p&gt; &#xA;&lt;p&gt;An Azure AD tenant populated with BadZure also enables red and blue teams to:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Experiment with common Azure AD attack vectors and tools (for ideas =&amp;gt; &lt;a href=&#34;https://github.com/Cloud-Architekt/AzureAD-Attack-Defense&#34;&gt;AzureAD Attack and Defense Playbook&lt;/a&gt;)&lt;/li&gt; &#xA; &lt;li&gt;Obtain attack telemetry to build, test and enhance detection controls&lt;/li&gt; &#xA; &lt;li&gt;Execute purple team exercises in a safe setting&lt;/li&gt; &#xA; &lt;li&gt;Faciliate hands-on Azure AD security training&lt;/li&gt; &#xA; &lt;li&gt;Host dynamic Azure AD Capture the Flag (CTF) events&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Attack Paths&lt;/h2&gt; &#xA;&lt;h3&gt;Initial Access&lt;/h3&gt; &#xA;&lt;p&gt;BadZure facilitates initial access by simulating account takover vectors such as password attacks and token theft. It achieves this through the assignment of a password (randomly generated or user-defined) or by supplying principal JWT access tokens. To support testing strategies such as password spraying, BadZure also automatically generates a &#39;users.txt&#39; file containing the usernames of the created accounts. The credentials or tokens, made available in the output, enable users to step into the shoes of an attacker who is targeting an Azure AD tenant.&lt;/p&gt; &#xA;&lt;h3&gt;Privilege Escalation&lt;/h3&gt; &#xA;&lt;p&gt;BadZure crafts three privilege escalation attack vectors by simulating service principal abuse scenarios. It achieves this by intentionally introducing misconfigurations caused by Azure AD roles, Graph permissions and application ownerships. A BloodHound-generated graph, showcasing the attack paths BadZure creates, is shown below.&lt;/p&gt; &#xA;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/mvelazc0/BadZure/main/img/attack_paths.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Demo&lt;/h2&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=7IdyU7tQgww&#34;&gt;&lt;img src=&#34;https://img.youtube.com/vi/7IdyU7tQgww/0.jpg&#34; alt=&#34;BadZure&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Quick Start Guide&lt;/h2&gt; &#xA;&lt;h3&gt;Create an Azure AD Tenant&lt;/h3&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/training/modules/create-an-azure-account/1-introduction&#34;&gt;Creating an Azure subscription&lt;/a&gt; will also provide you an Azure AD tenant.&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Utilizing BadZure within your Azure subscription won&#39;t lead to any additional costs as it only requires an &lt;a href=&#34;https://azure.microsoft.com/en-us/free/&#34;&gt;Azure AD Free license&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;h3&gt;Create a Global Administrator&lt;/h3&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/azure/active-directory/roles/manage-roles-portal&#34;&gt;Assign Azure AD roles to users&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h3&gt;Install Dependencies&lt;/h3&gt; &#xA;&lt;pre&gt;&lt;code&gt;Install-Module Microsoft.Graph -Scope CurrentUser&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Clone Repository and Import Script&lt;/h3&gt; &#xA;&lt;pre&gt;&lt;code&gt;git clone https://github.com/mvelazc0/BadZure&#xA;cd BadZure&#xA;. ./Invoke-BadZure.ps1&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Set up AzureAD with BadZure&lt;/h3&gt; &#xA;&lt;pre&gt;&lt;code&gt;# Get Help Menu&#xA;Get-Help Invoke-BadZure -Detailed&#xA;&#xA;# Populate a tenant and configure all attack paths with verbose logging&#xA;Invoke-BadZure -Build -Verbose&#xA;&#xA;# Populate a tenant and configure a random attack path&#xA;Invoke-BadZure -Build $RandomAttackPath&#xA;&#xA;# Populate a tenant, configure all attack pahts and use a custom password for initial access&#xA;Invoke-BadZure -Build -Password Summer2023!&#xA;&#xA;# Populate a tenant, configure a random attack path and provide JWT access tokens for initial access&#xA;Invoke-BadZure -Build -RandomAttackPath -Token&#xA;&#xA;# Populate a tenant without attack paths&#xA;Invoke-BadZure -Build -NoAttackPaths&#xA;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Experiment&lt;/h3&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Simulate attacks&lt;/li&gt; &#xA; &lt;li&gt;Review resulting telemetry&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Purge AzureAD with BadZure&lt;/h3&gt; &#xA;&lt;pre&gt;&lt;code&gt;# Destroy all created identities&#xA;Invoke-BadZure -Destroy -Verbose&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Author&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;strong&gt;Mauricio Velazco&lt;/strong&gt; - &lt;a href=&#34;https://twitter.com/mvelazco&#34;&gt;@mvelazco&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;References&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://github.com/Azure/Cloud-Katana&#34;&gt;Cloud Katana&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/Cyb3rWard0g&#34;&gt;Roberto Rodriguez&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://github.com/Gerenios/AADInternals&#34;&gt;AADInternals&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/DrAzureAD&#34;&gt;Nestori Syynimaa&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://cloudbrothers.info/en/azure-attack-paths/&#34;&gt;Azure Attack Paths&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/fabian_bader&#34;&gt;Fabian Bader&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://github.com/dirkjanm/ROADtools&#34;&gt;ROADtools&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/_dirkjan&#34;&gt;Dirkjan Mollema&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://github.com/iknowjason/PurpleCloud&#34;&gt;PurpleCloud&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/securitypuck&#34;&gt;Jason Ostrom&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://github.com/Cloud-Architekt/AzureAD-Attack-Defense&#34;&gt;Azure AD - Attack and Defense Playbook&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/samilamppu&#34;&gt;Sami Lamppu&lt;/a&gt; and &lt;a href=&#34;https://twitter.com/Thomas_Live&#34;&gt;Thomas Naunheim&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://github.com/BloodHoundAD/AzureHound&#34;&gt;BloodHound/AzureHound&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/_wald0&#34;&gt;Andy Robbins&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;Blog posts, talks and tools by &lt;a href=&#34;https://twitter.com/Haus3c&#34;&gt;@Haus3c&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/kfosaaen&#34;&gt;@kfosaaen&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/inversecos&#34;&gt;@inversecos&lt;/a&gt; and others.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;License&lt;/h2&gt; &#xA;&lt;p&gt;This project is licensed under the Apache 2.0 License - see the &lt;a href=&#34;https://raw.githubusercontent.com/mvelazc0/BadZure/main/LICENSE&#34;&gt;LICENSE&lt;/a&gt; file for details&lt;/p&gt;</summary>
  </entry>
</feed>