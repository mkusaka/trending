<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub Ruby Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2024-11-04T01:36:56Z</updated>
  <subtitle>Daily Trending of Ruby in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>voxpupuli/puppet-consul</title>
    <updated>2024-11-04T01:36:56Z</updated>
    <id>tag:github.com,2024-11-04:/voxpupuli/puppet-consul</id>
    <link href="https://github.com/voxpupuli/puppet-consul" rel="alternate"></link>
    <summary type="html">&lt;p&gt;A Puppet Module to Manage Consul&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;puppet-consul&lt;/h1&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/voxpupuli/puppet-consul/actions?query=workflow%3ACI&#34;&gt;&lt;img src=&#34;https://github.com/voxpupuli/puppet-consul/workflows/CI/badge.svg?sanitize=true&#34; alt=&#34;Build Status&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://github.com/voxpupuli/puppet-consul/actions/workflows/release.yml&#34;&gt;&lt;img src=&#34;https://github.com/voxpupuli/puppet-consul/actions/workflows/release.yml/badge.svg?sanitize=true&#34; alt=&#34;Release&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://forge.puppetlabs.com/puppet/consul&#34;&gt;&lt;img src=&#34;https://img.shields.io/puppetforge/v/puppet/consul.svg?sanitize=true&#34; alt=&#34;Puppet Forge&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://forge.puppetlabs.com/puppet/consul&#34;&gt;&lt;img src=&#34;https://img.shields.io/puppetforge/dt/puppet/consul.svg?sanitize=true&#34; alt=&#34;Puppet Forge - downloads&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://forge.puppetlabs.com/puppet/consul&#34;&gt;&lt;img src=&#34;https://img.shields.io/puppetforge/e/puppet/consul.svg?sanitize=true&#34; alt=&#34;Puppet Forge - endorsement&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://forge.puppetlabs.com/puppet/consul&#34;&gt;&lt;img src=&#34;https://img.shields.io/puppetforge/f/puppet/consul.svg?sanitize=true&#34; alt=&#34;Puppet Forge - scores&#34;&gt;&lt;/a&gt; &lt;a href=&#34;http://www.puppetmodule.info/m/puppet-consul&#34;&gt;&lt;img src=&#34;http://www.puppetmodule.info/images/badge.png&#34; alt=&#34;puppetmodule.info docs&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/LICENSE&#34;&gt;&lt;img src=&#34;https://img.shields.io/github/license/voxpupuli/puppet-consul.svg?sanitize=true&#34; alt=&#34;Apache-2 License&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#transfer-notice&#34;&gt;&lt;img src=&#34;https://img.shields.io/badge/donated%20by-KyleAnderson-fb7047.svg?sanitize=true&#34; alt=&#34;Donated by KyleAnderson&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p&gt;This module manages Consul servers and agents.&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#compatibility&#34;&gt;Compatibility&lt;/a&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#what-this-module-affects&#34;&gt;What This Module Affects&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#usage&#34;&gt;Usage&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#web-ui&#34;&gt;Web UI&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#service-definition&#34;&gt;Service Definition&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#watch-definitions&#34;&gt;Watch Definitions&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#check-definitions&#34;&gt;Check Definitions&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#removing-service-check-and-watch-definitions&#34;&gt;Removing Service, Check and Watch definitions&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#acl-definitions&#34;&gt;ACL Definitions&lt;/a&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#policytoken-system&#34;&gt;Policy/Token system&lt;/a&gt;&lt;/li&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#legacy-system&#34;&gt;Legacy system&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#prepared-queries-and-prepared-query-templates&#34;&gt;Prepared Queries and Prepared Query Templates&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#keyvalue-objects&#34;&gt;Key/Value Objects&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#limitations&#34;&gt;Limitations&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#windows-experimental-support&#34;&gt;Windows Experimental Support&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#telemetry&#34;&gt;Telemetry&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#consul-template&#34;&gt;Consul Template&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/voxpupuli/puppet-consul/master/#development&#34;&gt;Development&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Compatibility&lt;/h2&gt; &#xA;&lt;p&gt;&lt;strong&gt;WARNING&lt;/strong&gt;: Backwards incompatible changes happen in order to more easily support new versions of consul. Pin to the version that works for your setup!&lt;/p&gt; &#xA;&lt;table&gt; &#xA; &lt;thead&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;th&gt;Consul Version&lt;/th&gt; &#xA;   &lt;th&gt;Recommended Puppet Module Version&lt;/th&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/thead&gt; &#xA; &lt;tbody&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td&gt;&amp;gt;= 1.11.x&lt;/td&gt; &#xA;   &lt;td&gt;&amp;gt;= 6.0.0&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td&gt;1.1.0-1.10.x&lt;/td&gt; &#xA;   &lt;td&gt;4.0.0-7.0.x&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td&gt;0.9-1.1.0&lt;/td&gt; &#xA;   &lt;td&gt;&amp;lt;= 3.4.2&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td&gt;0.8.x&lt;/td&gt; &#xA;   &lt;td&gt;&amp;lt;= 3.2.4&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td&gt;0.7.0&lt;/td&gt; &#xA;   &lt;td&gt;&amp;lt;= 2.1.1&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td&gt;0.6.0&lt;/td&gt; &#xA;   &lt;td&gt;&amp;lt;= 2.1.1&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td&gt;0.5.x&lt;/td&gt; &#xA;   &lt;td&gt;1.0.3&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA;  &lt;tr&gt; &#xA;   &lt;td&gt;0.4.x&lt;/td&gt; &#xA;   &lt;td&gt;0.4.6&lt;/td&gt; &#xA;  &lt;/tr&gt; &#xA; &lt;/tbody&gt; &#xA;&lt;/table&gt; &#xA;&lt;h3&gt;What This Module Affects&lt;/h3&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Installs the consul daemon (via url or package) &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;If installing from zip, you &lt;em&gt;must&lt;/em&gt; ensure the unzip utility is available.&lt;/li&gt; &#xA;   &lt;li&gt;If installing from docker, you &lt;em&gt;must&lt;/em&gt; ensure puppetlabs-docker_platform module is available.&lt;/li&gt; &#xA;   &lt;li&gt;If installing on windows, you &lt;em&gt;must&lt;/em&gt; install the &lt;code&gt;puppetlabs/powershell&lt;/code&gt; module.&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt;Optionally installs a user to run it under &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;&lt;em&gt;NOTE:&lt;/em&gt; users enabling this and just starting with Consul should consider setting &lt;code&gt;manage_user_home_location&lt;/code&gt; to &lt;code&gt;true&lt;/code&gt;. It defaults to false for backwards compatibility.&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt;Installs a configuration file (/etc/consul/config.json)&lt;/li&gt; &#xA; &lt;li&gt;Manages the consul service via upstart, sysv, systemd, or nssm.&lt;/li&gt; &#xA; &lt;li&gt;Optionally installs the Web UI&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Usage&lt;/h2&gt; &#xA;&lt;p&gt;To set up a single consul server, with several agents attached: On the server:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;class { &#39;consul&#39;:&#xA;  config_hash =&amp;gt; {&#xA;    &#39;bootstrap_expect&#39; =&amp;gt; 1,&#xA;    &#39;data_dir&#39;         =&amp;gt; &#39;/opt/consul&#39;,&#xA;    &#39;datacenter&#39;       =&amp;gt; &#39;east-aws&#39;,&#xA;    &#39;log_level&#39;        =&amp;gt; &#39;INFO&#39;,&#xA;    &#39;node_name&#39;        =&amp;gt; &#39;server&#39;,&#xA;    &#39;server&#39;           =&amp;gt; true,&#xA;  },&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;On the agent(s):&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;class { &#39;consul&#39;:&#xA;  config_hash =&amp;gt; {&#xA;    &#39;data_dir&#39;   =&amp;gt; &#39;/opt/consul&#39;,&#xA;    &#39;datacenter&#39; =&amp;gt; &#39;east-aws&#39;,&#xA;    &#39;log_level&#39;  =&amp;gt; &#39;INFO&#39;,&#xA;    &#39;node_name&#39;  =&amp;gt; &#39;agent&#39;,&#xA;    &#39;retry_join&#39; =&amp;gt; [&#39;172.16.0.1&#39;],&#xA;  },&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Disable install and service components:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;class { &#39;consul&#39;:&#xA;  install_method =&amp;gt; &#39;none&#39;,&#xA;  init_style     =&amp;gt; false,&#xA;  manage_service =&amp;gt; false,&#xA;  config_hash =&amp;gt; {&#xA;    &#39;data_dir&#39;   =&amp;gt; &#39;/opt/consul&#39;,&#xA;    &#39;datacenter&#39; =&amp;gt; &#39;east-aws&#39;,&#xA;    &#39;log_level&#39;  =&amp;gt; &#39;INFO&#39;,&#xA;    &#39;node_name&#39;  =&amp;gt; &#39;agent&#39;,&#xA;    &#39;retry_join&#39; =&amp;gt; [&#39;172.16.0.1&#39;],&#xA;  },&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Install the (HashiCorp) packages:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;class { &#39;consul&#39;:&#xA;  install_method  =&amp;gt; &#39;package&#39;,&#xA;  manage_repo     =&amp;gt; $facts[&#39;os&#39;][&#39;name&#39;] != &#39;Archlinux&#39;,&#xA;  init_style      =&amp;gt; &#39;unmanaged&#39;,&#xA;  manage_data_dir =&amp;gt; true,&#xA;  manage_group    =&amp;gt; false,&#xA;  manage_user     =&amp;gt; false,&#xA;  config_dir      =&amp;gt; &#39;/etc/consul.d/&#39;,&#xA;  config_hash     =&amp;gt; {&#xA;    &#39;server&#39;   =&amp;gt; true,&#xA;  },&#xA;}&#xA;systemd::dropin_file { &#39;foo.conf&#39;:&#xA;  unit           =&amp;gt; &#39;consul.service&#39;,&#xA;  content        =&amp;gt; &#34;[Unit]\nConditionFileNotEmpty=\nConditionFileNotEmpty=/etc/consul.d/config.json&#34;,&#xA;  notify_service =&amp;gt; true,&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Web UI&lt;/h2&gt; &#xA;&lt;p&gt;To install and run the Web UI on the server, include &lt;code&gt;ui =&amp;gt; true&lt;/code&gt; in the &lt;code&gt;config_hash&lt;/code&gt;. You may also want to change the &lt;code&gt;client_addr&lt;/code&gt; to &lt;code&gt;0.0.0.0&lt;/code&gt; from the default &lt;code&gt;127.0.0.1&lt;/code&gt;, for example:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;class { &#39;consul&#39;:&#xA;  config_hash =&amp;gt; {&#xA;    &#39;bootstrap_expect&#39; =&amp;gt; 1,&#xA;    &#39;client_addr&#39;      =&amp;gt; &#39;0.0.0.0&#39;,&#xA;    &#39;data_dir&#39;         =&amp;gt; &#39;/opt/consul&#39;,&#xA;    &#39;datacenter&#39;       =&amp;gt; &#39;east-aws&#39;,&#xA;    &#39;log_level&#39;        =&amp;gt; &#39;INFO&#39;,&#xA;    &#39;node_name&#39;        =&amp;gt; &#39;server&#39;,&#xA;    &#39;server&#39;           =&amp;gt; true,&#xA;    &#39;ui&#39;               =&amp;gt; true,&#xA;  },&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;For more security options, consider leaving the &lt;code&gt;client_addr&lt;/code&gt; set to &lt;code&gt;127.0.0.1&lt;/code&gt; and use with a reverse proxy:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;$aliases = [&#39;consul&#39;, &#39;consul.example.com&#39;]&#xA;&#xA;# Reverse proxy for Web interface&#xA;include &#39;nginx&#39;&#xA;&#xA;$server_names = [$facts[&#39;networking&#39;][&#39;fqdn&#39;], $aliases]&#xA;&#xA;nginx::resource::vhost { $facts[&#39;networking&#39;][&#39;fqdn&#39;]:&#xA;  proxy       =&amp;gt; &#39;http://localhost:8500&#39;,&#xA;  server_name =&amp;gt; $server_names,&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Service Definition&lt;/h2&gt; &#xA;&lt;p&gt;To declare the availability of a service, you can use the &lt;code&gt;service&lt;/code&gt; define. This will register the service through the local consul client agent and optionally configure a health check to monitor its availability.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;consul::service { &#39;redis&#39;:&#xA;  checks  =&amp;gt; [&#xA;    {&#xA;      args     =&amp;gt; [&#39;/usr/local/bin/check_redis.py&#39;],&#xA;      interval =&amp;gt; &#39;10s&#39;&#xA;    },&#xA;  ],&#xA;  port    =&amp;gt; 6379,&#xA;  tags    =&amp;gt; [&#39;master&#39;],&#xA;  meta    =&amp;gt; {&#xA;    SLA =&amp;gt; &#39;1&#39;&#xA;  },&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;See the service.pp docstrings for all available inputs.&lt;/p&gt; &#xA;&lt;p&gt;You can also use &lt;code&gt;consul::services&lt;/code&gt; which accepts a hash of services, and makes it easy to declare in hiera. For example:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;consul::services:&#xA;  service1:&#xA;    address: &#34;%{facts.networking.ip}&#34;&#xA;    checks:&#xA;      - http: http://localhost:42/status&#xA;        interval: 5s&#xA;    port: 42&#xA;    tags:&#xA;      - &#34;foo:%{facts.custom.bar}&#34;&#xA;    meta:&#xA;      SLA: 1&#xA;  service2:&#xA;    address: &#34;%{facts.networking.ip}&#34;&#xA;    checks:&#xA;      - http: http://localhost:43/status&#xA;        interval: 5s&#xA;    port: 43&#xA;    tags:&#xA;      - &#34;foo:%{facts.custom.baz}&#34;&#xA;    meta:&#xA;      SLA: 4&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Watch Definitions&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;consul::watch { &#39;my_watch&#39;:&#xA;  handler     =&amp;gt; &#39;handler_path&#39;,&#xA;  passingonly =&amp;gt; true,&#xA;  service     =&amp;gt; &#39;serviceName&#39;,&#xA;  service_tag =&amp;gt; &#39;serviceTagName&#39;,&#xA;  type        =&amp;gt; &#39;service&#39;,&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;See the watch.pp docstrings for all available inputs.&lt;/p&gt; &#xA;&lt;p&gt;You can also use &lt;code&gt;consul::watches&lt;/code&gt; which accepts a hash of watches, and makes it easy to declare in hiera.&lt;/p&gt; &#xA;&lt;h2&gt;Check Definitions&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;consul::check { &#39;true_check&#39;:&#xA;  interval =&amp;gt; &#39;30s&#39;,&#xA;  args     =&amp;gt; [&#39;/bin/true&#39;],&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;See the check.pp docstrings for all available inputs.&lt;/p&gt; &#xA;&lt;p&gt;You can also use &lt;code&gt;consul::checks&lt;/code&gt; which accepts a hash of checks, and makes it easy to declare in hiera.&lt;/p&gt; &#xA;&lt;h2&gt;Removing Service, Check and Watch definitions&lt;/h2&gt; &#xA;&lt;p&gt;Do &lt;code&gt;ensure =&amp;gt; absent&lt;/code&gt; while removing existing service, check and watch definitions. This ensures consul will be reloaded via &lt;code&gt;SIGHUP&lt;/code&gt;. If you have &lt;code&gt;purge_config_dir&lt;/code&gt; set to &lt;code&gt;true&lt;/code&gt; and simply remove the definition it will cause consul to restart.&lt;/p&gt; &#xA;&lt;h2&gt;ACL Definitions&lt;/h2&gt; &#xA;&lt;h3&gt;Policy/Token system&lt;/h3&gt; &#xA;&lt;p&gt;Starting with version 1.4.0, a new ACL system was introduces separating rules (policies) from tokens.&lt;/p&gt; &#xA;&lt;p&gt;Tokens and policies may be both managed by Puppet:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;consul_policy {&#39;test_policy&#39;:&#xA;  description   =&amp;gt; &#39;test description&#39;,&#xA;  rules         =&amp;gt; [&#xA;    {&#xA;      &#39;resource&#39;    =&amp;gt; &#39;service_prefix&#39;,&#xA;      &#39;segment&#39;     =&amp;gt; &#39;test_service&#39;,&#xA;      &#39;disposition&#39; =&amp;gt; &#39;read&#39;&#xA;    },&#xA;    {&#xA;      &#39;resource&#39;    =&amp;gt; &#39;key&#39;,&#xA;      &#39;segment&#39;     =&amp;gt; &#39;test_key&#39;,&#xA;      &#39;disposition&#39; =&amp;gt; &#39;write&#39;&#xA;    },&#xA;  ],&#xA;  acl_api_token =&amp;gt; &#39;e33653a6-0320-4a71-b3af-75f14578e3aa&#39;,&#xA;}&#xA;&#xA;consul_token {&#39;test_token&#39;:&#xA;  accessor_id       =&amp;gt; &#39;7c4e3f11-786d-44e6-ac1d-b99546a1ccbd&#39;,&#xA;  policies_by_name  =&amp;gt; [&#xA;   &#39;test_policy&#39;&#xA;  ],&#xA;  policies_by_id    =&amp;gt; [&#xA;    &#39;652f27c9-d08d-412b-8985-9becc9c42fb2&#39;&#xA;  ],&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Here is an example to automatically create a policy and token for each host. For development environments &lt;code&gt;acl_api_token&lt;/code&gt; can be the bootstrap token. For production it should be a dedicated token with access to write/read from the acls.&lt;/p&gt; &#xA;&lt;p&gt;&lt;code&gt;accessor_id&lt;/code&gt; must be provided. It is a uuid. It can be generated in several different ways.&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt;Statically generated and assigned to the resource. See &lt;code&gt;/usr/bin/uuidgen&lt;/code&gt; on unix systems.&lt;/li&gt; &#xA; &lt;li&gt;Dynamically derived from the &lt;code&gt;$facts[&#39;dmi&#39;][&#39;product&#39;][&#39;uuid&#39;]&lt;/code&gt; fact in puppet (useful when &lt;code&gt;consul_token&lt;/code&gt; has 1:1 mapping to hosts).&lt;/li&gt; &#xA; &lt;li&gt;Dynamically derived from arbitrary string using &lt;code&gt;fqdn_uuid()&lt;/code&gt; (useful for giving all instances of a resource unique id).&lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;  # Create ACL policy that allows nodes to update themselves and read others&#xA;  consul_policy { $facts[&#39;networking&#39;][&#39;hostname&#39;]:&#xA;    description =&amp;gt; &#34;${facts[&#39;networking&#39;][&#39;hostname&#39;]}, generated by puppet&#34;,&#xA;    rules =&amp;gt; [&#xA;      {&#xA;        &#39;resource&#39; =&amp;gt; &#39;node&#39;,&#xA;        &#39;segment&#39; =&amp;gt; &#34;$facts[&#39;networking&#39;][&#39;hostname&#39;]&#34;,&#xA;        &#39;disposition&#39; =&amp;gt; &#39;write&#39;&#xA;      },&#xA;      {&#xA;        &#39;resource&#39; =&amp;gt; &#39;node&#39;,&#xA;        &#39;segment&#39; =&amp;gt; &#39;&#39;,&#xA;        &#39;disposition&#39; =&amp;gt; &#39;read&#39;&#xA;      }&#xA;    ],&#xA;    acl_api_token =&amp;gt; $acl_api_token,&#xA;  }&#xA;&#xA;  consul_token { $facts[&#39;networking&#39;][&#39;hostname&#39;]:&#xA;    accessor_id =&amp;gt; fqdn_uuid($facts[&#39;networking&#39;][&#39;hostname&#39;]),&#xA;    policies_by_name =&amp;gt; [&#34;${facts[&#39;networking&#39;][&#39;hostname&#39;]}&#34;],&#xA;    acl_api_token =&amp;gt; $acl_api_token,&#xA;  }&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Predefining token secret is supported by setting secret_id property.&lt;/p&gt; &#xA;&lt;p&gt;Externally created tokens and policies may be used by referencing them by ID (Token: accessor_id property, Policy: ID property, linking: policies_by_id property)&lt;/p&gt; &#xA;&lt;h3&gt;Legacy system&lt;/h3&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;consul_acl { &#39;ctoken&#39;:&#xA;  ensure =&amp;gt; &#39;present&#39;,&#xA;  rules  =&amp;gt; {&#xA;    &#39;key&#39; =&amp;gt; {&#xA;      &#39;test&#39; =&amp;gt; {&#xA;        &#39;policy&#39; =&amp;gt; &#39;read&#39;&#xA;      },&#xA;    },&#xA;  },&#xA;  type   =&amp;gt; &#39;client&#39;,&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Do not use duplicate names, and remember that the ACL ID (a read-only property for this type) is used as the token for requests, not the name&lt;/p&gt; &#xA;&lt;p&gt;Optionally, you may supply an &lt;code&gt;acl_api_token&lt;/code&gt;. This will allow you to create ACLs if the anonymous token doesn&#39;t permit ACL changes (which is likely). The api token may be the master token, another management token, or any client token with sufficient privileges.&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; This module currently cannot parse ACL tokens generated through means other than this module. Don&#39;t mix Puppet and Non-puppet ACLs for best results! (pull requests welcome to allow it to co-exist with ACLs generated with normal HCL)&lt;/p&gt; &#xA;&lt;h2&gt;Prepared Queries and Prepared Query Templates&lt;/h2&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;consul_prepared_query { &#39;consul&#39;:&#xA;  ensure               =&amp;gt; &#39;present&#39;,&#xA;  service_name         =&amp;gt; &#39;consul&#39;,&#xA;  service_failover_n   =&amp;gt; 1,&#xA;  service_failover_dcs =&amp;gt; [ &#39;dc1&#39;, &#39;dc2&#39; ],&#xA;  service_only_passing =&amp;gt; true,&#xA;  service_tags         =&amp;gt; [ &#39;tag1&#39;, &#39;tag2&#39; ],&#xA;  service_meta         =&amp;gt; { &#39;version&#39; =&amp;gt; &#39;1.2.3&#39; },&#xA;  ttl                  =&amp;gt; 10,&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;or a prepared query template:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;consul_prepared_query { &#39;consul&#39;:&#xA;  ensure               =&amp;gt; &#39;present&#39;,&#xA;  service_name         =&amp;gt; &#39;consul&#39;,&#xA;  service_name         =&amp;gt; &#39;consul-${match(1)}&#39; # lint:ignore:single_quote_string_with_variables&#xA;  service_failover_n   =&amp;gt; 1,&#xA;  service_failover_dcs =&amp;gt; [ &#39;dc1&#39;, &#39;dc2&#39; ],&#xA;  service_only_passing =&amp;gt; true,&#xA;  service_tags         =&amp;gt; [ &#39;${match(2)}&#39; ], # lint:ignore:single_quote_string_with_variables&#xA;  node_meta            =&amp;gt; { &#39;is_virtual&#39; =&amp;gt; &#39;false&#39; },&#xA;  template             =&amp;gt; true,&#xA;  template_regexp      =&amp;gt; &#39;^consul-(.*)-(.*)$&#39;,&#xA;  template_type        =&amp;gt; &#39;name_prefix_match&#39;,&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Key/Value Objects&lt;/h2&gt; &#xA;&lt;p&gt;Example:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;consul_key_value { &#39;key/path&#39;:&#xA;  ensure     =&amp;gt; &#39;present&#39;,&#xA;  value      =&amp;gt; &#39;myvaluestring&#39;,&#xA;  flags      =&amp;gt; 12345,&#xA;  datacenter =&amp;gt; &#39;dc1&#39;,&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;This provider allows you to manage key/value pairs. It tries to be smart in two ways:&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt;It caches the data accessible from the kv store with the specified acl token.&lt;/li&gt; &#xA; &lt;li&gt;It does not update the key if the value &amp;amp; flag are already correct.&lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;p&gt;These parameters are mandatory when using &lt;code&gt;consul_key_value&lt;/code&gt;:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;code&gt;name&lt;/code&gt; Name of the key/value object. Path in key/value store.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;value&lt;/code&gt; value of the key.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;The optional parameters only need to be specified if you require changes from default behaviour.&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;&lt;code&gt;flags&lt;/code&gt; {Integer} an opaque unsigned integer that can be attached to each entry. Clients can choose to use this however makes sense for their application. Default is &lt;code&gt;0&lt;/code&gt;.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;acl\_api_token&lt;/code&gt; {String} Token for accessing the ACL API. Default is &lt;code&gt;&#39;&#39;&lt;/code&gt;.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;datacenter&lt;/code&gt; {String} Use the key/value store in specified datacenter. If &lt;code&gt;&#39;&#39;&lt;/code&gt; (default) it will use the datacenter of the Consul agent at the HTTP address.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;protocol&lt;/code&gt; {String} protocol to use. Either &lt;code&gt;&#39;http&#39;&lt;/code&gt; (default) or &lt;code&gt;&#39;https&#39;&lt;/code&gt;.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;port&lt;/code&gt; {Integer} consul port. Defaults to &lt;code&gt;8500&lt;/code&gt;.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;hostname&lt;/code&gt; {String} consul hostname. Defaults to &lt;code&gt;&#39;localhost&#39;&lt;/code&gt;.&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;api_tries&lt;/code&gt; {Integer} number of tries when contacting the Consul REST API. Timeouts are not retried because a timeout already takes long. Defaults to &lt;code&gt;3&lt;/code&gt;.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Limitations&lt;/h2&gt; &#xA;&lt;p&gt;Depends on the JSON gem, or a modern ruby. (Ruby 1.8.7 is not officially supported) Current versions of puppetserver are new enough (2.0.3 &amp;amp; greater are known to work).&lt;/p&gt; &#xA;&lt;h2&gt;Windows Experimental Support&lt;/h2&gt; &#xA;&lt;p&gt;Windows service does no longer need [NSSM] to host the service. Consul will be installed as a native windows service using build-in sc.exe. The following caveats apply:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;By defult eveything will be installed into &lt;code&gt;c:\ProgramData\Consul\&lt;/code&gt; and &lt;code&gt;$consul::config_hash[&#39;data_dir&#39;]&lt;/code&gt; will default point to that location, so you don&#39;t need that in your &lt;code&gt;config_hash&lt;/code&gt;&lt;/li&gt; &#xA; &lt;li&gt;The service user needs &lt;code&gt;logon as a service&lt;/code&gt; permission to run things as a service(not yet supported by this module). therefore will &lt;code&gt;consul::manage_user&lt;/code&gt; and &lt;code&gt;consul::manage_group&lt;/code&gt; be default &lt;code&gt;false&lt;/code&gt;.&lt;/li&gt; &#xA; &lt;li&gt;consul::user will default be &lt;code&gt;NT AUTHORITY\NETWORK SERVICE&lt;/code&gt; (Has by default &lt;code&gt;logon as a service&lt;/code&gt; permission).&lt;/li&gt; &#xA; &lt;li&gt;consul::group will default be &lt;code&gt;Administrators&lt;/code&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;Example:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;class { &#39;consul&#39;:&#xA;  config_hash =&amp;gt; {&#xA;    &#39;bootstrap_expect&#39; =&amp;gt; 1,&#xA;    &#39;datacenter&#39;       =&amp;gt; &#39;dc1&#39;,&#xA;    &#39;log_level&#39;        =&amp;gt; &#39;INFO&#39;,&#xA;    &#39;node_name&#39;        =&amp;gt; &#39;server&#39;,&#xA;    &#39;server&#39;           =&amp;gt; true,&#xA;  },&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Telemetry&lt;/h2&gt; &#xA;&lt;p&gt;The Consul agent collects various runtime metrics about the performance of different libraries and subsystems. These metrics are aggregated on a ten second interval and are retained for one minute.&lt;/p&gt; &#xA;&lt;p&gt;To view this data, you must send a signal to the Consul process: on Unix, this is USR1 while on Windows it is BREAK. Once Consul receives the signal, it will dump the current telemetry information to the agent&#39;s stderr.&lt;/p&gt; &#xA;&lt;p&gt;This telemetry information can be used for debugging or otherwise getting a better view of what Consul is doing.&lt;/p&gt; &#xA;&lt;p&gt;Example:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-puppet&#34;&gt;class { &#39;consul&#39;:&#xA;  config_hash =&amp;gt; {&#xA;    &#39;bootstrap_expect&#39; =&amp;gt; 1,&#xA;    &#39;data_dir&#39;         =&amp;gt; &#39;/opt/consul&#39;,&#xA;    &#39;datacenter&#39;       =&amp;gt; &#39;east-aws&#39;,&#xA;    &#39;log_level&#39;        =&amp;gt; &#39;INFO&#39;,&#xA;    &#39;node_name&#39;        =&amp;gt; &#39;server&#39;,&#xA;    &#39;server&#39;           =&amp;gt; true,&#xA;    &#39;telemetry&#39; =&amp;gt; {&#xA;      &#39;statsd_address&#39; =&amp;gt; &#39;localhost:9125&#39;,&#xA;      &#39;prefix_filter&#39; =&amp;gt; [&#xA;        &#39;+consul.client.rpc&#39;,&#xA;        &#39;+consul.client.rpc.exceeded&#39;,&#xA;        &#39;+consul.acl.cache_hit&#39;,&#xA;        &#39;+consul.acl.cache_miss&#39;,&#xA;        &#39;+consul.dns.stale_queries&#39;,&#xA;        &#39;+consul.raft.state.leader&#39;,&#xA;        &#39;+consul.raft.state.candidate&#39;,&#xA;        &#39;+consul.raft.apply&#39;,&#xA;        &#39;+consul.raft.commitTime&#39;,&#xA;        &#39;+consul.raft.leader.dispatchLog&#39;,&#xA;        &#39;+consul.raft.replication.appendEntries&#39;,&#xA;        &#39;+consul.raft.leader.lastContact&#39;,&#xA;        &#39;+consul.rpc.accept_conn&#39;,&#xA;        &#39;+consul.catalog.register&#39;,&#xA;        &#39;+consul.catalog.deregister&#39;,&#xA;        &#39;+consul.kvs.apply&#39;,&#xA;        &#39;+consul.leader.barrier&#39;,&#xA;        &#39;+consul.leader.reconcile&#39;,&#xA;        &#39;+consul.leader.reconcileMember&#39;,&#xA;        &#39;+consul.leader.reapTombstones&#39;,&#xA;        &#39;+consul.rpc.raft_handoff&#39;,&#xA;        &#39;+consul.rpc.request_error&#39;,&#xA;        &#39;+consul.rpc.request&#39;,&#xA;        &#39;+consul.rpc.query&#39;,&#xA;        &#39;+consul.rpc.consistentRead&#39;,&#xA;        &#39;+consul.memberlist.msg.suspect&#39;,&#xA;        &#39;+consul.serf.member.flap&#39;,&#xA;        &#39;+consul.serf.events&#39;,&#xA;        &#39;+consul.session_ttl.active&#39;,&#xA;      ],&#xA;    },&#xA;  },&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;The metrics for the consul system you can look them in the Official Consul Site with all the description for every metric. Url: &lt;a href=&#34;https://www.consul.io/docs/agent/telemetry.html&#34;&gt;https://www.consul.io/docs/agent/telemetry.html&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Consul Template&lt;/h2&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/hashicorp/consul-template&#34;&gt;Consul Template&lt;/a&gt; is a piece of software to dynamically write out config files using templates that are populated with values from Consul. This module does not configure consul template. See &lt;a href=&#34;https://github.com/gdhbashton/puppet-consul_template&#34;&gt;gdhbashton/consul_template&lt;/a&gt; for a module that can do that.&lt;/p&gt; &#xA;&lt;h2&gt;Development&lt;/h2&gt; &#xA;&lt;p&gt;Open an &lt;a href=&#34;https://github.com/solarkennedy/puppet-consul/issues&#34;&gt;issue&lt;/a&gt; or &lt;a href=&#34;https://github.com/solarkennedy/puppet-consul/fork&#34;&gt;fork&lt;/a&gt; and open a &lt;a href=&#34;https://github.com/solarkennedy/puppet-consul/pulls&#34;&gt;Pull Request&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h2&gt;Transfer Notice&lt;/h2&gt; &#xA;&lt;p&gt;This module was originally authored by &lt;a href=&#34;http://github.com/solarkennedy&#34;&gt;solarkennedy&lt;/a&gt;. The maintainer preferred that Vox Pupuli take ownership of the module for future improvement and maintenance. Existing pull requests and issues were transferred over, please fork and continue to contribute here instead of KyleAnderson.&lt;/p&gt; &#xA;&lt;p&gt;Previously: &lt;a href=&#34;https://github.com/solarkennedy/puppet-consul&#34;&gt;https://github.com/solarkennedy/puppet-consul&lt;/a&gt;&lt;/p&gt;</summary>
  </entry>
</feed>