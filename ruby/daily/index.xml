<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>GitHub Ruby Daily Trending</title>
  <id>http://mshibanami.github.io/GitHubTrendingRSS</id>
  <updated>2023-10-24T01:36:05Z</updated>
  <subtitle>Daily Trending of Ruby in GitHub</subtitle>
  <link href="http://mshibanami.github.io/GitHubTrendingRSS"></link>
  <entry>
    <title>tarunvelli/rails-tabler-starter</title>
    <updated>2023-10-24T01:36:05Z</updated>
    <id>tag:github.com,2023-10-24:/tarunvelli/rails-tabler-starter</id>
    <link href="https://github.com/tarunvelli/rails-tabler-starter" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Free and open source Ruby on Rails starter kit built using Tabler&lt;/p&gt;&lt;hr&gt;&lt;div align=&#34;center&#34;&gt; &#xA; &lt;br&gt; &#xA; &lt;h1&gt;Rails Tabler Starter&lt;/h1&gt; &#xA; &lt;strong&gt;Rails starter boilerplate that you can use to build and prototype quickly. Get from idea to implementation in hours.&lt;/strong&gt; &#xA; &lt;br&gt; &#xA; &lt;br&gt; &#xA; &lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/tarunvelli/rails-tabler-starter/main/app/assets/images/saas-example.gif&#34; alt=&#34;&#34;&gt;&lt;/p&gt; &#xA;&lt;/div&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://rails-tabler.fly.dev&#34;&gt;Click here&lt;/a&gt; to view demo application. Check out the &lt;a href=&#34;https://rails-tabler.fly.dev/setup/edit&#34;&gt;Demo setup page&lt;/a&gt; to toggle application settings.&lt;/p&gt; &#xA;&lt;h2&gt;Goals&lt;/h2&gt; &#xA;&lt;p&gt;This starter is aimed at Rails developers familiar with the framework, aiming to facilitate seamless development with the following principles:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;No DSL: Avoid unnecessary Domain Specific Language (DSL) complexity.&lt;/li&gt; &#xA; &lt;li&gt;Simplicity over Efficiency: Prioritize simplicity in implementation over excessive optimization.&lt;/li&gt; &#xA; &lt;li&gt;Avoid Complex Frontend Functionality: Keep frontend functionality straightforward and manageable.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Overview&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;Pre-equipped with essential models such as&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Users&lt;/li&gt; &#xA;   &lt;li&gt;Roles&lt;/li&gt; &#xA;   &lt;li&gt;Plans&lt;/li&gt; &#xA;   &lt;li&gt;Subscriptions&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;div align=&#34;center&#34;&gt; &#xA; &lt;strong&gt;ERD&lt;/strong&gt; &#xA; &lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/tarunvelli/rails-tabler-starter/main/app/assets/images/template-erb.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt; &#xA;&lt;/div&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;User authentication &amp;amp; authorization&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Authentication via &lt;a href=&#34;https://github.com/heartcombo/devise&#34;&gt;Devise&lt;/a&gt;&lt;/li&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://github.com/heartcombo/devise/wiki/OmniAuth%3A-Overview&#34;&gt;OmniAuth&lt;/a&gt; integration to extend authentication using third-party providers&lt;/li&gt; &#xA;   &lt;li&gt;Authorization through &lt;a href=&#34;https://github.com/varvet/pundit&#34;&gt;Pundit&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Background worker &amp;amp; scheduler&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Utilizes &lt;a href=&#34;https://github.com/mperham/sidekiq/&#34;&gt;sidekiq&lt;/a&gt; and &lt;a href=&#34;https://github.com/sidekiq-scheduler/sidekiq-scheduler&#34;&gt;sidekiq-scheduler&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Role management&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Standard roles available across spaces&lt;/li&gt; &#xA;   &lt;li&gt;Custom role creation per space&lt;/li&gt; &#xA;   &lt;li&gt;Supports fine grained permissions per role&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Multiple user namespaces support&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Utilizes the &lt;code&gt;Space&lt;/code&gt; model to represent user namespaces (e.g., teams, organizations).&lt;/li&gt; &#xA;   &lt;li&gt;Example use case for turning on multi-space mode is a saas application&lt;/li&gt; &#xA;   &lt;li&gt;Example use case for turning off multi-space mode is an internal org tool&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Pre built UI layouts&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;High quality UI elements and layouts from &lt;a href=&#34;https://tabler.io/&#34;&gt;Tabler&lt;/a&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Development focussed&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://github.com/ctran/annotate_models&#34;&gt;Annotate&lt;/a&gt; - Annotate Rails classes with schema and routes info&lt;/li&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://github.com/presidentbeef/brakeman&#34;&gt;Brakeman&lt;/a&gt; - A static analysis security vulnerability scanner&lt;/li&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://github.com/deivid-rodriguez/byebug&#34;&gt;Byebug&lt;/a&gt; - Simple debugger&lt;/li&gt; &#xA;   &lt;li&gt;&lt;a href=&#34;https://github.com/bkeepers/dotenv&#34;&gt;Dotenv&lt;/a&gt; - Load environment variables from &lt;code&gt;.env&lt;/code&gt;&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Setup&lt;/h2&gt; &#xA;&lt;p&gt;To set up the project, ensure you have PostgreSQL and Redis installed locally. Use the following commands to install them:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;brew install postgresql@12 redis&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Clone the repo&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;git clone https://github.com/tarunvelli/rails-tabler-starter.git&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Install the required dependencies using asdf or setup the dependencies &lt;code&gt;.tool-versions&lt;/code&gt; in other preferred method:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;asdf install&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Set up and run the development server:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;bin/setup&#xA;bin/dev&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;To grant administrative privileges to a user and access admin features, run the following in the Rails console:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;bundle exec rails c&#xA;&amp;gt; User.first.update(admin: true)&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;AppSettings&lt;/h2&gt; &#xA;&lt;p&gt;Toggle app settings at &lt;code&gt;/setup/edit&lt;/code&gt;&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AppSettings.interface_layout&lt;/code&gt;&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Layout of app&lt;/li&gt; &#xA;   &lt;li&gt;values [&#34;VERTICAL&#34;, &#34;VERTICAL-TRANSPARENT&#34;, &#34;HORIZONTAL&#34;, &#34;OVERLAP&#34;, &#34;CONDENSED&#34;]&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AppSettings.interface_mode&lt;/code&gt;&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Light/Dark mode of app&lt;/li&gt; &#xA;   &lt;li&gt;&#34;SYSTEM&#34; picks the mode from system preferences&lt;/li&gt; &#xA;   &lt;li&gt;Values [&#34;LIGHT&#34;, &#34;DARK&#34;, &#34;SYSTEM&#34;]&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AppSettings.interface_theme&lt;/code&gt;&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Color theme of app&lt;/li&gt; &#xA;   &lt;li&gt;Values [&#34;DEFAULT&#34;, &#34;COOL&#34;]&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AppSettings.login_layout&lt;/code&gt; one of&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Layout of login screens&lt;/li&gt; &#xA;   &lt;li&gt;Values [&#34;DEFAULT&#34;, &#34;ILLUSTRATION&#34;, &#34;COVER&#34;]&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AppSettings.multi_space_mode&lt;/code&gt;&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;When true allows users to sign up and create spaces&lt;/li&gt; &#xA;   &lt;li&gt;When false allows only admin to invite users and create spaces&lt;/li&gt; &#xA;   &lt;li&gt;Values [true, false]&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;&lt;code&gt;AppSettings.show_landing_page&lt;/code&gt;&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;When true root path renders landing page&lt;/li&gt; &#xA;   &lt;li&gt;When false root path redirects to sign in page&lt;/li&gt; &#xA;   &lt;li&gt;Values [true, false]&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Deployment&lt;/h2&gt; &#xA;&lt;p&gt;Choose your preferred deployment platform:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Deploy on &lt;a href=&#34;https://fly.io/docs/rails/getting-started/&#34;&gt;Fly.io&lt;/a&gt;&lt;/li&gt; &#xA; &lt;li&gt;Deploy on &lt;a href=&#34;https://devcenter.heroku.com/articles/getting-started-with-rails7&#34;&gt;Heroku&lt;/a&gt;&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h2&gt;Contribution&lt;/h2&gt; &#xA;&lt;p&gt;Contributions to enhance this starter are highly encouraged and welcomed! Feel free to submit pull requests and improve the project collaboratively.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>rails-on-services/apartment</title>
    <updated>2023-10-24T01:36:05Z</updated>
    <id>tag:github.com,2023-10-24:/rails-on-services/apartment</id>
    <link href="https://github.com/rails-on-services/apartment" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Database multi-tenancy for Rack (and Rails) applications&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;Apartment&lt;/h1&gt; &#xA;&lt;p&gt;&lt;a href=&#34;https://badge.fury.io/rb/apartment&#34;&gt;&lt;img src=&#34;https://badge.fury.io/rb/ros-apartment.svg?sanitize=true&#34; alt=&#34;Gem Version&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://codeclimate.com/github/rails-on-services/apartment/maintainability&#34;&gt;&lt;img src=&#34;https://api.codeclimate.com/v1/badges/b0dc327380bb8438f991/maintainability&#34; alt=&#34;Code Climate&#34;&gt;&lt;/a&gt; &lt;a href=&#34;https://travis-ci.org/rails-on-services/apartment&#34;&gt;&lt;img src=&#34;https://travis-ci.org/rails-on-services/apartment.svg?branch=development&#34; alt=&#34;Build Status&#34;&gt;&lt;/a&gt;&lt;/p&gt; &#xA;&lt;p&gt;&lt;em&gt;Multitenancy for Rails and ActiveRecord&lt;/em&gt;&lt;/p&gt; &#xA;&lt;p&gt;Apartment provides tools to help you deal with multiple tenants in your Rails application. If you need to have certain data sequestered based on account or company, but still allow some data to exist in a common tenant, Apartment can help.&lt;/p&gt; &#xA;&lt;h2&gt;Apartment drop in replacement gem&lt;/h2&gt; &#xA;&lt;p&gt;After having reached out via github issues and email directly, no replies ever came. Since we wanted to upgrade our application to Rails 6 we decided to fork and start some development to support Rails 6. Because we don&#39;t have access to the apartment gem itself, the solution was to release it under a different name but providing the exact same API as it was before.&lt;/p&gt; &#xA;&lt;h2&gt;Help wanted&lt;/h2&gt; &#xA;&lt;p&gt;We were never involved with the development of Apartment gem in the first place and this project started out of our own needs. We will be more than happy to collaborate to maintain the gem alive and supporting the latest versions of ruby and rails, but your help is appreciated. Either by reporting bugs you may find or proposing improvements to the gem itself. Feel free to reach out.&lt;/p&gt; &#xA;&lt;h2&gt;Installation&lt;/h2&gt; &#xA;&lt;h3&gt;Rails&lt;/h3&gt; &#xA;&lt;p&gt;Add the following to your Gemfile:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;gem &#39;ros-apartment&#39;, require: &#39;apartment&#39;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Then generate your &lt;code&gt;Apartment&lt;/code&gt; config file using&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;bundle exec rails generate apartment:install&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;This will create a &lt;code&gt;config/initializers/apartment.rb&lt;/code&gt; initializer file. Configure as needed using the docs below.&lt;/p&gt; &#xA;&lt;p&gt;That&#39;s all you need to set up the Apartment libraries. If you want to switch tenants on a per-user basis, look under &#34;Usage - Switching tenants per request&#34;, below.&lt;/p&gt; &#xA;&lt;blockquote&gt; &#xA; &lt;p&gt;NOTE: If using &lt;a href=&#34;http://www.postgresql.org/docs/9.0/static/ddl-schemas.html&#34;&gt;postgresql schemas&lt;/a&gt; you must use:&lt;/p&gt; &#xA; &lt;ul&gt; &#xA;  &lt;li&gt;for Rails 3.1.x: &lt;em&gt;Rails ~&amp;gt; 3.1.2&lt;/em&gt;, it contains a &lt;a href=&#34;https://github.com/rails/rails/pull/3232&#34;&gt;patch&lt;/a&gt; that makes prepared statements work with multiple schemas&lt;/li&gt; &#xA; &lt;/ul&gt; &#xA;&lt;/blockquote&gt; &#xA;&lt;h2&gt;Usage&lt;/h2&gt; &#xA;&lt;h3&gt;Video Tutorial&lt;/h3&gt; &#xA;&lt;p&gt;How to separate your application data into different accounts or companies. &lt;a href=&#34;https://gorails.com/episodes/multitenancy-with-apartment&#34;&gt;GoRails #47&lt;/a&gt;&lt;/p&gt; &#xA;&lt;h3&gt;Creating new Tenants&lt;/h3&gt; &#xA;&lt;p&gt;Before you can switch to a new apartment tenant, you will need to create it. Whenever you need to create a new tenant, you can run the following command:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Apartment::Tenant.create(&#39;tenant_name&#39;)&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;If you&#39;re using the &lt;a href=&#34;https://github.com/influitive/apartment#handling-environments&#34;&gt;prepend environment&lt;/a&gt; config option or you AREN&#39;T using Postgresql Schemas, this will create a tenant in the following format: &#34;#{environment}_tenant_name&#34;. In the case of a sqlite database, this will be created in your &#39;db/&#39; folder. With other databases, the tenant will be created as a new DB within the system.&lt;/p&gt; &#xA;&lt;p&gt;When you create a new tenant, all migrations will be run against that tenant, so it will be up to date when create returns.&lt;/p&gt; &#xA;&lt;h4&gt;Notes on PostgreSQL&lt;/h4&gt; &#xA;&lt;p&gt;PostgreSQL works slightly differently than other databases when creating a new tenant. If you are using PostgreSQL, Apartment by default will set up a new &lt;a href=&#34;http://www.postgresql.org/docs/9.3/static/ddl-schemas.html&#34;&gt;schema&lt;/a&gt; and migrate into there. This provides better performance, and allows Apartment to work on systems like Heroku, which would not allow a full new database to be created.&lt;/p&gt; &#xA;&lt;p&gt;One can optionally use the full database creation instead if they want, though this is not recommended&lt;/p&gt; &#xA;&lt;h3&gt;Switching Tenants&lt;/h3&gt; &#xA;&lt;p&gt;To switch tenants using Apartment, use the following command:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Apartment::Tenant.switch(&#39;tenant_name&#39;) do&#xA;  # ...&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;When switch is called, all requests coming to ActiveRecord will be routed to the tenant you specify (with the exception of excluded models, see below). The tenant is automatically switched back at the end of the block to what it was before.&lt;/p&gt; &#xA;&lt;p&gt;There is also &lt;code&gt;switch!&lt;/code&gt; which doesn&#39;t take a block, but it&#39;s recommended to use &lt;code&gt;switch&lt;/code&gt;. To return to the default tenant, you can call &lt;code&gt;switch&lt;/code&gt; with no arguments.&lt;/p&gt; &#xA;&lt;h4&gt;Multiple Tenants&lt;/h4&gt; &#xA;&lt;p&gt;When using schemas, you can also pass in a list of schemas if desired. Any tables defined in a schema earlier in the chain will be referenced first, so this is only useful if you have a schema with only some of the tables defined:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Apartment::Tenant.switch([&#39;tenant_1&#39;, &#39;tenant_2&#39;]) do&#xA;  # ...&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Switching Tenants per request&lt;/h3&gt; &#xA;&lt;p&gt;You can have Apartment route to the appropriate tenant by adding some Rack middleware. Apartment can support many different &#34;Elevators&#34; that can take care of this routing to your data.&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;NOTE: when switching tenants per-request, keep in mind that the order of your Rack middleware is important.&lt;/strong&gt; See the &lt;a href=&#34;https://raw.githubusercontent.com/rails-on-services/apartment/development/#middleware-considerations&#34;&gt;Middleware Considerations&lt;/a&gt; section for more.&lt;/p&gt; &#xA;&lt;p&gt;The initializer above will generate the appropriate code for the Subdomain elevator by default. You can see this in &lt;code&gt;config/initializers/apartment.rb&lt;/code&gt; after running that generator. If you&#39;re &lt;em&gt;not&lt;/em&gt; using the generator, you can specify your elevator below. Note that in this case you will &lt;strong&gt;need&lt;/strong&gt; to require the elevator manually in your &lt;code&gt;application.rb&lt;/code&gt; like so&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# config/application.rb&#xA;require &#39;apartment/elevators/subdomain&#39; # or &#39;domain&#39;, &#39;first_subdomain&#39;, &#39;host&#39;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h4&gt;Switch on subdomain&lt;/h4&gt; &#xA;&lt;p&gt;In house, we use the subdomain elevator, which analyzes the subdomain of the request and switches to a tenant schema of the same name. It can be used like so:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# application.rb&#xA;module MyApplication&#xA;  class Application &amp;lt; Rails::Application&#xA;    config.middleware.use Apartment::Elevators::Subdomain&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;If you want to exclude a domain, for example if you don&#39;t want your application to treat www like a subdomain, in an initializer in your application, you can set the following:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# config/initializers/apartment/subdomain_exclusions.rb&#xA;Apartment::Elevators::Subdomain.excluded_subdomains = [&#39;www&#39;]&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;This functions much in the same way as Apartment.excluded_models. This example will prevent switching your tenant when the subdomain is &lt;a href=&#34;http://www&#34;&gt;www&lt;/a&gt;. Handy for subdomains like: &#34;public&#34;, &#34;www&#34;, and &#34;admin&#34; :)&lt;/p&gt; &#xA;&lt;h4&gt;Switch on first subdomain&lt;/h4&gt; &#xA;&lt;p&gt;To switch on the first subdomain, which analyzes the chain of subdomains of the request and switches to a tenant schema of the first name in the chain (e.g. owls.birds.animals.com would switch to &#34;owls&#34;). It can be used like so:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# application.rb&#xA;module MyApplication&#xA;  class Application &amp;lt; Rails::Application&#xA;    config.middleware.use Apartment::Elevators::FirstSubdomain&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;If you want to exclude a domain, for example if you don&#39;t want your application to treat www like a subdomain, in an initializer in your application, you can set the following:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# config/initializers/apartment/subdomain_exclusions.rb&#xA;Apartment::Elevators::FirstSubdomain.excluded_subdomains = [&#39;www&#39;]&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;This functions much in the same way as the Subdomain elevator. &lt;strong&gt;NOTE:&lt;/strong&gt; in fact, at the time of this writing, the &lt;code&gt;Subdomain&lt;/code&gt; and &lt;code&gt;FirstSubdomain&lt;/code&gt; elevators both use the first subdomain (&lt;a href=&#34;https://github.com/influitive/apartment/issues/339#issuecomment-235578610&#34;&gt;#339&lt;/a&gt;). If you need to switch on larger parts of a Subdomain, consider using a Custom Elevator.&lt;/p&gt; &#xA;&lt;h4&gt;Switch on domain&lt;/h4&gt; &#xA;&lt;p&gt;To switch based on full domain (excluding the &#39;www&#39; subdomains and top level domains &lt;em&gt;ie &#39;.com&#39;&lt;/em&gt; ) use the following:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# application.rb&#xA;module MyApplication&#xA;  class Application &amp;lt; Rails::Application&#xA;    config.middleware.use Apartment::Elevators::Domain&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Note that if you have several subdomains, then it will match on the first &lt;em&gt;non-www&lt;/em&gt; subdomain:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;example.com =&amp;gt; example&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;http://www.example.com&#34;&gt;www.example.com&lt;/a&gt; =&amp;gt; example&lt;/li&gt; &#xA; &lt;li&gt;a.example.com =&amp;gt; a&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h4&gt;Switch on full host using a hash&lt;/h4&gt; &#xA;&lt;p&gt;To switch based on full host with a hash to find corresponding tenant name use the following:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# application.rb&#xA;module MyApplication&#xA;  class Application &amp;lt; Rails::Application&#xA;    config.middleware.use Apartment::Elevators::HostHash, {&#39;example.com&#39; =&amp;gt; &#39;example_tenant&#39;}&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h4&gt;Switch on full host, ignoring given first subdomains&lt;/h4&gt; &#xA;&lt;p&gt;To switch based on full host to find corresponding tenant name use the following:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# application.rb&#xA;module MyApplication&#xA;  class Application &amp;lt; Rails::Application&#xA;    config.middleware.use Apartment::Elevators::Host&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;If you want to exclude a first-subdomain, for example if you don&#39;t want your application to include www in the matching, in an initializer in your application, you can set the following:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Apartment::Elevators::Host.ignored_first_subdomains = [&#39;www&#39;]&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;With the above set, these would be the results:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;example.com =&amp;gt; example.com&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;http://www.example.com&#34;&gt;www.example.com&lt;/a&gt; =&amp;gt; example.com&lt;/li&gt; &#xA; &lt;li&gt;a.example.com =&amp;gt; a.example.com&lt;/li&gt; &#xA; &lt;li&gt;&lt;a href=&#34;http://www.a.example.com&#34;&gt;www.a.example.com&lt;/a&gt; =&amp;gt; a.example.com&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h4&gt;Custom Elevator&lt;/h4&gt; &#xA;&lt;p&gt;A Generic Elevator exists that allows you to pass a &lt;code&gt;Proc&lt;/code&gt; (or anything that responds to &lt;code&gt;call&lt;/code&gt;) to the middleware. This Object will be passed in an &lt;code&gt;ActionDispatch::Request&lt;/code&gt; object when called for you to do your magic. Apartment will use the return value of this proc to switch to the appropriate tenant. Use like so:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# application.rb&#xA;module MyApplication&#xA;  class Application &amp;lt; Rails::Application&#xA;    # Obviously not a contrived example&#xA;    config.middleware.use Apartment::Elevators::Generic, proc { |request| request.host.reverse }&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Your other option is to subclass the Generic elevator and implement your own switching mechanism. This is exactly how the other elevators work. Look at the &lt;code&gt;subdomain.rb&lt;/code&gt; elevator to get an idea of how this should work. Basically all you need to do is subclass the generic elevator and implement your own &lt;code&gt;parse_tenant_name&lt;/code&gt; method that will ultimately return the name of the tenant based on the request being made. It &lt;em&gt;could&lt;/em&gt; look something like this:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# app/middleware/my_custom_elevator.rb&#xA;class MyCustomElevator &amp;lt; Apartment::Elevators::Generic&#xA;&#xA;  # @return {String} - The tenant to switch to&#xA;  def parse_tenant_name(request)&#xA;    # request is an instance of Rack::Request&#xA;&#xA;    # example: look up some tenant from the db based on this request&#xA;    tenant_name = SomeModel.from_request(request)&#xA;&#xA;    return tenant_name&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h4&gt;Middleware Considerations&lt;/h4&gt; &#xA;&lt;p&gt;In the examples above, we show the Apartment middleware being appended to the Rack stack with&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Rails.application.config.middleware.use Apartment::Elevators::Subdomain&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;By default, the Subdomain middleware switches into a Tenant based on the subdomain at the beginning of the request, and when the request is finished, it switches back to the &#34;public&#34; Tenant. This happens in the &lt;a href=&#34;https://github.com/influitive/apartment/raw/development/lib/apartment/elevators/generic.rb#L22&#34;&gt;Generic&lt;/a&gt; elevator, so all elevators that inherit from this elevator will operate as such.&lt;/p&gt; &#xA;&lt;p&gt;It&#39;s also good to note that Apartment switches back to the &#34;public&#34; tenant any time an error is raised in your application.&lt;/p&gt; &#xA;&lt;p&gt;This works okay for simple applications, but it&#39;s important to consider that you may want to maintain the &#34;selected&#34; tenant through different parts of the Rack application stack. For example, the &lt;a href=&#34;https://github.com/plataformatec/devise&#34;&gt;Devise&lt;/a&gt; gem adds the &lt;code&gt;Warden::Manager&lt;/code&gt; middleware at the end of the stack in the examples above, our &lt;code&gt;Apartment::Elevators::Subdomain&lt;/code&gt; middleware would come after it. Trouble is, Apartment resets the selected tenant after the request is finish, so some redirects (e.g. authentication) in Devise will be run in the context of the &#34;public&#34; tenant. The same issue would also effect a gem such as the &lt;a href=&#34;https://github.com/charliesome/better_errors&#34;&gt;better_errors&lt;/a&gt; gem which inserts a middleware quite early in the Rails middleware stack.&lt;/p&gt; &#xA;&lt;p&gt;To resolve this issue, consider adding the Apartment middleware at a location in the Rack stack that makes sense for your needs, e.g.:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Rails.application.config.middleware.insert_before Warden::Manager, Apartment::Elevators::Subdomain&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Now work done in the Warden middleware is wrapped in the &lt;code&gt;Apartment::Tenant.switch&lt;/code&gt; context started in the Generic elevator.&lt;/p&gt; &#xA;&lt;h3&gt;Dropping Tenants&lt;/h3&gt; &#xA;&lt;p&gt;To drop tenants using Apartment, use the following command:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Apartment::Tenant.drop(&#39;tenant_name&#39;)&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;When method is called, the schema is dropped and all data from itself will be lost. Be careful with this method.&lt;/p&gt; &#xA;&lt;h3&gt;Custom Prompt&lt;/h3&gt; &#xA;&lt;h4&gt;Console methods&lt;/h4&gt; &#xA;&lt;p&gt;&lt;code&gt;ros-apartment&lt;/code&gt; console configures two helper methods:&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt;&lt;code&gt;tenant_list&lt;/code&gt; - list available tenants while using the console&lt;/li&gt; &#xA; &lt;li&gt;&lt;code&gt;st(tenant_name:String)&lt;/code&gt; - Switches the context to the tenant name passed, if it exists.&lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;h4&gt;Custom printed prompt&lt;/h4&gt; &#xA;&lt;p&gt;&lt;code&gt;ros-apartment&lt;/code&gt; also has a custom prompt that gives a bit more information about the context in which you&#39;re running. It shows the environment as well as the tenant that is currently switched to. In order for you to enable this, you need to require the custom console in your application.&lt;/p&gt; &#xA;&lt;p&gt;In &lt;code&gt;application.rb&lt;/code&gt; add &lt;code&gt;require &#39;apartment/custom_console&#39;&lt;/code&gt;. Please note that we rely on &lt;code&gt;pry-rails&lt;/code&gt; to edit the prompt, thus your project needs to install it as well. In order to do so, you need to add &lt;code&gt;gem &#39;pry-rails&#39;&lt;/code&gt; to your project&#39;s gemfile.&lt;/p&gt; &#xA;&lt;h2&gt;Config&lt;/h2&gt; &#xA;&lt;p&gt;The following config options should be set up in a Rails initializer such as:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code&gt;config/initializers/apartment.rb&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;To set config options, add this to your initializer:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Apartment.configure do |config|&#xA;  # set your options (described below) here&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Skip tenant schema check&lt;/h3&gt; &#xA;&lt;p&gt;This is configurable by setting: &lt;code&gt;tenant_presence_check&lt;/code&gt;. It defaults to true in order to maintain the original gem behavior. This is only checked when using one of the PostgreSQL adapters. The original gem behavior, when running &lt;code&gt;switch&lt;/code&gt; would look for the existence of the schema before switching. This adds an extra query on every context switch. While in the default simple scenarios this is a valid check, in high volume platforms this adds some unnecessary overhead which can be detected in some other ways on the application level.&lt;/p&gt; &#xA;&lt;p&gt;Setting this configuration value to &lt;code&gt;false&lt;/code&gt; will disable the schema presence check before trying to switch the context.&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Apartment.configure do |config|&#xA;  config.tenant_presence_check = false&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Additional logging information&lt;/h3&gt; &#xA;&lt;p&gt;Enabling this configuration will output the database that the process is currently connected to as well as which schemas are in the search path. This can be enabled by setting to true the &lt;code&gt;active_record_log&lt;/code&gt; configuration.&lt;/p&gt; &#xA;&lt;p&gt;Please note that our custom logger inherits from &lt;code&gt;ActiveRecord::LogSubscriber&lt;/code&gt; so this will be required for the configuration to work.&lt;/p&gt; &#xA;&lt;p&gt;&lt;strong&gt;Example log output:&lt;/strong&gt;&lt;/p&gt; &#xA;&lt;img src=&#34;https://raw.githubusercontent.com/rails-on-services/apartment/development/documentation/images/log_example.png&#34;&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;Apartment.configure do |config|&#xA;  config.active_record_log = true&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Excluding models&lt;/h3&gt; &#xA;&lt;p&gt;If you have some models that should always access the &#39;public&#39; tenant, you can specify this by configuring Apartment using &lt;code&gt;Apartment.configure&lt;/code&gt;. This will yield a config object for you. You can set excluded models like so:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;config.excluded_models = [&#34;User&#34;, &#34;Company&#34;]        # these models will not be multi-tenanted, but remain in the global (public) namespace&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;Note that a string representation of the model name is now the standard so that models are properly constantized when reloaded in development&lt;/p&gt; &#xA;&lt;p&gt;Rails will always access the &#39;public&#39; tenant when accessing these models, but note that tables will be created in all schemas. This may not be ideal, but its done this way because otherwise rails wouldn&#39;t be able to properly generate the schema.rb file.&lt;/p&gt; &#xA;&lt;blockquote&gt; &#xA; &lt;p&gt;&lt;strong&gt;NOTE - Many-To-Many Excluded Models:&lt;/strong&gt; Since model exclusions must come from referencing a real ActiveRecord model, &lt;code&gt;has_and_belongs_to_many&lt;/code&gt; is NOT supported. In order to achieve a many-to-many relationship for excluded models, you MUST use &lt;code&gt;has_many :through&lt;/code&gt;. This way you can reference the join model in the excluded models configuration.&lt;/p&gt; &#xA;&lt;/blockquote&gt; &#xA;&lt;h3&gt;Postgresql Schemas&lt;/h3&gt; &#xA;&lt;h4&gt;Alternative: Creating new schemas by using raw SQL dumps&lt;/h4&gt; &#xA;&lt;p&gt;Apartment can be forced to use raw SQL dumps insted of &lt;code&gt;schema.rb&lt;/code&gt; for creating new schemas. Use this when you are using some extra features in postgres that can&#39;t be represented in &lt;code&gt;schema.rb&lt;/code&gt;, like materialized views etc.&lt;/p&gt; &#xA;&lt;p&gt;This only applies while using postgres adapter and &lt;code&gt;config.use_schemas&lt;/code&gt; is set to &lt;code&gt;true&lt;/code&gt;. (Note: this option doesn&#39;t use &lt;code&gt;db/structure.sql&lt;/code&gt;, it creates SQL dump by executing &lt;code&gt;pg_dump&lt;/code&gt;)&lt;/p&gt; &#xA;&lt;p&gt;Enable this option with:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;config.use_sql = true&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Providing a Different default_tenant&lt;/h3&gt; &#xA;&lt;p&gt;By default, ActiveRecord will use &lt;code&gt;&#34;$user&#34;, public&lt;/code&gt; as the default &lt;code&gt;schema_search_path&lt;/code&gt;. This can be modified if you wish to use a different default schema be setting:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;config.default_tenant = &#34;some_other_schema&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;With that set, all excluded models will use this schema as the table name prefix instead of &lt;code&gt;public&lt;/code&gt; and &lt;code&gt;reset&lt;/code&gt; on &lt;code&gt;Apartment::Tenant&lt;/code&gt; will return to this schema as well.&lt;/p&gt; &#xA;&lt;h3&gt;Persistent Schemas&lt;/h3&gt; &#xA;&lt;p&gt;Apartment will normally just switch the &lt;code&gt;schema_search_path&lt;/code&gt; whole hog to the one passed in. This can lead to problems if you want other schemas to always be searched as well. Enter &lt;code&gt;persistent_schemas&lt;/code&gt;. You can configure a list of other schemas that will always remain in the search path, while the default gets swapped out:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;config.persistent_schemas = [&#39;some&#39;, &#39;other&#39;, &#39;schemas&#39;]&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h3&gt;Installing Extensions into Persistent Schemas&lt;/h3&gt; &#xA;&lt;p&gt;Persistent Schemas have numerous useful applications. &lt;a href=&#34;http://www.postgresql.org/docs/9.1/static/hstore.html&#34;&gt;Hstore&lt;/a&gt;, for instance, is a popular storage engine for Postgresql. In order to use extensions such as Hstore, you have to install it to a specific schema and have that always in the &lt;code&gt;schema_search_path&lt;/code&gt;.&lt;/p&gt; &#xA;&lt;p&gt;When using extensions, keep in mind:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;Extensions can only be installed into one schema per database, so we will want to install it into a schema that is always available in the &lt;code&gt;schema_search_path&lt;/code&gt;&lt;/li&gt; &#xA; &lt;li&gt;The schema and extension need to be created in the database &lt;em&gt;before&lt;/em&gt; they are referenced in migrations, database.yml or apartment.&lt;/li&gt; &#xA; &lt;li&gt;There does not seem to be a way to create the schema and extension using standard rails migrations.&lt;/li&gt; &#xA; &lt;li&gt;Rails db:test:prepare deletes and recreates the database, so it needs to be easy for the extension schema to be recreated here.&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h4&gt;1. Ensure the extensions schema is created when the database is created&lt;/h4&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# lib/tasks/db_enhancements.rake&#xA;&#xA;####### Important information ####################&#xA;# This file is used to setup a shared extensions #&#xA;# within a dedicated schema. This gives us the   #&#xA;# advantage of only needing to enable extensions #&#xA;# in one place.                                  #&#xA;#                                                #&#xA;# This task should be run AFTER db:create but    #&#xA;# BEFORE db:migrate.                             #&#xA;##################################################&#xA;&#xA;namespace :db do&#xA;  desc &#39;Also create shared_extensions Schema&#39;&#xA;  task :extensions =&amp;gt; :environment  do&#xA;    # Create Schema&#xA;    ActiveRecord::Base.connection.execute &#39;CREATE SCHEMA IF NOT EXISTS shared_extensions;&#39;&#xA;    # Enable Hstore&#xA;    ActiveRecord::Base.connection.execute &#39;CREATE EXTENSION IF NOT EXISTS HSTORE SCHEMA shared_extensions;&#39;&#xA;    # Enable UUID-OSSP&#xA;    ActiveRecord::Base.connection.execute &#39;CREATE EXTENSION IF NOT EXISTS &#34;uuid-ossp&#34; SCHEMA shared_extensions;&#39;&#xA;    # Grant usage to public&#xA;    ActiveRecord::Base.connection.execute &#39;GRANT usage ON SCHEMA shared_extensions to public;&#39;&#xA;  end&#xA;end&#xA;&#xA;Rake::Task[&#34;db:create&#34;].enhance do&#xA;  Rake::Task[&#34;db:extensions&#34;].invoke&#xA;end&#xA;&#xA;Rake::Task[&#34;db:test:purge&#34;].enhance do&#xA;  Rake::Task[&#34;db:extensions&#34;].invoke&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h4&gt;2. Ensure the schema is in Rails&#39; default connection&lt;/h4&gt; &#xA;&lt;p&gt;Next, your &lt;code&gt;database.yml&lt;/code&gt; file must mimic what you&#39;ve set for your default and persistent schemas in Apartment. When you run migrations with Rails, it won&#39;t know about the extensions schema because Apartment isn&#39;t injected into the default connection, it&#39;s done on a per-request basis, therefore Rails doesn&#39;t know about &lt;code&gt;hstore&lt;/code&gt; or &lt;code&gt;uuid-ossp&lt;/code&gt; during migrations. To do so, add the following to your &lt;code&gt;database.yml&lt;/code&gt; for all environments&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;# database.yml&#xA;...&#xA;adapter: postgresql&#xA;schema_search_path: &#34;public,shared_extensions&#34;&#xA;...&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;This would be for a config with &lt;code&gt;default_tenant&lt;/code&gt; set to &lt;code&gt;public&lt;/code&gt; and &lt;code&gt;persistent_schemas&lt;/code&gt; set to &lt;code&gt;[&#39;shared_extensions&#39;]&lt;/code&gt;. &lt;strong&gt;Note&lt;/strong&gt;: This only works on Heroku with &lt;a href=&#34;https://devcenter.heroku.com/changelog-items/426&#34;&gt;Rails 4.1+&lt;/a&gt;. For apps that use older Rails versions hosted on Heroku, the only way to properly setup is to start with a fresh PostgreSQL instance:&lt;/p&gt; &#xA;&lt;ol&gt; &#xA; &lt;li&gt;Append &lt;code&gt;?schema_search_path=public,hstore&lt;/code&gt; to your &lt;code&gt;DATABASE_URL&lt;/code&gt; environment variable, by this you don&#39;t have to revise the &lt;code&gt;database.yml&lt;/code&gt; file (which is impossible since Heroku regenerates a completely different and immutable &lt;code&gt;database.yml&lt;/code&gt; of its own on each deploy)&lt;/li&gt; &#xA; &lt;li&gt;Run &lt;code&gt;heroku pg:psql&lt;/code&gt; from your command line&lt;/li&gt; &#xA; &lt;li&gt;And then &lt;code&gt;DROP EXTENSION hstore;&lt;/code&gt; (&lt;strong&gt;Note:&lt;/strong&gt; This will drop all columns that use &lt;code&gt;hstore&lt;/code&gt; type, so proceed with caution; only do this with a fresh PostgreSQL instance)&lt;/li&gt; &#xA; &lt;li&gt;Next: &lt;code&gt;CREATE SCHEMA IF NOT EXISTS hstore;&lt;/code&gt;&lt;/li&gt; &#xA; &lt;li&gt;Finally: &lt;code&gt;CREATE EXTENSION IF NOT EXISTS hstore SCHEMA hstore;&lt;/code&gt; and hit enter (&lt;code&gt;\q&lt;/code&gt; to exit)&lt;/li&gt; &#xA;&lt;/ol&gt; &#xA;&lt;p&gt;To double check, login to the console of your Heroku app and see if &lt;code&gt;Apartment.connection.schema_search_path&lt;/code&gt; is &lt;code&gt;public,hstore&lt;/code&gt;&lt;/p&gt; &#xA;&lt;h4&gt;3. Ensure the schema is in the apartment config&lt;/h4&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# config/initializers/apartment.rb&#xA;...&#xA;config.persistent_schemas = [&#39;shared_extensions&#39;]&#xA;...&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h4&gt;Alternative: Creating schema by default&lt;/h4&gt; &#xA;&lt;p&gt;Another way that we&#39;ve successfully configured hstore for our applications is to add it into the postgresql template1 database so that every tenant that gets created has it by default.&lt;/p&gt; &#xA;&lt;p&gt;One caveat with this approach is that it can interfere with other projects in development using the same extensions and template, but not using apartment with this approach.&lt;/p&gt; &#xA;&lt;p&gt;You can do so using a command like so&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;psql -U postgres -d template1 -c &#34;CREATE SCHEMA shared_extensions AUTHORIZATION some_username;&#34;&#xA;psql -U postgres -d template1 -c &#34;CREATE EXTENSION IF NOT EXISTS hstore SCHEMA shared_extensions;&#34;&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;The &lt;em&gt;ideal&lt;/em&gt; setup would actually be to install &lt;code&gt;hstore&lt;/code&gt; into the &lt;code&gt;public&lt;/code&gt; schema and leave the public schema in the &lt;code&gt;search_path&lt;/code&gt; at all times. We won&#39;t be able to do this though until public doesn&#39;t also contain the tenanted tables, which is an open issue with no real milestone to be completed. Happy to accept PR&#39;s on the matter.&lt;/p&gt; &#xA;&lt;h3&gt;Managing Migrations&lt;/h3&gt; &#xA;&lt;p&gt;In order to migrate all of your tenants (or postgresql schemas) you need to provide a list of dbs to Apartment. You can make this dynamic by providing a Proc object to be called on migrations. This object should yield an array of string representing each tenant name. Example:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# Dynamically get tenant names to migrate&#xA;config.tenant_names = lambda{ Customer.pluck(:tenant_name) }&#xA;&#xA;# Use a static list of tenant names for migrate&#xA;config.tenant_names = [&#39;tenant1&#39;, &#39;tenant2&#39;]&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;You can then migrate your tenants using the normal rake task:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;rake db:migrate&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;p&gt;This just invokes &lt;code&gt;Apartment::Tenant.migrate(#{tenant_name})&lt;/code&gt; for each tenant name supplied from &lt;code&gt;Apartment.tenant_names&lt;/code&gt;&lt;/p&gt; &#xA;&lt;p&gt;Note that you can disable the default migrating of all tenants with &lt;code&gt;db:migrate&lt;/code&gt; by setting &lt;code&gt;Apartment.db_migrate_tenants = false&lt;/code&gt; in your &lt;code&gt;Rakefile&lt;/code&gt;. Note this must be done &lt;em&gt;before&lt;/em&gt; the rake tasks are loaded. ie. before &lt;code&gt;YourApp::Application.load_tasks&lt;/code&gt; is called&lt;/p&gt; &#xA;&lt;h4&gt;Parallel Migrations&lt;/h4&gt; &#xA;&lt;p&gt;Apartment supports parallelizing migrations into multiple threads when you have a large number of tenants. By default, parallel migrations is turned off. You can enable this by setting &lt;code&gt;parallel_migration_threads&lt;/code&gt; to the number of threads you want to use in your initializer.&lt;/p&gt; &#xA;&lt;p&gt;Keep in mind that because migrations are going to access the database, the number of threads indicated here should be less than the pool size that Rails will use to connect to your database.&lt;/p&gt; &#xA;&lt;h3&gt;Handling Environments&lt;/h3&gt; &#xA;&lt;p&gt;By default, when not using postgresql schemas, Apartment will prepend the environment to the tenant name to ensure there is no conflict between your environments. This is mainly for the benefit of your development and test environments. If you wish to turn this option off in production, you could do something like:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;config.prepend_environment = !Rails.env.production?&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Tenants on different servers&lt;/h2&gt; &#xA;&lt;p&gt;You can store your tenants in different databases on one or more servers. To do it, specify your &lt;code&gt;tenant_names&lt;/code&gt; as a hash, keys being the actual tenant names, values being a hash with the database configuration to use.&lt;/p&gt; &#xA;&lt;p&gt;Example:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;config.with_multi_server_setup = true&#xA;config.tenant_names = {&#xA;  &#39;tenant1&#39; =&amp;gt; {&#xA;    adapter: &#39;postgresql&#39;,&#xA;    host: &#39;some_server&#39;,&#xA;    port: 5555,&#xA;    database: &#39;postgres&#39; # this is not the name of the tenant&#39;s db&#xA;                         # but the name of the database to connect to, before creating the tenant&#39;s db&#xA;                         # mandatory in postgresql&#xA;  }&#xA;}&#xA;# or using a lambda:&#xA;config.tenant_names = lambda do&#xA;  Tenant.all.each_with_object({}) do |tenant, hash|&#xA;    hash[tenant.name] = tenant.db_configuration&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Background workers&lt;/h2&gt; &#xA;&lt;p&gt;Both these gems have been forked as a side consequence of having a new gem name. You can use them exactly as you were using before. They are, just like this one a drop-in replacement.&lt;/p&gt; &#xA;&lt;p&gt;See &lt;a href=&#34;https://github.com/rails-on-services/apartment-sidekiq&#34;&gt;apartment-sidekiq&lt;/a&gt; or &lt;a href=&#34;https://github.com/rails-on-services/apartment-activejob&#34;&gt;apartment-activejob&lt;/a&gt;.&lt;/p&gt; &#xA;&lt;h2&gt;Callbacks&lt;/h2&gt; &#xA;&lt;p&gt;You can execute callbacks when switching between tenants or creating a new one, Apartment provides the following callbacks:&lt;/p&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt;before_create&lt;/li&gt; &#xA; &lt;li&gt;after_create&lt;/li&gt; &#xA; &lt;li&gt;before_switch&lt;/li&gt; &#xA; &lt;li&gt;after_switch&lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;p&gt;You can register a callback using &lt;a href=&#34;https://api.rubyonrails.org/classes/ActiveSupport/Callbacks.html&#34;&gt;ActiveSupport::Callbacks&lt;/a&gt; the following way:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;require &#39;apartment/adapters/abstract_adapter&#39;&#xA;&#xA;module Apartment&#xA;  module Adapters&#xA;    class AbstractAdapter&#xA;      set_callback :switch, :before do |object|&#xA;        ...&#xA;      end&#xA;    end&#xA;  end&#xA;end&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Running rails console without a connection to the database&lt;/h2&gt; &#xA;&lt;p&gt;By default, once apartment starts, it establishes a connection to the database. It is possible to disable this initial connection, by running with &lt;code&gt;APARTMENT_DISABLE_INIT&lt;/code&gt; set to something:&lt;/p&gt; &#xA;&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$ APARTMENT_DISABLE_INIT=true DATABASE_URL=postgresql://localhost:1234/buk_development bin/rails runner &#39;puts 1&#39;&#xA;# 1&#xA;&lt;/code&gt;&lt;/pre&gt; &#xA;&lt;h2&gt;Contributing&lt;/h2&gt; &#xA;&lt;ul&gt; &#xA; &lt;li&gt; &lt;p&gt;In both &lt;code&gt;spec/dummy/config&lt;/code&gt; and &lt;code&gt;spec/config&lt;/code&gt;, you will see &lt;code&gt;database.yml.sample&lt;/code&gt; files&lt;/p&gt; &#xA;  &lt;ul&gt; &#xA;   &lt;li&gt;Copy them into the same directory but with the name &lt;code&gt;database.yml&lt;/code&gt;&lt;/li&gt; &#xA;   &lt;li&gt;Edit them to fit your own settings&lt;/li&gt; &#xA;  &lt;/ul&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Rake tasks (see the Rakefile) will help you setup your dbs necessary to run tests&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Please issue pull requests to the &lt;code&gt;development&lt;/code&gt; branch. All development happens here, master is used for releases.&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;Ensure that your code is accompanied with tests. No code will be merged without tests&lt;/p&gt; &lt;/li&gt; &#xA; &lt;li&gt; &lt;p&gt;If you&#39;re looking to help, check out the TODO file for some upcoming changes I&#39;d like to implement in Apartment.&lt;/p&gt; &lt;/li&gt; &#xA;&lt;/ul&gt; &#xA;&lt;h3&gt;Running bundle install&lt;/h3&gt; &#xA;&lt;p&gt;mysql2 gem in some cases fails to install. If you face problems running bundle install in OSX, try installing the gem running:&lt;/p&gt; &#xA;&lt;p&gt;&lt;code&gt;gem install mysql2 -v &#39;0.5.3&#39; -- --with-ldflags=-L/usr/local/opt/openssl/lib --with-cppflags=-I/usr/local/opt/openssl/include&lt;/code&gt;&lt;/p&gt; &#xA;&lt;h2&gt;License&lt;/h2&gt; &#xA;&lt;p&gt;Apartment is released under the &lt;a href=&#34;http://www.opensource.org/licenses/MIT&#34;&gt;MIT License&lt;/a&gt;.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>appdev-projects/sinatra-omnicalc-2</title>
    <updated>2023-10-24T01:36:05Z</updated>
    <id>tag:github.com,2023-10-24:/appdev-projects/sinatra-omnicalc-2</id>
    <link href="https://github.com/appdev-projects/sinatra-omnicalc-2" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;/p&gt;&lt;hr&gt;&lt;h1&gt;sinatra-omnicalc-2&lt;/h1&gt; &#xA;&lt;p&gt;Target: &lt;a href=&#34;https://omnicalc-2.matchthetarget.com/&#34;&gt;https://omnicalc-2.matchthetarget.com/&lt;/a&gt;&lt;/p&gt;</summary>
  </entry>
</feed>